import{a as Nn,d as vn,r as n,c as Ha,u as We,L as ke,e as ys,N as Bs,f as Kt,h as wn,i as Ie,O as Ua,B as _n,j as kn,k as xe}from"./react-DfOM8JTm.js";import{a as Sn}from"./utils-DKtEPqdw.js";import{u as yt,g as Rs,s as Ts,a as Cn,c as Tn,b as oa,d as st,e as En}from"./form-N6nRcttH.js";import{R as da,B as Mn,C as ha,X as ma,Y as xa,T as ua,b as Pn,A as Ln,L as An,c as Es}from"./charts-DGj2hLqf.js";import"./redux-Bryjm78i.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))r(l);new MutationObserver(l=>{for(const d of l)if(d.type==="childList")for(const c of d.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function a(l){const d={};return l.integrity&&(d.integrity=l.integrity),l.referrerPolicy&&(d.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?d.credentials="include":l.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function r(l){if(l.ep)return;l.ep=!0;const d=a(l);fetch(l.href,d)}})();var Ms={exports:{}},zt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ga;function Dn(){if(ga)return zt;ga=1;var t=Nn(),s=Symbol.for("react.element"),a=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,l=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function c(f,j,o){var x,i={},m=null,b=null;o!==void 0&&(m=""+o),j.key!==void 0&&(m=""+j.key),j.ref!==void 0&&(b=j.ref);for(x in j)r.call(j,x)&&!d.hasOwnProperty(x)&&(i[x]=j[x]);if(f&&f.defaultProps)for(x in j=f.defaultProps,j)i[x]===void 0&&(i[x]=j[x]);return{$$typeof:s,type:f,key:m,ref:b,props:i,_owner:l.current}}return zt.Fragment=a,zt.jsx=c,zt.jsxs=c,zt}var pa;function $n(){return pa||(pa=1,Ms.exports=Dn()),Ms.exports}var e=$n(),os={},fa;function Fn(){if(fa)return os;fa=1;var t=vn();return os.createRoot=t.createRoot,os.hydrateRoot=t.hydrateRoot,os}var qn=Fn();const Ga="http://localhost:5050";function In(t){const s=t.replace(/\/+$/,"");return/\/api$/i.test(s)?s:s+"/api"}function Bn(t){return t.replace(/\/+$/,"").replace(/\/api$/i,"")}const Rn=In(Ga),Kn=Bn(Ga),H=Sn.create({baseURL:Rn,timeout:1e4});H.interceptors.request.use(t=>{const s=localStorage.getItem("access_token");return s&&(t.headers=t.headers??{},t.headers.Authorization=`Bearer ${s}`),t});H.interceptors.response.use(t=>t,t=>Promise.reject(t));async function Vn(t){try{const s=await H.post("/auth/login",t);if(!s?.data?.success||!s?.data?.data?.token){const a=s?.data?.error?.message||s?.data?.message||"Tên đăng nhập hoặc mật khẩu không đúng";throw new Error(a)}return s.data}catch(s){const a=s?.response?.data?.error?.message||s?.response?.data?.message||s?.message||"Đăng nhập thất bại";throw new Error(a)}}async function On(t){const{data:s}=await H.post("/auth/register",t);return s}async function zn(t){const{data:s}=await H.post("/auth/forgot-password",{email:t});return s}async function Hn(t,s){const{data:a}=await H.post("/auth/reset-password",{token:t,new_password:s});return a}function Un(t){return t===3?"admin":t===2?"shop":"cus"}function Gn(t){return{user_code:t.UserID,level_type:Un(t.LevelCode),user_name:t.FullName,email:t.Email??""}}const Qa=n.createContext(void 0),Oe=()=>{const t=n.useContext(Qa);if(!t)throw new Error("useAuth must be used within an AuthProvider");return t},ba=(t,s="Đã có lỗi xảy ra")=>t?.response?.data?.error?.message||t?.response?.data?.message||t?.message||s,Qn=({children:t})=>{const[s,a]=n.useState(null),[r,l]=n.useState(!0);n.useEffect(()=>{const i=localStorage.getItem("user");if(i)try{a(JSON.parse(i))}catch{localStorage.removeItem("user")}l(!1)},[]);const x={user:s,login:async(i,m)=>{try{const b=String(i??"").trim(),p=String(m??"");if(!b)throw new Error("Vui lòng nhập email hoặc số điện thoại");if(!p)throw new Error("Vui lòng nhập mật khẩu");const w=await Vn({login:b,password:p});localStorage.setItem("access_token",w.data.token);const g=Gn(w.data);return a(g),localStorage.setItem("user",JSON.stringify(g)),!0}catch(b){throw new Error(ba(b,"Tên đăng nhập hoặc mật khẩu không đúng"))}},register:async i=>{try{return await On({user_name:i.user_name,email:i.email,password:i.password}),!0}catch(m){throw new Error(ba(m,"Đăng ký thất bại"))}},logout:()=>{a(null),localStorage.removeItem("user"),localStorage.removeItem("access_token")},loading:r,isShopOwner:()=>s?.level_type==="shop",getShopCode:()=>s?.shop_code??null};return e.jsx(Qa.Provider,{value:x,children:t})},Xn={ArrowRight:e.jsxs(e.Fragment,{children:[e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"},"l1"),e.jsx("polyline",{points:"12 5 19 12 12 19"},"p1")]}),AlertCircle:e.jsxs(e.Fragment,{children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"},"c1"),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"},"l1"),e.jsx("circle",{cx:"12",cy:"16",r:"0.5",fill:"currentColor",stroke:"none"},"c2")]}),CheckCircle:e.jsxs(e.Fragment,{children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"},"c1"),e.jsx("polyline",{points:"8 12 11 15 16 9"},"p1")]}),CheckCircle2:e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M4 12a8 8 0 1 1 8 8"},"p0"),e.jsx("polyline",{points:"8 12 11 15 16 9"},"p1")]}),User:e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4h-2a4 4 0 0 0-4 4v2"},"p1"),e.jsx("circle",{cx:"12",cy:"7",r:"4"},"c1")]}),Users:e.jsxs(e.Fragment,{children:[e.jsx("circle",{cx:"9",cy:"7",r:"4"},"c1"),e.jsx("path",{d:"M17 11a4 4 0 1 0-2-7.5"},"p1"),e.jsx("path",{d:"M2 21a7 7 0 0 1 14 0"},"p2"),e.jsx("path",{d:"M14 21a7 7 0 0 1 8 0"},"p3")]}),Mail:e.jsxs(e.Fragment,{children:[e.jsx("rect",{x:"3",y:"6",width:"18",height:"12",rx:"2"},"r1"),e.jsx("polyline",{points:"3 8.5 12 14 21 8.5"},"p1")]}),Phone:e.jsx("path",{d:"M8 2h8a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zm0 4h8"},"p1"),Clock3:e.jsxs(e.Fragment,{children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"},"c1"),e.jsx("path",{d:"M12 6v6l3 2"},"p1")]}),Sparkles:e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M5 3l1.5 4.5L11 9 6.5 10.5 5 15l-1.5-4.5L0 9l3.5-1.5z"},"p1"),e.jsx("path",{d:"M19 4l1 3 3 1-3 1-1 3-1-3-3-1 3-1z"},"p2"),e.jsx("path",{d:"M14 13l.75 2.25L17 16l-2.25.75L14 19l-.75-2.25L11 16l2.25-.75z"},"p3")]}),TrendingUp:e.jsxs(e.Fragment,{children:[e.jsx("polyline",{points:"3 17 9 11 13 15 21 7"},"p1"),e.jsx("polyline",{points:"14 7 21 7 21 14"},"p2")]}),Building:e.jsxs(e.Fragment,{children:[e.jsx("rect",{x:"4",y:"2",width:"16",height:"20",rx:"2"},"r1"),e.jsx("path",{d:"M9 6h2v2H9zM13 6h2v2h-2zM9 10h2v2H9zM13 10h2v2h-2zM9 14h2v2H9zM13 14h2v2h-2z"},"p1"),e.jsx("path",{d:"M4 18h16"},"p2")]}),Send:e.jsx("path",{d:"M4 4l16 8-16 8 4-8z"},"p1"),ShieldCheck:e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M12 22s7-3.5 7-10V5l-7-3-7 3v7c0 6.5 7 10 7 10z"},"p1"),e.jsx("polyline",{points:"9 12 12 15 17 9"},"p2")]}),ShoppingCart:e.jsxs(e.Fragment,{children:[e.jsx("circle",{cx:"9",cy:"20",r:"1.5"},"c1"),e.jsx("circle",{cx:"17",cy:"20",r:"1.5"},"c2"),e.jsx("path",{d:"M3 4h2l3 12h10l2-8H7"},"p1")]}),LogOut:e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"},"p1"),e.jsx("polyline",{points:"16 17 21 12 16 7"},"p2"),e.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12"},"l1")]}),PhoneCall:e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M22 16.92V21a1 1 0 0 1-1.1 1 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6A19.79 19.79 0 0 1 3 2.1 1 1 0 0 1 4 1h4.09a1 1 0 0 1 1 .75l1.2 4.8a1 1 0 0 1-.29.95l-2.2 2.2a16 16 0 0 0 6 6l2.2-2.2a1 1 0 0 1 .95-.29l4.8 1.2a1 1 0 0 1 .75 1z"},"p1"),e.jsx("path",{d:"M15 5a5 5 0 0 1 5 5"},"p2"),e.jsx("path",{d:"M15 1a9 9 0 0 1 9 9"},"p3")]}),ArrowLeft:e.jsxs(e.Fragment,{children:[e.jsx("line",{x1:"19",y1:"12",x2:"5",y2:"12"},"l1"),e.jsx("polyline",{points:"12 5 5 12 12 19"},"p1")]}),Star:e.jsx("path",{d:"M12 2.5l2.8 5.7 6.2.9-4.5 4.4 1 6.2-5.5-2.9-5.5 2.9 1-6.2L3 9.1l6.2-.9z"},"p1"),Quote:e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M7 17a4 4 0 0 1-4-4V7h4z"},"p1"),e.jsx("path",{d:"M21 17a4 4 0 0 1-4-4V7h4z"},"p2")]}),Compass:e.jsxs(e.Fragment,{children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"},"c1"),e.jsx("polygon",{points:"16 8 11 11 8 16 13 13"},"p1"),e.jsx("circle",{cx:"12",cy:"12",r:"1"},"c2")]}),Timer:e.jsxs(e.Fragment,{children:[e.jsx("circle",{cx:"12",cy:"14",r:"8"},"c1"),e.jsx("path",{d:"M12 10v4l2 2"},"p1"),e.jsx("path",{d:"M9 2h6"},"p2"),e.jsx("path",{d:"M19.5 7.5l-1.5 1.5"},"p3")]}),Trophy:e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M8 21h8"},"p1"),e.jsx("path",{d:"M12 17v4"},"p2"),e.jsx("path",{d:"M7 4h10l1 6a5 5 0 0 1-5 5h-2a5 5 0 0 1-5-5z"},"p3"),e.jsx("path",{d:"M5 4v2a4 4 0 0 0 4 4"},"p4"),e.jsx("path",{d:"M19 4v2a4 4 0 0 1-4 4"},"p5")]}),Zap:e.jsx("polyline",{points:"13 2 3 14 11 14 11 22 21 10 13 10 13 2"},"p1"),Building2:e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M6 22V2h12v20"},"p1"),e.jsx("path",{d:"M6 6h12"},"p2"),e.jsx("path",{d:"M6 10h12"},"p3"),e.jsx("path",{d:"M10 14h4"},"p4"),e.jsx("path",{d:"M10 18h4"},"p5")]}),MessageSquare:e.jsxs(e.Fragment,{children:[e.jsx("rect",{x:"3",y:"5",width:"18",height:"14",rx:"2"},"r1"),e.jsx("path",{d:"M7 19v4l4-4"},"p1")]}),AlertTriangle:e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M10.3 3.5 1.4 19a1 1 0 0 0 .9 1.5h19.4a1 1 0 0 0 .9-1.5L13.4 3.5a1 1 0 0 0-1.8 0z"},"p1"),e.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"13"},"l1"),e.jsx("circle",{cx:"12",cy:"17",r:"0.5",fill:"currentColor",stroke:"none"},"c1")]}),MapPin:e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M12 21s-6-5.33-6-10a6 6 0 1 1 12 0c0 4.67-6 10-6 10z"},"p1"),e.jsx("circle",{cx:"12",cy:"11",r:"2.5"},"c1")]}),Clock:e.jsxs(e.Fragment,{children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"},"c1"),e.jsx("path",{d:"M12 6v6l4 2"},"p1")]})},$=t=>{const s=Ha.forwardRef(({className:a,...r},l)=>e.jsx("svg",{ref:l,className:a,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.8,strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",...r,children:Xn[t]??e.jsxs(e.Fragment,{children:[e.jsx("circle",{cx:"12",cy:"12",r:"9"},"c1"),e.jsx("line",{x1:"9",y1:"12",x2:"15",y2:"12"},"l1"),e.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"15"},"l2")]})}));return s.displayName=t,s},Yn=$("Activity"),Ce=$("AlertCircle"),Zn=$("AlertTriangle"),at=$("ArrowLeft"),Ps=$("ArrowRight"),Wn=$("ArrowUpRight"),Jn=$("Award"),er=$("BadgePercent"),tr=$("Ban"),Ks=$("BarChart3"),sr=$("Building"),ar=$("Building2"),Wt=$("Calendar"),nr=$("CalendarClock"),Xa=$("CalendarRange"),Ya=$("Check"),ta=$("CheckCircle"),nt=$("CheckCircle2"),ds=$("ChevronDown"),Lt=$("ChevronLeft"),Ns=$("ChevronRight"),Se=$("Clock");$("Clock3");$("Compass");const rr=$("Copy"),$t=$("CreditCard"),Ft=$("DollarSign"),lr=$("Download"),ir=$("Edit"),cr=$("ExternalLink"),qt=$("Eye"),Jt=$("EyeOff"),or=$("FileClock"),dr=$("FileText"),vs=$("Filter"),hr=$("Hash");$("Heart");const ja=$("History"),mr=$("KeyRound"),xr=$("Layers"),ur=$("LayoutDashboard"),gr=$("LineChart"),es=$("Loader"),Yt=$("Loader2"),At=$("Lock"),Vs=$("LogIn"),pr=$("LogOut"),Nt=$("Mail"),ns=$("MapPin"),fr=$("MessageSquare"),ya=$("Pause"),br=$("Pencil"),jr=$("Percent"),rs=$("Phone"),yr=$("PhoneCall"),Na=$("Play"),ts=$("Plus"),Nr=$("QrCode");$("Quote");const bt=$("RefreshCcw"),Os=$("RefreshCw"),vr=$("Save"),va=$("ScanLine"),sa=$("Search"),Zt=$("Send"),wr=$("Settings");$("Share2");const _r=$("ShieldCheck"),zs=$("ShoppingCart"),kr=$("SlidersHorizontal"),ss=$("Sparkles");$("Star");const Za=$("Store"),Sr=$("TicketPercent"),Cr=$("Timer"),Tr=$("TimerReset"),Pt=$("Trash2");$("TrendingDown");const It=$("TrendingUp"),Er=$("Trophy"),wa=$("UploadCloud"),ws=$("User"),Hs=$("UserPlus"),_s=$("Users"),Mr=$("Wallet"),Us=$("Wallet2"),Pr=$("Wrench"),as=$("X"),Lr=$("XCircle"),Wa=$("Zap"),Ar=()=>{const{user:t,logout:s}=Oe(),a=We(),r=()=>{s(),a("/")};return e.jsx("header",{className:"navbar",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsxs(ke,{to:"/",className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-10 h-10 bg-emerald-600 rounded-xl flex items-center justify-center text-white shadow-lg shadow-emerald-500/40",children:e.jsx(Er,{className:"w-5 h-5"})}),e.jsx("span",{className:"text-xl font-bold text-gray-900",children:"ThueRe"})]}),e.jsxs("nav",{className:"hidden md:flex space-x-8",children:[e.jsx(ke,{to:"/",className:"text-gray-700 hover:text-emerald-600 transition-colors duration-200 font-medium",children:"Trang chủ"}),e.jsx(ke,{to:"/fields",className:"text-gray-700 hover:text-emerald-600 transition-colors duration-200 font-medium",children:"Danh sách sân"}),t?.level_type==="cus"&&e.jsx(ke,{to:"/cart",className:"text-gray-700 hover:text-emerald-600 transition-colors duration-200 font-medium",children:"Giỏ hàng"}),t?.level_type==="shop"&&e.jsx(ke,{to:"/shop/dashboard",className:"text-gray-700 hover:text-emerald-600 transition-colors duration-200 font-medium",children:"Quản lý Shop"}),t?.level_type==="admin"&&e.jsx(ke,{to:"/admin/dashboard",className:"text-gray-700 hover:text-emerald-600 transition-colors duration-200 font-medium",children:"Quản lý Admin"})]}),e.jsx("div",{className:"flex items-center",children:t?e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-emerald-50 text-emerald-600",children:e.jsx(ws,{className:"h-5 w-5"})}),e.jsx("div",{className:"flex flex-col leading-tight",children:e.jsx("span",{className:"text-gray-700 font-medium",children:t.user_name})}),e.jsx("span",{className:"px-2 py-1 text-xs bg-emerald-100 text-emerald-600 rounded-full capitalize",children:t.level_type})]}),t.level_type==="cus"&&e.jsxs(ke,{to:"/cart",className:"inline-flex items-center gap-1 rounded-lg border border-emerald-200 px-3 py-1 text-sm font-medium text-emerald-700 transition-colors duration-200 hover:bg-emerald-50 md:hidden",children:[e.jsx(zs,{className:"h-4 w-4"}),"Giỏ hàng"]}),e.jsxs("button",{onClick:r,className:"inline-flex items-center gap-1 rounded-lg border border-transparent px-3 py-1 text-sm font-semibold text-gray-600 transition hover:border-red-100 hover:text-red-600",children:[e.jsx(pr,{className:"h-4 w-4"}),"Đăng xuất"]})]}):e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ke,{to:"/login",className:"text-gray-700 hover:text-emerald-600 transition-colors duration-200 font-medium",children:"Đăng nhập"}),e.jsx(ke,{to:"/register",className:"bg-emerald-600 text-white px-4 py-2 rounded-lg hover:bg-emerald-700 transition-colors duration-200 font-medium",children:"Đăng ký"})]})})]})})})},Dr=()=>{const t=[{icon:ns,label:"Địa chỉ",value:"615 Âu Cơ, Phường Tân Phú, TP. Hồ Chí Minh"},{icon:rs,label:"Hotline",value:"0866 845 867"},{icon:Nt,label:"Email",value:"thuere2004@gmail.com"},{icon:Se,label:"Hỗ trợ",value:"24/7 Hỗ trợ khách hàng"}];return e.jsx("footer",{className:"footer",children:e.jsx("div",{className:"footer-inner",children:e.jsxs("div",{className:"footer-grid",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"footer-title",children:"ThueRe"}),e.jsx("p",{className:"footer-text",children:"Nền tảng đặt sân thể thao hàng đầu Việt Nam. Kết nối người chơi với các sân thể thao chất lượng cao."}),e.jsx("div",{className:"flex space-x-3",children:e.jsx("div",{className:"w-8 h-8 bg-emerald-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold",children:e.jsx("a",{href:"https://www.facebook.com/people/ThueRe/61580979570690/",children:"FB"})})})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"footer-title",children:"Liên kết nhanh"}),e.jsxs("ul",{className:"space-y-2",children:[e.jsx("li",{children:e.jsx("a",{href:"/",className:"footer-link",children:"Trang chủ"})}),e.jsx("li",{children:e.jsx("a",{href:"/fields",className:"footer-link",children:"Danh sách sân"})}),e.jsx("li",{children:e.jsx("a",{href:"/register",className:"footer-link",children:"Đăng ký"})}),e.jsx("li",{children:e.jsx("a",{href:"/login",className:"footer-link",children:"Đăng nhập"})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"footer-title",children:"Loại sân"}),e.jsxs("ul",{className:"space-y-2",children:[e.jsx("li",{className:"footer-text",children:"Bóng đá"}),e.jsx("li",{className:"footer-text",children:"Cầu lông"}),e.jsx("li",{className:"footer-text",children:"Tennis"}),e.jsx("li",{className:"footer-text",children:"Bóng bàn"}),e.jsx("li",{className:"footer-text",children:"Bóng chày"}),e.jsx("li",{className:"footer-text",children:"Bơi lội"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"footer-title",children:"Liên hệ"}),e.jsx("div",{className:"space-y-3",children:t.map(({icon:s,label:a,value:r})=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"flex h-9 w-9 items-center justify-center rounded-full bg-white/10 text-emerald-200",children:e.jsx(s,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] uppercase tracking-[0.3em] text-emerald-200/60",children:a}),e.jsx("p",{className:"text-gray-300 text-sm",children:r})]})]},a))})]})]})})})},Ve=({children:t,showFooter:s=!0})=>e.jsxs("div",{className:"page flex flex-col",children:[e.jsx(Ar,{}),e.jsx("main",{className:"",children:t}),s&&e.jsx(Dr,{})]}),Ja=({size:t="md",className:s=""})=>{const a={sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12"};return e.jsx("div",{className:`animate-spin rounded-full border-2 border-gray-300 border-t-emerald-600 ${a[t]} ${s}`})},Ls=({children:t,requiredLevel:s})=>{const{user:a,loading:r}=Oe(),l=ys();return r?e.jsx("div",{className:"page center",children:e.jsx(Ja,{size:"lg"})}):a?s&&a.level_type!==s?e.jsx(Bs,{to:"/",replace:!0}):e.jsx(e.Fragment,{children:t}):e.jsx(Bs,{to:"/login",replace:!0,state:{from:l,carry:l.state}})},js=t=>t?t.toString().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9\s_-]+/g,"").replace(/[\s_-]+/g,"_").replace(/^_+|_+$/g,""):"",Gs={badminton:{label:"Cầu lông"},football:{label:"Bóng đá"},baseball:{label:"Bóng chày"},swimming:{label:"Bơi lội"},tennis:{label:"Tennis"},table_tennis:{label:"Bóng bàn"},basketball:{label:"Bóng rổ"}},$r=Object.entries(Gs).reduce((t,s)=>{const[a,{label:r}]=s,l=a;return t[js(a)]=l,t[js(r)]=l,t},{}),en={active:{label:"Sẵn sàng",className:"status-chip status-trong"},maintenance:{label:"Bảo trì",className:"status-chip status-bao-tri"},booked:{label:"Đã đặt",className:"status-chip status-khac"},inactive:{label:"Tạm đóng",className:"status-chip status-khac"},draft:{label:"Bản nháp",className:"status-chip status-khac"}},Fr={active:"active",available:"active",open:"active",trong:"active",san_sang:"active","sẵn sàng":"active",maintenance:"maintenance",on_maintenance:"maintenance",bao_tri:"maintenance","bảo trì":"maintenance",booked:"booked",reserved:"booked",confirmed:"booked",da_dat:"booked","đã đặt":"booked",held:"booked",on_hold:"booked","đang giữ chỗ":"booked",inactive:"inactive",closed:"inactive",unavailable:"inactive",blocked:"inactive",disabled:"inactive",tam_dong:"inactive","tạm đóng":"inactive",tam_khoa:"inactive","tạm khóa":"inactive",draft:"draft","bản nháp":"draft"},Ze=t=>{const s=tn(t);return s&&s in Gs?Gs[s].label??"Không xác định":"Không xác định"},tn=t=>{if(!t)return;const s=js(t);return $r[s]},Dt=t=>{const s=aa(t);return s?en[s]?.label??"Không xác định":"Không xác định"},sn=t=>{const s=aa(t),a="status-chip status-khac";return s?en[s]?.className??a:a},aa=t=>{if(!t)return;const s=js(t);return Fr[s]},Bt=t=>t?.price_per_hour??t?.default_price_per_hour??0,qr=/^\d{2}:\d{2}:\d{2}$/,_a=t=>{if(!t)return"";const s=t.trim();return s?qr.test(s)?s.slice(0,5):s:""},Ir=t=>{if(typeof t=="boolean")return t;if(typeof t=="number")return t!==0;if(typeof t=="string"){const s=t.trim().toLowerCase();if(["1","true","y","yes"].includes(s))return!0;if(["0","false","n","no"].includes(s))return!1}},an=t=>{if(!t)return"Chưa cập nhật";if(Ir(t.is_open_24h))return"Mở cửa 24/24";const a=_a(t.opening_time),r=_a(t.closing_time);return a&&r?`${a} - ${r}`:a||r?a||r:"Chưa cập nhật"},vt=(t,s)=>{if(t?.success&&t.data!==void 0)return t.data;const a=t?.error?.message||t?.message||s;throw new Error(a)},Br=(t={})=>{const s={};return t.search&&(s.search=t.search),t.sportType&&(s.sportType=t.sportType),t.location&&(s.location=t.location),typeof t.priceMin=="number"&&(s.priceMin=t.priceMin),typeof t.priceMax=="number"&&(s.priceMax=t.priceMax),typeof t.page=="number"&&(s.page=t.page),typeof t.pageSize=="number"&&(s.pageSize=t.pageSize),t.sortBy&&(s.sortBy=t.sortBy),t.sortDir&&(s.sortDir=t.sortDir),s},wt=(t,s)=>{if(t instanceof Error&&t.message)return t.message;if(typeof t=="object"&&t!==null){const a=t,r=a.response?.data?.error?.message||a.response?.data?.message;if(r)return r;if(a.message)return a.message}return s},ot=t=>{const s=Number(t);return Number.isFinite(s)?s:void 0},hs=t=>typeof t=="boolean"?t:void 0,ka=12,Qs=t=>{const s=Array.isArray(t.items)?t.items:[],a=t.meta?.pagination,r=ot(a?.total)??ot(t.total)??s.length,l=ot(a?.pageSize)??ot(t.pageSize)??(s.length>0?s.length:ka),d=ot(a?.page)??ot(t.page)??1,c=ot(a?.totalPages)??ot(t.totalPages),f=Math.max(0,r??0),j=Math.max(1,l??ka),o=Math.max(1,d??1),x=Math.max(1,Math.ceil(f/j)),i=Math.max(1,c??x),m=hs(a?.hasNext)??hs(t.hasNext)??o<i,b=hs(a?.hasPrev)??hs(t.hasPrev)??o>1,p={total:f,page:o,pageSize:j,totalPages:i,hasNext:m,hasPrev:b};return{...t,items:s,total:f,page:o,pageSize:j,totalPages:i,hasNext:m,hasPrev:b,meta:{...t.meta,pagination:p}}};async function nn(t={}){try{const{data:s}=await H.get("/fields",{params:Br(t)}),a=vt(s,"Không thể tải danh sách sân");return Qs(a)}catch(s){const a=wt(s,"Không thể tải danh sách sân");throw new Error(a)}}async function Xs(t){try{const{data:s}=await H.get(`/fields/${t}`);return vt(s,"Không thể tải thông tin sân")}catch(s){if(s.response?.status===404)return null;const r=wt(s,"Không thể tải thông tin sân");throw new Error(r)}}async function Rr(t,s){const a=new FormData;a.append("images",s);try{const{data:r}=await H.post(`/fields/${t}/images`,a);return vt(r,"Không thể tải ảnh sân")}catch(r){const l=wt(r,"Không thể tải ảnh sân");throw new Error(l)}}async function Sa(t,s){try{const{data:a}=await H.get(`/fields/${t}/availability`,{params:s?{date:s}:void 0});return vt(a,"Không thể tải lịch sân")}catch(a){const r=wt(a,"Không thể tải lịch sân");throw new Error(r)}}const ms=new Map,Kr=60*1e3;async function rn(t,s={}){const{forceRefresh:a=!1}=s,r=Date.now(),l=ms.get(t);if(!a&&l?.data&&l.expiresAt!==void 0&&l.expiresAt>r)return l.data;if(!a&&l?.promise)return l.promise;const d=(async()=>{try{const{data:c}=await H.get(`/fields/${t}/stats`),f=vt(c,"Không thể tải thông tin sân");return ms.set(t,{data:f,expiresAt:Date.now()+Kr,promise:void 0}),f}catch(c){if(ms.delete(t),c.response?.status===404)throw new Error("Sân không tồn tại");const j=wt(c,"Không thể tải thông tin sân");throw new Error(j)}})();return ms.set(t,{...l,promise:d}),d}async function Vr(t,s,a,r,l){try{const{data:d}=await H.get(`/fields/${t}/available-quantities`,{params:{playDate:s,startTime:a,endTime:r,...typeof l=="number"?{quantityId:l}:{}}});return vt(d,"Không thể tải danh sách sân trống")}catch(d){const c=wt(d,"Không thể tải danh sách sân trống");throw new Error(c)}}async function Or(t){try{const{data:s}=await H.get(`/fields/${t}/quantities`);return vt(s,"Không thể tải danh sách sân")}catch(s){const a=wt(s,"Không thể tải danh sách sân");throw new Error(a)}}function ln(t){return t?t.trim().replace(/\/+$/,""):""}const zr=ln("http://localhost:5050"),Hr=ln(Kn),Ur="ap-southeast-1";function Ca(t,s){const a=t.replace(/\/+$/,""),r=s.replace(/^\/+/,"");return a?`${a}/${r}`:`/${r}`}function Gr(t){return/^(?:[a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function Qr(t){if(!t?.bucket||!t?.key)return;const s=t.key.replace(/^\/+/,""),a=t.region?.trim()||Ur;return`https://${a==="us-east-1"?`${t.bucket}.s3.amazonaws.com`:`${t.bucket}.s3.${a}.amazonaws.com`}/${s}`}function Rt(t,s){const a=zr||Hr,r=typeof t=="string"?t.trim():"";if(r){if(Gr(r)||r.startsWith("data:"))return r;if(r.startsWith("/"))return a?Ca(a,r):r;const d=r.replace(/^\/+/,"");if(d)return Ca(a,d)}const l=Qr(s);if(l)return l;if(r)return r}const cn=({field:t})=>{const[s,a]=n.useState(t?.booking_count||0),[r,l]=n.useState(!1),d=Ze(t.sport_type),c=Dt(t.status),f=sn(t.status),j=t.status?t.status.toString().trim().toLowerCase():"",o=["active","available","open","trống"].includes(j),x=o?"Đặt sân":c;n.useEffect(()=>{(async()=>{try{l(!0);const k=await rn(t.field_code);a(k.booking_count||0)}catch(k){console.error("Error loading field stats:",k),a(t?.booking_count||0)}finally{l(!1)}})()},[t.field_code]);const i=_=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",minimumFractionDigits:0}).format(_),m=t.images?.[0],b=Rt(m?.image_url,m?.storage),p=Bt(t),w=an(t.shop),g=_=>_.includes("available")||_.includes("active")||_.includes("open")?"bg-green-100 text-green-700 border border-green-200":_.includes("busy")||_.includes("occupied")?"bg-orange-100 text-orange-700 border border-orange-200":"bg-gray-100 text-gray-700 border border-gray-200";return e.jsxs("div",{className:"group relative bg-white rounded-2xl overflow-hidden shadow-md hover:shadow-2xl transition-all duration-500 transform hover:-translate-y-2",children:[e.jsxs("div",{className:"relative h-56 overflow-hidden bg-gradient-to-br from-green-50 to-green-100",children:[b?e.jsx("img",{src:b,alt:t.field_name,className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-700"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-green-100 to-green-200",children:e.jsx(Wt,{className:"w-20 h-20 text-green-300"})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"}),e.jsx("div",{className:"absolute top-4 left-4",children:e.jsx("span",{className:"inline-flex items-center px-4 py-2 rounded-full text-sm font-semibold bg-white/95 backdrop-blur-sm text-green-700 shadow-lg",children:d})}),e.jsx("div",{className:"absolute top-4 right-4",children:e.jsxs("span",{className:`inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-semibold ${g(f)} backdrop-blur-sm shadow-lg`,children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${o?"bg-green-500":"bg-gray-400"} animate-pulse`}),c]})}),s>0&&e.jsxs("div",{className:"absolute bottom-4 left-4 flex items-center gap-2 px-3 py-2 rounded-lg bg-white/95 backdrop-blur-sm shadow-lg",children:[e.jsx(It,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm font-semibold text-gray-800",children:r?"...":`${s} lượt đặt`})]})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 line-clamp-1 group-hover:text-green-600 transition-colors duration-300",children:t.field_name}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3 text-gray-600",children:[e.jsx(ns,{className:"w-5 h-5 text-green-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-sm leading-relaxed line-clamp-2",children:t.address})]}),e.jsxs("div",{className:"flex items-center gap-3 text-gray-600",children:[e.jsx(Se,{className:"w-5 h-5 text-green-500 flex-shrink-0"}),e.jsxs("span",{className:"text-sm",children:["Giờ mở cửa:"," ",e.jsx("span",{className:"font-semibold text-gray-800",children:w})]})]})]}),e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-green-200 to-transparent"}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Giá thuê"}),e.jsxs("span",{className:"text-2xl font-bold bg-gradient-to-r from-green-600 to-green-500 bg-clip-text text-transparent",children:[i(p),e.jsx("span",{className:"text-sm font-normal text-gray-600",children:"/giờ"})]})]}),e.jsx(ke,{to:`/fields/${t.field_code}`,className:`
              relative px-6 py-3 rounded-xl font-semibold text-sm
              transition-all duration-300 transform
              ${o?"bg-gradient-to-r from-green-500 to-green-600 text-white shadow-lg shadow-green-500/30 hover:shadow-xl hover:shadow-green-500/40 hover:scale-105 active:scale-95":"bg-gray-200 text-gray-500 cursor-not-allowed pointer-events-none"}
            `,"aria-disabled":!o,children:x})]})]}),e.jsx("div",{className:"absolute bottom-0 right-0 w-32 h-32 bg-gradient-to-tl from-green-50 to-transparent opacity-50 rounded-tl-full transform translate-x-16 translate-y-16 group-hover:scale-150 transition-transform duration-700"})]})},Le=(t,s)=>{if(t?.success&&t.data!==void 0)return t.data;const a=t?.error?.message||t?.message||s;throw new Error(a)},ks=t=>Array.isArray(t)?t:Array.isArray(t.items)?t.items:Array.isArray(t.data)?t.data:Array.isArray(t.rows)?t.rows:[],_t=t=>t&&typeof t=="object"&&!Array.isArray(t)&&"items"in t?t.items:t&&typeof t=="object"&&!Array.isArray(t)&&"data"in t?t.data:t&&typeof t=="object"&&!Array.isArray(t)&&"rows"in t?t.rows:t,Ae=(t,s)=>{if(t instanceof Error&&t.message)return t.message;if(typeof t=="object"&&t!==null){const a=t,r=a.response?.data?.error?.message||a.response?.data?.message||a.message;if(r)return r}return s};async function Xr(t){try{const{data:s}=await H.post("/shops/requests",t);return Le(s,"Không thể gửi yêu cầu")}catch(s){throw new Error(Ae(s,"Không thể gửi yêu cầu"))}}async function jt(){try{const{data:t}=await H.get("/shops/me"),s=Le(t,"Không thể tải thông tin shop của bạn.");return _t(s)??null}catch(t){throw new Error(Ae(t,"Không thể tải thông tin shop của bạn."))}}async function Yr(t){try{const s={...t};s.opening_time===void 0&&delete s.opening_time,s.closing_time===void 0&&delete s.closing_time,s.is_open_24h===void 0&&delete s.is_open_24h;const{data:a}=await H.put("/shops/me",s),r=Le(a,"Không thể cập nhật thông tin shop.");return _t(r)}catch(s){throw new Error(Ae(s,"Không thể cập nhật thông tin shop."))}}const Zr=(t={})=>{const s={};return typeof t.page=="number"&&(s.page=t.page),typeof t.pageSize=="number"&&(s.pageSize=t.pageSize),t.search&&(s.search=t.search),t.status&&(s.status=t.status),s};async function Ys(t,s){try{const a=t?`/shops/${t}/fields`:"/shops/me/fields",{data:r}=await H.get(a,{params:Zr(s)}),l=Le(r,"Không thể tải danh sách sân.");if(Array.isArray(l)){const d=ks(l);return Qs({items:d,total:d.length,page:1,pageSize:d.length||1,facets:{sportTypes:[],locations:[]},summary:void 0})}return Qs(l)}catch(a){throw new Error(Ae(a,"Không thể tải danh sách sân."))}}async function Wr(t,s){if(!Number.isFinite(t))throw new Error("Thiếu mã shop để tạo sân mới.");try{const a=new FormData;a.append("field_name",s.field_name),a.append("sport_type",s.sport_type),a.append("price_per_hour",String(s.price_per_hour??0)),a.append("address",s.address),s.status&&a.append("status",s.status),s.quantityCount&&a.append("quantity_count",String(s.quantityCount)),(s.images??[]).forEach(c=>{a.append("images",c)});const{data:r}=await H.post(`/shops/${t}/fields`,a),l=Le(r,"Không thể tạo sân mới."),d=_t(l);if(!d)throw new Error("Không nhận được dữ liệu sân sau khi tạo.");return d}catch(a){throw new Error(Ae(a,"Không thể tạo sân mới."))}}async function Jr(t,s){if(!Number.isFinite(t))return null;try{const{data:a}=await H.put(`/shops/me/fields/${t}`,s),r=Le(a,"Không thể cập nhật thông tin sân.");return _t(r)??null}catch(a){throw new Error(Ae(a,"Không thể cập nhật thông tin sân."))}}async function el(t,s){if(!Number.isFinite(t))return null;try{const{data:a}=await H.patch(`/shops/me/fields/${t}/status`,{status:s}),r=Le(a,"Không thể cập nhật trạng thái sân.");return _t(r)??null}catch(a){throw new Error(Ae(a,"Không thể cập nhật trạng thái sân."))}}async function tl(t){if(!Number.isFinite(t))return null;try{const{data:s}=await H.delete(`/shops/me/fields/${t}`);return Le(s,"Không thể xoá sân.")}catch(s){throw new Error(Ae(s,"Không thể xoá sân."))}}async function Ta(){try{const{data:t}=await H.get("/shops/me/bookings"),s=Le(t,"Không thể tải danh sách đơn đặt của shop.");return ks(s)}catch(t){throw new Error(Ae(t,"Không thể tải danh sách đơn đặt của shop."))}}async function sl(){try{const{data:t}=await H.get("/shops/me/bank-accounts"),s=Le(t,"Không thể tải danh sách tài khoản ngân hàng.");return ks(s)}catch(t){throw new Error(Ae(t,"Không thể tải danh sách tài khoản ngân hàng."))}}const na=t=>({pricing_id:t.pricing_id||t.PricingID||t.id,field_code:t.field_code||t.FieldCode||t.fieldId,day_of_week:t.day_of_week||t.DayOfWeek||t.dayOfWeek,start_time:t.start_time||t.StartTime||t.startTime,end_time:t.end_time||t.EndTime||t.endTime,created_at:t.created_at||t.CreateAt||t.createdAt,updated_at:t.updated_at||t.UpdateAt||t.updatedAt});async function al(t){if(!Number.isFinite(t))return[];try{console.log(`Fetching operating hours for field ${t}`);const{data:s}=await H.get(`/shops/me/fields/${t}/pricing`);console.log(`API response for field ${t}:`,s);const a=Le(s,"Không thể tải dữ liệu giờ hoạt động."),r=ks(a);console.log(`Normalized list for field ${t}:`,r);const l=r.map(d=>na(d));return console.log(`Final result for field ${t}:`,l),l}catch(s){throw console.error(`Error fetching operating hours for field ${t}:`,s),new Error(Ae(s,"Không thể tải dữ liệu giờ hoạt động."))}}async function nl(t){if(!Number.isFinite(t.field_code))throw new Error("Field code không hợp lệ.");try{const s=Number(t.field_code),a=Number(t.day_of_week),r=(t.start_time||"").trim(),l=(t.end_time||"").trim();if(!Number.isFinite(s))throw new Error("Field code không hợp lệ.");if(!Number.isInteger(a)||a<0||a>6)throw new Error("Thứ trong tuần không hợp lệ (0-6).");if(!r||!l)throw new Error("Giờ bắt đầu/kết thúc không được để trống.");if(!/^\d{2}:\d{2}$/.test(r)||!/^\d{2}:\d{2}$/.test(l))throw new Error("Định dạng giờ không hợp lệ. Vui lòng dùng HH:MM.");const d={field_code:s,day_of_week:a,start_time:r,end_time:l};console.log("Attempting to create operating hours with payload:",d);const{data:c}=await H.post(`/shops/me/fields/${s}/pricing`,d),f=Le(c,"Không thể tạo giờ hoạt động mới."),j=_t(f);return na(j)}catch(s){throw console.error("Create operating hours error:",s),new Error(Ae(s,"Không thể tạo giờ hoạt động mới."))}}async function rl(t,s){if(!Number.isFinite(t))throw new Error("Pricing ID không hợp lệ.");try{const a=Object.fromEntries(Object.entries(s).filter(([f,j])=>j!==void 0)),r={...a};if(a.day_of_week!==void 0){const f=Number(a.day_of_week);if(!Number.isInteger(f)||f<0||f>6)throw new Error("Thứ trong tuần không hợp lệ (0-6).");r.day_of_week=f}if(a.start_time!==void 0){const f=String(a.start_time||"").trim();if(!f)throw new Error("Giờ bắt đầu không được để trống.");if(!/^\d{2}:\d{2}$/.test(f))throw new Error("Định dạng giờ bắt đầu không hợp lệ (HH:MM).");r.start_time=f}if(a.end_time!==void 0){const f=String(a.end_time||"").trim();if(!f)throw new Error("Giờ kết thúc không được để trống.");if(!/^\d{2}:\d{2}$/.test(f))throw new Error("Định dạng giờ kết thúc không hợp lệ (HH:MM).");r.end_time=f}const{data:l}=await H.put(`/shops/me/pricing/${t}`,r),d=Le(l,"Không thể cập nhật giờ hoạt động."),c=_t(d);return na(c)}catch(a){throw new Error(Ae(a,"Không thể cập nhật giờ hoạt động."))}}async function ll(t){if(!Number.isFinite(t))throw new Error("Pricing ID không hợp lệ.");try{const{data:s}=await H.delete(`/shops/me/pricing/${t}`);return Le(s,"Không thể xóa giờ hoạt động.")}catch(s){throw new Error(Ae(s,"Không thể xóa giờ hoạt động."))}}const il=[{icon:ss,title:"Tối ưu tỷ lệ lấp sân",description:"Thu hút khách mới nhờ chiến dịch marketing có sẵn."},{icon:nt,title:"Quy trình minh bạch",description:"Theo dõi trạng thái duyệt hồ sơ ngay trên dashboard."},{icon:sr,title:"Quản lý tập trung",description:"Đồng bộ lịch sân, báo cáo doanh thu, chiết khấu rõ ràng."}],cl=[{icon:yr,label:"Hotline",value:"0866 845 867",hint:"08:00 - 22:00 (T2-T7)"},{icon:Nt,label:"Email hỗ trợ",value:"thuere2004",hint:"Phản hồi trong 24h"}],ol=["Gửi form đăng ký và mô tả thông tin sân","Đội ngũ kiểm duyệt liên hệ xác thực","Bàn giao tài khoản quản lý và hướng dẫn","Bắt đầu nhận đơn đặt sân trên hệ thống"],dl=()=>{const[t,s]=n.useState(!1),[a,r]=n.useState(!1),[l,d]=n.useState(""),{register:c,handleSubmit:f,reset:j,formState:{errors:o}}=yt(),x=async i=>{r(!0),d("");try{await Xr(i),s(!0),j(),setTimeout(()=>{s(!1)},3e3)}catch(m){d(m?.message||"Không thể gửi yêu cầu. Vui lòng thử lại sau.")}finally{r(!1)}};return e.jsxs("div",{className:"relative isolate overflow-hidden bg-slate-950 py-16 sm:py-20",children:[e.jsxs("div",{className:"absolute inset-0 -z-10 opacity-60",children:[e.jsx("div",{className:"absolute inset-y-0 left-1/2 w-[140%] -translate-x-1/2 bg-[radial-gradient(circle_at_top,_rgba(16,185,129,0.35),_transparent_60%)] blur-3xl"}),e.jsx("div",{className:"absolute inset-y-0 right-1/3 w-[80%] bg-[radial-gradient(circle_at_top,_rgba(59,130,246,0.25),_transparent_55%)] blur-3xl"})]}),e.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"text-center text-white mb-10",children:[e.jsxs("p",{className:"inline-flex items-center gap-2 rounded-full border border-white/20 px-4 py-1 text-xs font-semibold uppercase tracking-[0.2em] text-white/90",children:[e.jsx(ss,{className:"h-4 w-4 text-emerald-300"}),"Đối tác sân thể thao"]}),e.jsx("h2",{className:"mt-6 text-4xl font-bold tracking-tight sm:text-5xl",children:"Đăng ký mở Shop và bắt đầu nhận đơn trong vài bước"}),e.jsx("p",{className:"mt-4 text-base text-white/70 max-w-3xl mx-auto",children:"Điền thông tin cơ bản, đội ngũ ThueRe sẽ đồng hành cùng bạn trong suốt hành trình số hóa quản lý sân và tối ưu hiệu suất hoạt động."})]}),e.jsxs("div",{className:"grid gap-8 lg:grid-cols-[1.1fr_0.9fr]",children:[e.jsxs("section",{className:"rounded-3xl border border-white/10 bg-white/5 p-8 text-white shadow-[0_25px_80px_rgba(15,23,42,0.4)] backdrop-blur-xl",children:[e.jsx("div",{className:"mt-10 space-y-5",children:il.map(({icon:i,title:m,description:b},p)=>e.jsxs("div",{className:"flex gap-4 rounded-2xl border border-white/10 bg-white/5 px-5 py-4",children:[e.jsx("div",{className:"mt-1 flex h-11 w-11 items-center justify-center rounded-2xl border border-white/10 bg-slate-900/40 text-emerald-200",children:e.jsx(i,{className:"h-5 w-5","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-lg",children:m}),e.jsx("p",{className:"text-sm text-white/70",children:b}),e.jsxs("p",{className:"text-xs text-white/40 mt-1",children:["Bước ",String(p+1).padStart(2,"0")]})]})]},m))}),e.jsxs("div",{className:"mt-10 rounded-2xl border border-white/10 bg-white/5 p-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-white",children:"Quy trình duyệt chi tiết"}),e.jsx("ol",{className:"mt-4 space-y-4 text-sm text-white/80",children:ol.map((i,m)=>e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"flex h-7 w-7 flex-shrink-0 items-center justify-center rounded-full bg-emerald-400/20 text-sm font-semibold text-emerald-200",children:m+1}),e.jsx("p",{children:i})]},i))}),e.jsx("div",{className:"mt-6 grid gap-4 sm:grid-cols-2",children:cl.map(({icon:i,label:m,value:b,hint:p})=>e.jsxs("div",{className:"rounded-xl border border-white/10 bg-slate-900/40 p-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-slate-800/70 text-emerald-200",children:e.jsx(i,{className:"h-5 w-5","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-white/70",children:m}),e.jsx("p",{className:"text-base font-semibold text-white",children:b})]})]}),e.jsx("p",{className:"mt-3 text-xs uppercase tracking-widest text-white/40",children:p})]},m))})]})]}),e.jsxs("section",{className:"relative rounded-3xl bg-white p-8 shadow-2xl shadow-emerald-900/20",children:[e.jsx("div",{className:"absolute inset-x-10 -top-8 z-10 flex justify-center",children:e.jsxs("div",{className:"inline-flex items-center gap-3 rounded-2xl border border-emerald-100 bg-gradient-to-r from-emerald-50 to-white px-6 py-3 text-sm font-medium text-emerald-700 shadow-lg shadow-emerald-100/60",children:[e.jsx("span",{className:"flex h-9 w-9 items-center justify-center rounded-xl bg-emerald-600/10 text-xs font-semibold uppercase tracking-widest text-emerald-600",children:"TR"}),"Đối tác mới đăng ký mỗi ngày"]})}),e.jsxs("div",{className:"pt-6",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.4em] text-emerald-500",children:"Bắt đầu ngay"}),e.jsx("h3",{className:"mt-3 text-3xl font-bold text-slate-900",children:"Form đăng ký mở Shop"}),e.jsx("p",{className:"mt-2 text-sm text-slate-500",children:"Chúng tôi sẽ liên hệ trong 24h để xác nhận và hướng dẫn các bước tiếp theo."})]}),t&&e.jsx("div",{className:"mt-6 rounded-2xl border border-emerald-100 bg-emerald-50/70 p-4 text-emerald-900 shadow-inner",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"flex h-9 w-9 items-center justify-center rounded-full bg-emerald-500 text-white",children:e.jsx(nt,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Gửi yêu cầu thành công"}),e.jsx("p",{className:"text-sm",children:"Đội ngũ hỗ trợ sẽ phản hồi qua email hoặc điện thoại trong vòng 24 giờ làm việc."})]})]})}),!!l&&e.jsxs("div",{className:"mt-6 flex items-start gap-3 rounded-2xl border border-red-200 bg-red-50 p-4 text-red-700",children:[e.jsx("span",{className:"flex h-9 w-9 items-center justify-center rounded-full bg-red-100 text-red-600",children:e.jsx(Ce,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Không thể gửi yêu cầu"}),e.jsx("p",{className:"text-sm",children:l})]})]}),e.jsxs("form",{onSubmit:f(x),className:"mt-6 space-y-5",children:[e.jsxs("div",{className:"grid gap-5 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-slate-700",children:e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(ws,{className:"h-4 w-4 text-emerald-500"}),"Họ và tên"]})}),e.jsx("div",{className:"relative",children:e.jsx("input",{type:"text",...c("full_name",{required:"Vui lòng nhập họ và tên",minLength:{value:2,message:"Họ tên phải có ít nhất 2 ký tự"}}),className:"input pr-12",placeholder:"Nguyễn Văn A"})}),o.full_name&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:o.full_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-slate-700",children:e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(Nt,{className:"h-4 w-4 text-emerald-500"}),"Email"]})}),e.jsx("input",{type:"email",...c("email",{required:"Vui lòng nhập email",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Email không hợp lệ"}}),className:"input",placeholder:"thuere2004@gmail.com"}),o.email&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:o.email.message})]})]}),e.jsxs("div",{className:"grid gap-5 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-slate-700",children:e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(rs,{className:"h-4 w-4 text-emerald-500"}),"Số điện thoại"]})}),e.jsx("input",{type:"tel",...c("phone_number",{required:"Vui lòng nhập số điện thoại",pattern:{value:/^[0-9]{10,11}$/,message:"Số điện thoại phải có 10-11 chữ số"}}),className:"input",placeholder:"09xx xxx xxx"}),o.phone_number&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:o.phone_number.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-slate-700",children:e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(ns,{className:"h-4 w-4 text-emerald-500"}),"Địa chỉ sân"]})}),e.jsx("input",{type:"text",...c("address",{required:"Vui lòng nhập địa chỉ",minLength:{value:10,message:"Địa chỉ phải có ít nhất 10 ký tự"}}),className:"input",placeholder:"Đường, quận/huyện..."}),o.address&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:o.address.message})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label text-slate-700 inline-flex items-center gap-2",children:[e.jsx(fr,{className:"h-4 w-4 text-emerald-500"}),"Giới thiệu ngắn gọn về sân"]}),e.jsx("textarea",{rows:5,...c("message",{minLength:{value:20,message:"Tin nhắn phải có ít nhất 20 ký tự"}}),className:"input",placeholder:"Loại sân, số lượng sân, tình trạng đặt sân hiện tại, các khung giờ trống..."}),o.message&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:o.message.message})]}),e.jsx("button",{type:"submit",disabled:a,className:"btn-primary input bg-gradient-to-r from-emerald-500 to-blue-500 text-base font-semibold text-white shadow-lg shadow-emerald-200/60 transition hover:from-emerald-600 hover:to-blue-600 disabled:cursor-not-allowed disabled:opacity-70",children:a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-5 w-5 animate-spin rounded-full border-2 border-white border-t-transparent"}),e.jsx("span",{children:"Đang gửi..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Zt,{className:"h-5 w-5"}),e.jsx("span",{children:"Gửi yêu cầu hợp tác"})]})})]})]})]})]})]})},hl=()=>{const[t,s]=n.useState([]),[a,r]=n.useState(!1),[l,d]=n.useState("");n.useEffect(()=>{let o=!1;return(async()=>{r(!0),d("");const x={page:1,pageSize:6,sortBy:"rating",sortDir:"desc"};try{const{items:i}=await nn(x);o||s(i)}catch(i){o||(d(i?.message||"Không thể tải danh sách sân nổi bật."),s([]))}finally{o||r(!1)}})(),()=>{o=!0}},[]);const c=[{icon:_r,title:"Đối tác uy tín",description:"100% sân đã được đội ngũ kiểm duyệt chất lượng, cơ sở vật chất, phòng thay đồ và hệ thống chiếu sáng.",image:"https://images.pexels.com/photos/46798/the-ball-stadion-football-the-pitch-46798.jpeg"},{icon:ss,title:"Trải nghiệm liền mạch",description:"Tra cứu lịch trống, đặt sân, thanh toán – tất cả trong một giao diện thống nhất.",image:"https://images.pexels.com/photos/358042/pexels-photo-358042.jpeg"},{icon:Wa,title:"Ưu đãi độc quyền",description:"Combo giờ thấp điểm, mã giảm giá hàng tuần và chương trình thân thiết giúp đội bạn tối ưu chi phí.",image:"https://images.pexels.com/photos/1103829/pexels-photo-1103829.jpeg"}],f=[{label:"Bóng đá sân 7",meta:"Mặt cỏ nhân tạo, có đèn đêm",to:"/fields?sportType=football"},{label:"Cầu lông trong nhà",meta:"Sàn gỗ chuẩn thi đấu, phòng lạnh",to:"/fields?sportType=badminton"},{label:"Tennis ngoài trời",meta:"Hệ thống đèn LED tiêu chuẩn",to:"/fields?sportType=tennis"},{label:"Bóng rổ cộng đồng",meta:"Sân outdoor, đặt nhanh theo giờ",to:"/fields?sportType=basketball"},{label:"Bơi & Fitness",meta:"Gói thành viên linh hoạt",to:"/fields?sportType=swimming"}],j=[{step:"01",title:"Tìm sân phù hợp",description:"Lọc theo môn, vị trí, khung giờ và giá để cân đối đội hình và ngân sách."},{step:"02",title:"Giữ lịch tức thì",description:"Xem lịch trống theo thời gian thực, giữ chỗ online và nhận xác nhận qua email."},{step:"03",title:"Tận hưởng trận đấu",description:"Check-in bằng mã CODE, nhận hỗ trợ từ đội ngũ chăm sóc và tích điểm thưởng mỗi lần chơi."}];return e.jsxs("div",{className:"page",children:[e.jsxs("section",{className:"hero",children:[e.jsx("div",{className:"hero-pattern"}),e.jsx("div",{className:"hero-inner hero-grid",children:e.jsxs("div",{className:"hero-copy",children:[e.jsx("span",{className:"hero-eyebrow",children:"Nền tảng đặt sân thể thao"}),e.jsxs("h1",{className:"hero-title",children:["Sẵn sàng cho trận đấu"," ",e.jsx("span",{className:"hero-highlight",children:"mọi lúc"}),",",e.jsx("span",{className:"hero-highlight",children:" mọi nơi"}),"."]}),e.jsx("p",{className:"hero-subtitle",children:"Chọn sân phù hợp, giữ vị trí đẹp và hoàn tất thanh toán chỉ trong vài thao tác. Đội của bạn sẽ luôn có mặt sân hoàn hảo cho mỗi cuộc hẹn."}),e.jsxs("div",{className:"hero-actions",children:[e.jsx(ke,{to:"/fields",className:"hero-cta",children:e.jsxs("span",{className:"inline-flex items-center",children:["Tìm sân ngay",e.jsx(Ps,{className:"w-5 h-5 ml-2"})]})}),e.jsx("a",{href:"#shop-form",className:"hero-ghost",children:"Trở thành đối tác sân"})]}),e.jsxs("div",{className:"hero-badges",children:[e.jsxs("div",{className:"hero-badge",children:[e.jsx(Cr,{className:"w-4 h-4"}),"Giữ lịch tức thời"]}),e.jsxs("div",{className:"hero-badge",children:[e.jsx(ss,{className:"w-4 h-4"}),"Ưu đãi độc quyền hằng tuần"]})]})]})})]}),e.jsxs("section",{className:"home-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("span",{className:"section-eyebrow",children:"Vì sao chọn chúng tôi?"}),e.jsx("h2",{className:"section-title",children:"Nền tảng đặt sân được tín nhiệm bởi hàng nghìn đội bóng, câu lạc bộ và doanh nghiệp."})]}),e.jsx("div",{className:"feature-grid",children:c.map(o=>e.jsxs("article",{className:"feature-card",style:{backgroundImage:`url(${o.image})`},children:[e.jsx("div",{className:"feature-icon",children:o.icon?e.jsx(o.icon,{className:"w-5 h-5"}):null}),e.jsxs("div",{children:[e.jsx("h3",{className:"feature-title",children:o.title}),e.jsx("p",{className:"feature-description",children:o.description})]})]},o.title))})]}),e.jsxs("section",{className:"home-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("span",{className:"section-eyebrow",children:"Danh mục hot"}),e.jsx("h2",{className:"section-title",children:"Khám phá các bộ môn được đặt nhiều trong tuần này"})]}),e.jsx("div",{className:"categories-scroll",children:f.map(o=>e.jsxs(ke,{to:o.to,className:"category-pill",children:[e.jsx("div",{className:"category-label",children:o.label}),e.jsx("div",{className:"category-meta",children:o.meta})]},o.label))})]}),e.jsxs("section",{className:"home-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("span",{className:"section-eyebrow",children:"Sân được yêu thích"}),e.jsx("div",{className:"section-actions",children:e.jsxs(ke,{to:"/fields",className:"btn-link inline-flex items-center",children:["Xem tất cả ",e.jsx(Ps,{className:"w-4 h-4 ml-1"})]})}),e.jsx("h2",{className:"section-title",children:"Những sân đang được đặt lịch – bạn nên giữ chỗ sớm!"})]}),e.jsx("div",{className:"featured-grid",children:a?e.jsx("div",{className:"col-span-full text-center text-gray-500",children:"Đang tải sân nổi bật..."}):l?e.jsx("div",{className:"col-span-full text-center text-red-600",children:l}):t.length>0?t.map(o=>e.jsx(cn,{field:o},o.field_code)):e.jsx("div",{className:"col-span-full text-center text-gray-500",children:"Chưa có sân nổi bật để hiển thị."})})]}),e.jsxs("section",{className:"home-section workflow-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("span",{className:"section-eyebrow",children:"Đặt sân trong 3 bước"}),e.jsx("h2",{className:"section-title",children:"Quy trình tối giản giúp bạn dành thời gian cho trận đấu thay vì việc quản lý."})]}),e.jsx("div",{className:"workflow-grid",children:j.map(o=>e.jsxs("div",{className:"workflow-step",children:[e.jsx("div",{className:"workflow-step-number",children:o.step}),e.jsxs("div",{className:"workflow-step-body",children:[e.jsx("h3",{className:"workflow-step-title",children:o.title}),e.jsx("p",{className:"workflow-step-description",children:o.description})]})]},o.step))})]}),e.jsx("section",{className:"home-section shop-invite",children:e.jsxs("div",{className:"shop-invite-content",children:[e.jsxs("div",{children:[e.jsx("span",{className:"section-eyebrow text-white/80",children:"Dành cho chủ sân & quản lý cụm sân"}),e.jsx("h2",{className:"shop-invite-title",children:"Tăng tỷ lệ lấp đầy & quản lý lịch thông minh chỉ với một bảng điều khiển"}),e.jsx("p",{className:"shop-invite-subtitle",children:"Đăng ký miễn phí, nhận hỗ trợ và cùng hàng trăm đối tác xây dựng trải nghiệm thể thao đẳng cấp."})]}),e.jsxs("a",{href:"#shop-form",className:"shop-invite-button",children:["Gửi yêu cầu hợp tác",e.jsx(Ps,{className:"w-4 h-4"})]})]})}),e.jsx("section",{id:"shop-form",className:"home-section shop-form-wrapper",children:e.jsx("div",{className:"shop-form-card",children:e.jsx(dl,{})})})]})},ml=()=>{const[t,s]=n.useState(!1),[a,r]=n.useState(""),[l,d]=n.useState(!1),{login:c}=Oe(),f=We(),j=ys(),{register:o,handleSubmit:x,formState:{errors:i}}=yt({mode:"onChange"}),m=async b=>{r(""),d(!0);try{if(await c(b.email.trim(),b.password)){const w=j.state?.from?.pathname||"/",g=j.state?.carry;f(w,{replace:!0,state:g})}}catch(p){r(p?.message||"Email hoặc mật khẩu không chính xác")}finally{d(!1)}};return e.jsxs("div",{className:"hero min-h-screen flex items-center justify-center py-12 px-4",children:[e.jsx("div",{className:"hero-pattern"}),e.jsxs("div",{className:"max-w-md w-full relative space-y-6",children:[e.jsxs("div",{className:"hero-card p-8",children:[e.jsx("div",{className:"hero-card-header mb-6",children:e.jsxs("div",{className:"shop-brand mb-4",children:[e.jsx("div",{className:"shop-brand-logo bg-[var(--brand-600)] text-white",children:e.jsx(Vs,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"hero-card-title",children:"Đăng nhập"}),e.jsx("p",{className:"hero-card-subtitle",children:"Chào mừng trở lại"})]})]})}),e.jsxs("form",{onSubmit:x(m),className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"label text-white/80",children:[e.jsx(Nt,{className:"w-4 h-4 inline mr-2"}),"Email"]}),e.jsx("input",{type:"email",...o("email",{required:"Vui lòng nhập email",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Email không hợp lệ"}}),className:"input",placeholder:"Nhập email của bạn",autoComplete:"username"}),i.email&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:i.email.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label text-white/80",children:[e.jsx(At,{className:"w-4 h-4 inline mr-2"}),"Mật khẩu"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:t?"text":"password",...o("password",{required:"Vui lòng nhập mật khẩu",minLength:{value:6,message:"Mật khẩu phải có ít nhất 6 ký tự"}}),className:"input",placeholder:"Nhập mật khẩu của bạn",autoComplete:"current-password"}),e.jsx("button",{type:"button",onClick:()=>s(!t),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700",children:t?e.jsx(Jt,{className:"w-5 h-5"}):e.jsx(qt,{className:"w-5 h-5"})})]}),i.password&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:i.password.message})]}),a&&e.jsx("div",{className:"bg-red-900/30 border border-red-500/50 rounded-lg p-3",children:e.jsx("p",{className:"text-red-300 text-sm",children:a})}),e.jsx("button",{type:"submit",disabled:l,className:"btn-primary w-full",children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Đang đăng nhập..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Vs,{className:"w-5 h-5"}),e.jsx("span",{children:"Đăng nhập"})]})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(ke,{to:"/forgot",className:"hero-shortcut",children:[e.jsx("div",{className:"hero-shortcut-icon",children:e.jsx(mr,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-white",children:"Quên mật khẩu?"}),e.jsx("span",{className:"text-sm text-white/70",children:"Nhấn để đặt lại"})]})]}),e.jsxs(ke,{to:"/register",className:"hero-shortcut",children:[e.jsx("div",{className:"hero-shortcut-icon",children:e.jsx(Hs,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-white",children:"Chưa có tài khoản?"}),e.jsx("span",{className:"text-sm text-white/70",children:"Đăng ký ngay"})]})]})]})]})]})},xl=60,ul=()=>{const[t,s]=n.useState(!1),[a,r]=n.useState(!1),[l,d]=n.useState(""),[c,f]=n.useState(!1),[j,o]=n.useState("idle"),[x,i]=n.useState(""),[m,b]=n.useState(""),[p,w]=n.useState(0),[g,_]=n.useState(""),{register:k,loading:u}=Oe(),M=We(),{register:U,handleSubmit:J,watch:V,formState:{errors:R,isValid:P},getValues:F,resetField:D}=yt({mode:"onChange"}),G=V("password"),N=V("confirmPassword"),q=V("email");n.useEffect(()=>{if(p<=0)return;const O=setInterval(()=>w(re=>Math.max(0,re-1)),1e3);return()=>clearInterval(O)},[p]),n.useEffect(()=>{(j==="verified"||j==="sent")&&(o("idle"),i(""),b(""),_(""))},[G,N]),n.useEffect(()=>{(j==="verified"||j==="sent")&&(o("idle"),i(""),b(""),_(""))},[q]);const y=n.useMemo(()=>{const re=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i.test(String(q??"")),te=!!G&&!!N&&N===G&&!R.password&&!R.confirmPassword;return re&&te&&p===0&&j!=="verified"},[q,G,N,R.password,R.confirmPassword,p,j]),L=async()=>{if(_(""),b(""),!!y)try{o("sending");const{data:O}=await H.post("/auth/send-code",{email:F("email")});if(!O?.success)throw new Error(O?.message||"Không gửi được mã. Thử lại.");o("sent"),w(xl),_("Đã gửi mã xác minh đến email của bạn.")}catch(O){o("idle");const re=O?.response?.data?.message||O?.message||"Có lỗi xảy ra khi gửi mã.";_(re)}},v=async()=>{if(b(""),_(""),!x||x.length<4){b("Vui lòng nhập mã hợp lệ.");return}try{o("verifying");const{data:O}=await H.post("/auth/verify-code",{email:F("email"),code:x});if(!O?.success)throw new Error(O?.message||"Mã xác minh không đúng hoặc đã hết hạn.");o("verified"),_("Xác minh email thành công!")}catch(O){o("sent");const re=O?.response?.data?.message||O?.message||"Xác minh thất bại, vui lòng thử lại.";b(re)}},B=async O=>{if(d(""),j!=="verified"){d("Vui lòng xác minh email trước khi đăng ký.");return}if(!O.confirmPassword||O.confirmPassword!==O.password){d("Mật khẩu xác nhận không khớp hoặc chưa nhập.");return}const{confirmPassword:re,...te}=O;await k(te)?(f(!0),D("password"),D("confirmPassword"),i(""),o("idle"),setTimeout(()=>{M("/login")},2e3)):d("Email đã được sử dụng hoặc có lỗi xảy ra")};return c?e.jsxs("div",{className:"hero min-h-screen flex items-center justify-center py-12 px-4",children:[e.jsx("div",{className:"hero-pattern"}),e.jsxs("div",{className:"hero-card p-8 max-w-md w-full text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(nt,{className:"w-12 h-12 text-green-400"})}),e.jsx("h2",{className:"hero-card-title mb-2",children:"Đăng ký thành công!"}),e.jsx("p",{className:"text-white/70 mb-6",children:"Bạn sẽ được chuyển hướng đến trang đăng nhập trong giây lát."}),e.jsx("div",{className:"flex justify-center",children:e.jsx(gl,{})})]})]}):e.jsxs("div",{className:"hero min-h-screen flex items-center justify-center py-12 px-4",children:[e.jsx("div",{className:"hero-pattern"}),e.jsxs("div",{className:"max-w-xl w-full relative space-y-6",children:[e.jsxs("div",{className:"hero-card p-8",children:[e.jsx("div",{className:"hero-card-header mb-6",children:e.jsxs("div",{className:"shop-brand mb-4",children:[e.jsx("div",{className:"shop-brand-logo bg-[var(--accent-500)] text-white",children:e.jsx(Hs,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"hero-card-title",children:"Đăng ký tài khoản"}),e.jsx("p",{className:"hero-card-subtitle",children:"Tạo tài khoản khách hàng của bạn"})]})]})}),e.jsxs("form",{className:"space-y-6",onSubmit:J(B),children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"label text-white/80",children:[e.jsx(ws,{className:"w-4 h-4 inline mr-2"}),"Họ tên"]}),e.jsx("input",{type:"text",...U("user_name",{required:"Vui lòng nhập họ tên",minLength:{value:2,message:"Ít nhất 2 ký tự"}}),className:"input",placeholder:"Nhập họ tên của bạn"}),R.user_name&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:R.user_name.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label text-white/80",children:[e.jsx(Nt,{className:"w-4 h-4 inline mr-2"}),"Email"]}),e.jsx("input",{type:"email",...U("email",{required:"Vui lòng nhập email",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Email không hợp lệ"}}),className:"input",placeholder:"Nhập email của bạn",autoComplete:"email"}),R.email&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:R.email.message})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"label text-white/80",children:[e.jsx(At,{className:"w-4 h-4 inline mr-2"}),"Mật khẩu"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:t?"text":"password",...U("password",{required:"Vui lòng nhập mật khẩu",minLength:{value:6,message:"Ít nhất 6 ký tự"}}),className:"input",placeholder:"Mật khẩu",autoComplete:"new-password"}),e.jsx("button",{type:"button",onClick:()=>s(!t),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-300",children:t?e.jsx(Jt,{className:"w-5 h-5"}):e.jsx(qt,{className:"w-5 h-5"})})]}),R.password&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:R.password.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label text-white/80",children:[e.jsx(At,{className:"w-4 h-4 inline mr-2"}),"Xác nhận mật khẩu"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:a?"text":"password",...U("confirmPassword",{required:"Vui lòng xác nhận mật khẩu",validate:O=>O===V("password")||"Mật khẩu xác nhận không khớp"}),className:"input",placeholder:"Nhập lại mật khẩu",autoComplete:"new-password"}),e.jsx("button",{type:"button",onClick:()=>r(!a),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-300",children:a?e.jsx(Jt,{className:"w-5 h-5"}):e.jsx(qt,{className:"w-5 h-5"})})]}),R.confirmPassword&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:R.confirmPassword.message})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"label text-white/80 flex items-center gap-2",children:[e.jsx(nt,{className:"w-4 h-4"}),"Xác minh email"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"btn-secondary flex-1",onClick:L,disabled:!y||j==="sending",children:j==="sending"?"Đang gửi...":"Gửi mã xác minh"}),p>0&&e.jsxs("div",{className:"px-4 py-2 rounded-lg bg-white/10 text-white/80 flex items-center gap-2",children:[e.jsx(Tr,{className:"w-4 h-4"}),e.jsxs("span",{children:[p,"s"]})]})]}),g&&e.jsx("p",{className:"text-sm text-amber-200",children:g}),j==="sent"||j==="verifying"||j==="verified"?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"text",value:x,onChange:O=>i(O.target.value),className:"input flex-1",placeholder:"Nhập mã xác minh"}),e.jsx("button",{type:"button",className:"btn-primary",onClick:v,disabled:j==="verifying",children:j==="verifying"?"Đang kiểm tra...":"Xác minh"})]}),m&&e.jsx("p",{className:"text-sm text-red-400",children:m})]}):null,j==="verified"&&e.jsx("p",{className:"text-sm text-green-400",children:"Email đã được xác minh! Bạn có thể hoàn tất đăng ký."})]})]}),l&&e.jsx("div",{className:"bg-red-900/30 border border-red-500/50 rounded-lg p-3",children:e.jsx("p",{className:"text-red-300 text-sm",children:l})}),e.jsx("button",{type:"submit",className:"btn-primary w-full",disabled:!P||u||j!=="verified",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Đang xử lý..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Hs,{className:"w-5 h-5"}),e.jsx("span",{children:"Đăng ký"})]})})]})]}),e.jsxs("div",{className:"hero-shortcut",onClick:()=>M("/login"),children:[e.jsx("div",{className:"hero-shortcut-icon",children:e.jsx(Vs,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-white",children:"Đã có tài khoản?"}),e.jsx("span",{className:"text-sm text-white/70",children:"Đăng nhập ngay"})]})]})]})]})},gl=()=>e.jsx("div",{className:"w-10 h-10 border-4 border-white/30 border-t-white rounded-full animate-spin"}),St={min:0,max:5e5},Ea=[6,9,12],pl=[{value:"default",label:"Mặc định"},{value:"rent_desc",label:"Đặt nhiều nhất"},{value:"price_asc",label:"Giá thấp → cao"},{value:"price_desc",label:"Giá cao → thấp"},{value:"name_asc",label:"Tên A → Z"}],fl=()=>{const[t,s]=n.useState(""),[a,r]=n.useState(""),[l,d]=n.useState(""),[c,f]=n.useState(St),[j,o]=n.useState(!1),[x,i]=n.useState(1),[m,b]=n.useState(Ea[2]),[p,w]=n.useState(null),[g,_]=n.useState("default"),[k,u]=n.useState([]),[M,U]=n.useState(!1),[J,V]=n.useState(""),[R,P]=n.useState(""),[F,D]=n.useState(""),[G,N]=n.useState(""),[q,y]=n.useState([]),[L,v]=n.useState(null),[B,O]=n.useState(0),[re,te]=n.useState({sportTypes:[],locations:[]}),[ve,T]=n.useState(!1),[se,ce]=n.useState(""),ge=Ha.useCallback(async()=>{T(!0),ce("");const E={search:t||void 0,sportType:a||void 0,location:l||void 0,priceMin:c.min!==St.min?c.min:void 0,priceMax:c.max!==St.max?c.max:void 0,page:x,pageSize:m};switch(g){case"price_asc":E.sortBy="price",E.sortDir="asc";break;case"price_desc":E.sortBy="price",E.sortDir="desc";break;case"name_asc":E.sortBy="name",E.sortDir="asc";break;case"rent_desc":E.sortBy="rent",E.sortDir="desc";break}try{console.log("[FieldsPage] Request params",E);const me=await nn(E);console.log("[FieldsPage] Response pagination",me?.meta?.pagination,"firstCodes",(me?.items||[]).slice(0,3).map(be=>be.field_code),"count",me?.items?.length),y(me.items),O(me.meta.pagination.total),te({sportTypes:me.facets.sportTypes??[],locations:me.facets.locations??[]}),v(me.meta)}catch(me){ce(me?.message||"Không thể tải danh sách sân. Vui lòng thử lại."),y([]),v(null),O(0)}finally{T(!1)}},[x,m,c.max,c.min,t,l,a,g]);n.useEffect(()=>{ge()},[ge]),n.useEffect(()=>{let E=!1;return(async()=>{U(!0),V("");try{const be=await fetch("https://provinces.open-api.vn/api/?depth=3");if(!be.ok)throw new Error(`HTTP ${be.status}`);const Vt=await be.json();if(!E){const lt=Vt.map(Fe=>({code:String(Fe.code),name:Fe.name,districts:Fe.districts.map(qe=>({code:String(qe.code),name:qe.name,wards:qe.wards.map(Be=>({code:String(Be.code),name:Be.name}))}))}));u(lt)}}catch(be){console.error("Failed to load provinces",be),E||(V("Không thể tải danh sách tỉnh/thành, hãy tự nhập hoặc thử lại sau"),u([]))}finally{E||U(!1)}})(),()=>{E=!0}},[]);const de=L?.pagination.totalPages??1,De=L?.pagination.page??x,Je=()=>{s(""),r(""),d(""),f(St),i(1),w(null),P(""),D(""),N("")},et=n.useMemo(()=>re.sportTypes.map(E=>({label:E,value:E})),[re.sportTypes]);n.useMemo(()=>re.locations.map(E=>({label:E,value:E})),[re.locations]),n.useMemo(()=>{const E=[{id:"price-under-150",label:"Giá dưới 150K",type:"price",payload:{min:0,max:15e4}},{id:"price-150-300",label:"150K - 300K",type:"price",payload:{min:15e4,max:3e5}},{id:"price-over-300",label:"Trên 300K",type:"price",payload:{min:3e5,max:1e6}}];return re.sportTypes.slice(0,2).forEach((me,be)=>{E.push({id:`sport-${be}`,label:`Sân ${me}`,type:"sport",payload:me})}),re.locations.slice(0,2).forEach((me,be)=>{E.push({id:`location-${be}`,label:me,type:"location",payload:me})}),E.push({id:"reset",label:"Xóa gợi ý",type:"reset"}),E},[re.locations,re.sportTypes]);const ze=!!(t||a||l)||c.min!==St.min||c.max!==St.max,He=E=>{r(a===E?"":E),w(null),i(1)},rt=n.useMemo(()=>R?k.find(E=>E.code===R)??null:null,[R,k]),ye=rt?.districts??[],$e=n.useMemo(()=>F?ye.find(E=>E.code===F)??null:null,[ye,F]),Me=$e?.wards??[],ne=n.useMemo(()=>G?Me.find(E=>E.code===G)??null:null,[Me,G]);return n.useEffect(()=>{R||(D(""),N(""))},[R]),n.useEffect(()=>{F||N("")},[F]),n.useEffect(()=>{if(!R&&!F&&!G)return;const me=[ne?.name,$e?.name,rt?.name].filter(Boolean).join(", ");d(me),w(null),i(1)},[$e,rt,ne,R,F,G]),e.jsx("div",{className:"page",children:e.jsxs("div",{className:"fields-layout",children:[e.jsxs("aside",{className:`filters-panel ${j?"open":""}`,children:[e.jsxs("div",{className:"filters-header",children:[e.jsxs("div",{children:[e.jsx("span",{className:"filters-eyebrow",children:"Bộ lọc"}),e.jsx("h2",{className:"filters-title",children:"Tìm nhanh sân phù hợp"})]}),e.jsx("button",{className:"filters-close",onClick:()=>o(!1),children:"Đóng"})]}),e.jsxs("div",{className:"filters-body",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"Tìm theo tên sân hoặc từ khóa"}),e.jsxs("div",{className:"filter-search",children:[e.jsx(sa,{className:"filter-search-icon"}),e.jsx("input",{value:t,onChange:E=>{s(E.target.value),w(null)},placeholder:"Nhập tên sân, địa điểm, quận..."})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"Loại hình"}),e.jsxs("div",{className:"filter-select",children:[e.jsxs("select",{value:a,onChange:E=>{He(E.target.value)},children:[e.jsx("option",{value:"",children:"Tất cả loại hình"}),et.map(E=>e.jsx("option",{value:E.value,children:E.label},E.value))]}),e.jsx(ds,{className:"filter-select-icon"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"Khoảng giá (VND / giờ)"}),e.jsxs("div",{className:"filter-price",children:[e.jsxs("div",{children:[e.jsx("span",{children:"Tối thiểu"}),e.jsx("input",{type:"number",min:0,step:1e4,value:c.min,onChange:E=>{const me=Number(E.target.value);f(be=>({...be,min:me})),w(null),i(1)}})]}),e.jsxs("div",{children:[e.jsx("span",{children:"Tối đa"}),e.jsx("input",{type:"number",min:0,step:1e4,value:c.max,onChange:E=>{const me=Number(E.target.value);f(be=>({...be,max:me})),w(null),i(1)}})]})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"Tỉnh / Thành"}),e.jsxs("div",{className:"filter-select",children:[e.jsxs("select",{value:R,onChange:E=>{P(E.target.value),w(null)},disabled:M||!k.length,children:[e.jsx("option",{value:"",children:M?"Đang tải...":"Chọn tỉnh / thành"}),k.map(E=>e.jsx("option",{value:E.code,children:E.name},E.code))]}),e.jsx(ds,{className:"filter-select-icon"})]}),J&&!k.length&&e.jsx("p",{className:"filter-hint text-xs text-amber-600",children:J})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"Quận / Huyện"}),e.jsxs("div",{className:"filter-select",children:[e.jsxs("select",{value:F,onChange:E=>{D(E.target.value),w(null)},disabled:!ye.length,children:[e.jsx("option",{value:"",children:R?"Chọn quận / huyện":"Chọn tỉnh trước"}),ye.map(E=>e.jsx("option",{value:E.code,children:E.name},E.code))]}),e.jsx(ds,{className:"filter-select-icon"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"Phường / Xã"}),e.jsxs("div",{className:"filter-select",children:[e.jsxs("select",{value:G,onChange:E=>{N(E.target.value),w(null)},disabled:!Me.length,children:[e.jsx("option",{value:"",children:F?"Chọn phường / xã":"Chọn quận trước"}),Me.map(E=>e.jsx("option",{value:E.code,children:E.name},E.code))]}),e.jsx(ds,{className:"filter-select-icon"})]})]})]}),e.jsx("div",{className:"filters-footer",children:e.jsxs("button",{className:"btn-reset",onClick:Je,children:[e.jsx(bt,{className:"w-4 h-4"}),"Xóa bộ lọc"]})})]}),e.jsxs("main",{className:"fields-content",children:[e.jsxs("header",{className:"fields-header",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"fields-title",children:"Tìm sân thể thao"}),e.jsx("p",{className:"fields-subtitle",children:"Lọc theo vị trí, loại hình, giá và đánh giá để đặt sân phù hợp nhất."})]}),e.jsxs("button",{className:"filters-toggle",onClick:()=>o(E=>!E),children:[e.jsx(kr,{className:"w-4 h-4"}),"Bộ lọc",ze&&e.jsx("span",{className:"filters-dot"})]})]}),!!se&&e.jsxs("div",{className:"notice notice-error",children:[e.jsx(Ce,{className:"w-5 h-5"}),se]}),!se&&e.jsxs("div",{className:"fields-topbar",children:[e.jsxs("div",{className:"fields-summary",children:[e.jsx("span",{className:"fields-summary-count",children:B}),e.jsx("span",{className:"fields-summary-label",children:"sân phù hợp"})]}),e.jsxs("div",{className:"fields-controls",children:[e.jsxs("label",{className:"fields-page-size",children:[e.jsx("span",{children:"Hiển thị"}),e.jsx("select",{value:m,onChange:E=>{b(Number(E.target.value)),w(null),i(1)},children:Ea.map(E=>e.jsxs("option",{value:E,children:[E," / trang"]},E))})]}),e.jsxs("label",{className:"fields-page-size",children:[e.jsx("span",{children:"Sắp xếp"}),e.jsx("select",{value:g,onChange:E=>{const me=E.target.value;_(me),i(1)},children:pl.map(E=>e.jsx("option",{value:E.value,children:E.label},E.value))})]})]})]}),ve?e.jsx("div",{className:"fields-loading",children:"Đang tải dữ liệu..."}):q.length?e.jsx("div",{className:"grid-cards",children:q.map(E=>e.jsx(cn,{field:E},E.field_code))}):se?null:e.jsxs("div",{className:"empty-state",children:[e.jsx(Ce,{className:"empty-state-icon"}),e.jsx("h3",{children:"Không tìm thấy sân phù hợp"}),e.jsx("p",{children:"Hãy điều chỉnh bộ lọc hoặc thử tìm kiếm với từ khóa khác."}),e.jsx("button",{className:"btn-primary",onClick:Je,children:"Đặt lại bộ lọc"})]}),de>1&&!ve&&e.jsxs("div",{className:"pagination",children:[e.jsx("button",{className:"pagination-button",onClick:()=>i(E=>Math.max(1,E-1)),disabled:De<=1,children:"Trước"}),e.jsxs("div",{className:"pagination-info",children:["Trang ",De," / ",de]}),e.jsx("button",{className:"pagination-button",onClick:()=>i(E=>Math.min(de,E+1)),disabled:De>=de,children:"Sau"})]})]})]})})},dt=[{id:"parking",label:"Bãi Đỗ Xe",icon:"🅿️"},{id:"restroom",label:"Nhà Vệ Sinh",icon:"🚻"},{id:"changing_room",label:"Phòng Thay Đồ",icon:"🚪"},{id:"ac",label:"Điều Hoà",icon:"❄️"},{id:"hot_water",label:"Nước Nóng",icon:"🚿"},{id:"wifi",label:"WiFi",icon:"📶"},{id:"racket_rental",label:"Thuê Vợt",icon:"🎾"},{id:"ball_rental",label:"Thuê Bóng",icon:"⚽"}];async function Ma(t){try{const{data:s}=await H.get(`/shops/${t}/utilities`);return s?.success&&s?.data?s.data:[]}catch(s){return console.error("Error fetching shop utilities:",s),[]}}async function bl(t,s){try{const{data:a}=await H.post(`/shops/${t}/utilities`,{utilities:s});return a?.success&&a?.data?a.data:[]}catch(a){throw console.error("Error updating shop utilities:",a),a}}async function jl(t){try{const{data:s}=await H.get(`/fields/${t}/utilities`);if(s?.success&&s?.data){const r={};return dt.forEach(l=>{r[l.id]=!1}),s.data.forEach(l=>{r.hasOwnProperty(l.utility_id)&&(r[l.utility_id]=!0)}),r}const a={};return dt.forEach(r=>{a[r.id]=!1}),a}catch(s){console.error("Error fetching field utilities:",s);const a={};return dt.forEach(r=>{a[r.id]=!1}),a}}const yl=t=>t==="TRONG"?"status-trong":t==="BAO_TRI"?"status-bao-tri":"status-khac",Nl=()=>{const{id:t}=Kt(),[s,a]=n.useState(null),[r,l]=n.useState(!0),[d,c]=n.useState(0),[f,j]=n.useState(""),[o,x]=n.useState(0),[i,m]=n.useState(!1),[b,p]=n.useState({}),w=n.useCallback(async()=>{if(!t||!Number.isFinite(Number(t)))throw new Error("Mã sân không hợp lệ.");return Xs(Number(t))},[t]);n.useEffect(()=>{let N=!0;return(async()=>{try{l(!0),j("");const q=await w();if(N&&a(q),q&&N){try{const y=await rn(q.field_code);N&&x(y.booking_count||0)}catch(y){console.error("Error loading field stats:",y),N&&x(q?.booking_count||0)}try{const y=await jl(q.field_code);N&&p(y)}catch(y){if(console.error("Error loading field utilities:",y),N){const L={};dt.forEach(v=>{L[v.id]=!1}),p(L)}}}}catch{N&&a(null)}finally{N&&l(!1)}})(),()=>{N=!1}},[w]);const g=N=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",minimumFractionDigits:0}).format(N),_=N=>Number(N?.is_primary)===1||N?.is_primary===!0,k=N=>typeof N?.sort_order=="number"?N.sort_order:0,u=N=>typeof N?.image_code=="number"?N.image_code:0,M=n.useMemo(()=>s?.images?.length?[...s.images].sort((q,y)=>{const L=_(q)?1:0,v=_(y)?1:0;if(L!==v)return v-L;const B=k(q),O=k(y);return B!==O?B-O:u(q)-u(y)}).map(q=>{const y=Rt(q.image_url,q.storage);return{...q,image_url:y??q.image_url}}):[],[s]);n.useEffect(()=>{if(!M.length){c(0);return}const N=M.findIndex(_);c(N>=0?N:0)},[M]);const U=n.useCallback(()=>{M.length&&c(N=>(N-1+M.length)%M.length)},[M.length]),J=n.useCallback(()=>{M.length&&c(N=>(N+1)%M.length)},[M.length]);if(n.useCallback(N=>{N.key==="ArrowLeft"?(N.preventDefault(),U()):N.key==="ArrowRight"&&(N.preventDefault(),J())},[U,J]),r)return e.jsx("div",{className:"page loading-wrap",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Đang tải dữ liệu..."})]})});if(f)return e.jsx("div",{className:"page",children:e.jsxs("div",{className:"container max-w-4xl",children:[e.jsxs(ke,{to:"/fields",className:"btn-link inline-flex items-center mb-8",children:[e.jsx(Lt,{className:"w-4 h-4 mr-1"})," Quay lại danh sách sân"]}),e.jsxs("div",{className:"card p-12 text-center",children:[e.jsx(Ce,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Không thể tải dữ liệu"}),e.jsx("p",{className:"text-gray-600 mb-6",children:f}),e.jsx("button",{type:"button",onClick:()=>{j(""),l(!0),(async()=>{try{const N=await w();a(N??null)}catch(N){j(N?.message||"Không thể tải thông tin sân. Vui lòng thử lại."),a(null)}finally{l(!1)}})()},className:"btn-primary",children:"Thử lại"})]})]})});if(!s)return e.jsx("div",{className:"page",children:e.jsxs("div",{className:"container max-w-4xl",children:[e.jsxs(ke,{to:"/fields",className:"btn-link inline-flex items-center mb-8",children:[e.jsx(Lt,{className:"w-4 h-4 mr-1"})," Quay lại danh sách sân"]}),e.jsxs("div",{className:"card p-12 text-center",children:[e.jsx(Ce,{className:"w-16 h-16 text-yellow-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Không tìm thấy sân"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Sân bạn yêu cầu không tồn tại hoặc đã bị xóa."})]})]})});const V=M[d],R=Rt(V?.image_url,V?.storage)??V?.image_url,P=Bt(s),F=an(s?.shop),D="var(--brand-600)",G="var(--brand-50)";return e.jsx("div",{className:"page",children:e.jsx("div",{className:"container",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs("div",{className:"relative rounded-2xl overflow-hidden mb-6 bg-gray-200 h-96 md:h-96 group",children:[R?e.jsx("img",{src:R,alt:`${s.field_name}`,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gray-300 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-500",children:"Không có ảnh"})}),M.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:U,className:"absolute left-4 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white p-2 rounded-full transition opacity-0 group-hover:opacity-100",children:e.jsx(Lt,{className:"w-6 h-6 text-gray-900"})}),e.jsx("button",{type:"button",onClick:J,className:"absolute right-4 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white p-2 rounded-full transition opacity-0 group-hover:opacity-100",children:e.jsx(Ns,{className:"w-6 h-6 text-gray-900"})}),e.jsxs("div",{className:"absolute bottom-4 right-4 bg-black/60 text-white px-3 py-1 rounded-full text-sm font-medium",children:[d+1,"/",M.length]}),e.jsx("div",{className:"absolute bottom-4 left-4 flex gap-2",children:M.slice(0,5).map((N,q)=>e.jsx("button",{onClick:()=>c(q),className:`w-12 h-12 rounded-lg border-2 transition ${q===d?"border-[var(--brand-600)]":"border-gray-300 opacity-60 hover:opacity-100"}`,style:{backgroundImage:`url(${M[q]?.image_url})`,backgroundSize:"cover",backgroundPosition:"center"}},q))})]})]}),e.jsxs("div",{className:"section mb-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:s.field_name}),e.jsx("p",{className:"text-gray-600 mt-1",children:s.shop?.shop_name})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"flex items-center gap-2 text-[var(--brand-600)] font-semibold",children:[e.jsx(It,{className:"w-5 h-5"}),e.jsxs("span",{children:[o," đặt"]})]})})]}),e.jsx("div",{className:"inline-block",children:e.jsx("span",{className:`status-chip ${yl(s.status)}`,children:Dt(s.status)})})]}),e.jsxs("div",{className:"section mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Thông tin sân"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center",style:{backgroundColor:G},children:e.jsx(ns,{className:"w-5 h-5",style:{color:D}})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Địa điểm"}),e.jsx("p",{className:"font-medium text-gray-900",children:s.address})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center",style:{backgroundColor:G},children:e.jsx(Jn,{className:"w-5 h-5",style:{color:D}})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Loại hình"}),e.jsx("p",{className:"font-medium text-gray-900",children:Ze(s.sport_type)})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center",style:{backgroundColor:G},children:e.jsx(Se,{className:"w-5 h-5",style:{color:D}})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Giờ mở cửa"}),e.jsx("p",{className:"font-medium text-gray-900",children:F})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center",style:{backgroundColor:G},children:e.jsx(Ft,{className:"w-5 h-5",style:{color:D}})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Giá"}),e.jsxs("p",{className:"font-medium text-gray-900",children:[g(P),"/giờ"]})]})]})]})]}),e.jsxs("div",{className:"section",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Tiện ích"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:dt.map(N=>{const q=b[N.id]===!0;return e.jsxs("div",{className:"flex items-center gap-2",children:[q?e.jsx(Ya,{className:"w-5 h-5 text-[var(--brand-600)] flex-shrink-0"}):e.jsx("div",{className:"w-5 h-5 flex items-center justify-center text-gray-400 font-medium flex-shrink-0",children:"X"}),e.jsx("span",{className:`text-gray-700 ${q?"":"line-through text-gray-400"}`,children:N.label})]},N.id)})})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"card p-6 sticky top-24",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Giá mỗi giờ"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:g(P)})]}),e.jsx(ke,{to:`/booking/${s.field_code}`,state:{field:s},className:"btn-primary w-full text-center mb-3",children:"Đặt sân ngay"}),e.jsx("button",{className:"btn-ghost w-full mb-6",style:{borderColor:"var(--brand-600)",color:"var(--brand-600)"},onMouseOver:N=>N.currentTarget.style.backgroundColor="var(--brand-50)",onMouseOut:N=>N.currentTarget.style.backgroundColor="#fff",children:"Liên hệ chủ sân"}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-4",children:"Thông tin chủ sân"}),e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-white font-bold",style:{backgroundImage:"linear-gradient(135deg, var(--brand-500), var(--brand-600))"},children:s.shop?.shop_name?.charAt(0)||"S"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.shop?.shop_name}),e.jsx("p",{className:"text-sm text-gray-600",children:"Chủ sân xác minh"})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx(rs,{className:"w-4 h-4",style:{color:D}}),s.shop?.phone_number||"Chưa cập nhật"]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx(_s,{className:"w-4 h-4",style:{color:D}}),e.jsxs("span",{children:[o," lượt đặt"]})]})]})]}),e.jsx("div",{className:"mt-6 p-3 rounded-lg border",style:{backgroundColor:"var(--brand-50)",borderColor:"var(--brand-200)",color:"var(--brand-600)"},children:e.jsx("p",{className:"text-xs font-medium",children:"✓ Đặt ngay - Thanh toán an toàn - Hoàn tiền nếu hủy"})})]})})]})})})},vl=(t,s,a,r)=>n.useMemo(()=>{if(!t)return{discount:0,final:0,before:0,feedback:"",feedbackClass:"text-gray-600"};const l=t.totalPrice;let d=0;if(a&&s&&r.trim()){const o=s.min_order_amount??0;l>=o&&(d=s.discount_type==="percent"?l*s.discount_value/100:s.discount_value,s.discount_type==="percent"&&s.max_discount_amount!==null&&s.max_discount_amount>=0&&(d=Math.min(d,s.max_discount_amount)),d=Math.min(d,l),d=Math.round(d*100)/100)}const c=Math.max(l-d,0);let f="",j="text-gray-600";return r.trim()&&(a?s?l<(s.min_order_amount??0)?(f=`Áp dụng cho đơn từ ${(s.min_order_amount??0).toLocaleString("vi-VN")}₫.`,j="text-gray-600"):d>0&&(f=s.discount_type==="percent"?`Đã giảm -${s.discount_value}%`:`Đã giảm -${d.toLocaleString("vi-VN")}₫`,j="text-emerald-600"):(f="Không tìm thấy khuyến mãi tương ứng.",j="text-gray-600"):(f="Hãy đăng ký để được áp dụng khuyến mãi.",j="text-red-600")),{discount:d,final:c,before:l,feedback:f,feedbackClass:j}},[t,s,a,r]),wl=new Set(["held","holding","on_hold","pending","pending_hold","pending_booking","pending_payment","pending_confirmation","pending_confirm"]),_l=new Set(["booked","confirmed","reserved","paid","success","completed","done","inactive","maintenance","blocked","cancelled","cancel"]),on=t=>wl.has(String(t??"").toLowerCase()),kl=t=>_l.has(String(t??"").toLowerCase()),Sl=t=>{if(!t)return null;const s=t.includes("T")?t:t.replace(" ","T"),a=new Date(s);return Number.isNaN(a.getTime())?null:a},dn=(t,s)=>{if(typeof s=="number"&&!Number.isNaN(s)){const a=s>1e12?s:s*1e3,r=new Date(a);if(!Number.isNaN(r.getTime()))return r}return Sl(t)},Zs=(t,s)=>{const a=dn(t,s);return!a||a.getTime()>Date.now()},Cl=(t,s,a)=>{const r=String(t??"").toLowerCase();return on(r)?Zs(s,a)?"held":"available":kl(r)?"booked":r==="available"?"available":"booked"},Tl=(t,s)=>{if(t?.success&&t.data)return t.data;const a=t?.error?.message||t?.message||s;throw new Error(a)};async function El(t,s){if(!t)throw new Error("Thiếu mã sân để đặt lịch.");try{const{data:a}=await H.post(`/fields/${t}/bookings/confirm`,s);return Tl(a,"Không thể xác nhận thanh toán.")}catch(a){const r=a?.response?.data?.error?.message||a?.response?.data?.message||a?.message||"Không thể xác nhận thanh toán.";throw new Error(r)}}const hn=async t=>(await H.get(`/bookings/${t}`)).data,Ml=async(t,s)=>(await H.patch(`/bookings/${t}/cancel`,{reason:s})).data,Pl=async t=>(await H.get(`/bookings/${t}/checkin-code`)).data,Ll=(t,s)=>{if(typeof s=="number"&&!Number.isNaN(s)){const l=new Date(s*1e3);if(!Number.isNaN(l.getTime()))return l.toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"})}if(!t)return"";const a=t.replace(" ","T"),r=new Date(a);return Number.isNaN(r.getTime())?"":r.toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"})},Al=({courts:t,selectedQuantityID:s,onSelectCourt:a,loading:r=!1})=>{if(r)return e.jsxs("div",{className:"flex items-center gap-3 text-gray-600",children:[e.jsx("div",{className:"spinner"}),e.jsx("span",{children:"Đang tải danh sách sân..."})]});if(!t.length)return e.jsx("div",{className:"flex items-start gap-2 rounded-lg border border-yellow-200 bg-yellow-50 px-4 py-3 text-yellow-700",children:e.jsx("span",{children:"Không có dữ liệu sân cho khung giờ này."})});const l=[...t].sort((c,f)=>c.quantity_number-f.quantity_number),d=l.filter(c=>c.status==="available").length;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:["Chọn sân ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"grid gap-3 sm:grid-cols-2 md:grid-cols-3",children:l.map(c=>{const f=s===c.quantity_id,j=c.status==="available",o=c.status==="held";c.status;const x=Ll(c.holdExpiresAt,c.holdExpiresAtTs);return e.jsxs("button",{type:"button",onClick:()=>{j&&a(c.quantity_id)},disabled:!j,className:`relative flex flex-col items-center gap-2 rounded-xl border px-4 py-3 transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-1 ${j?f?"border-emerald-500 bg-emerald-50 shadow-sm focus-visible:ring-emerald-400":"border-gray-200 bg-white hover:border-emerald-300 hover:bg-emerald-50/60 focus-visible:ring-emerald-400":"border-gray-200 bg-gray-100 text-gray-500 cursor-not-allowed opacity-70"}`,"aria-pressed":f,"aria-disabled":!j,children:[e.jsxs("span",{className:`text-2xl font-bold ${j?"text-gray-900":"text-gray-500"}`,children:["Sân ",c.quantity_number]}),e.jsx("span",{className:`text-xs font-medium rounded-full px-2 py-1 ${j?"bg-green-100 text-green-700":o?"bg-amber-100 text-amber-700":"bg-red-100 text-red-700"}`,children:j?"Trống":o?"Đang giữ":"Đã đặt"}),!j&&x&&o&&e.jsxs("span",{className:"text-xs text-amber-600",children:["Giữ đến ",x]}),f&&j&&e.jsx("div",{className:"absolute top-2 right-2 flex h-5 w-5 items-center justify-center rounded-full bg-emerald-500",children:e.jsx("svg",{className:"h-3 w-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]},c.quantity_id)})})]}),d===0&&e.jsxs("div",{className:"flex items-start gap-2 rounded-lg border border-red-200 bg-red-50 px-4 py-3 text-red-700",children:[e.jsx(Ce,{className:"h-5 w-5 shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Không còn sân trống"}),e.jsx("p",{className:"text-sm",children:"Vui lòng chọn khung giờ khác."})]})]})]})};function ra(t,s){return t?.error?.message||t?.message||s}function mn(t,s){if(t?.success&&t?.data!==null&&t?.data!==void 0)return t.data;throw new Error(ra(t,s))}async function Dl(){try{const{data:t}=await H.get("/shops/me/promotions");if(t?.success)return Array.isArray(t.data)?t.data:[];throw new Error(ra(t,"Không thể tải danh sách khuyến mãi"))}catch(t){throw t instanceof Error?t:new Error("Không thể tải danh sách khuyến mãi")}}async function $l(t){try{const{data:s}=await H.post("/shops/me/promotions",t);return mn(s,"Không thể tạo khuyến mãi")}catch(s){throw s instanceof Error?s:new Error("Không thể tạo khuyến mãi")}}async function Fl(t,s){try{const{data:a}=await H.patch(`/shops/me/promotions/${t}/status`,{status:s});return mn(a,"Không thể cập nhật trạng thái khuyến mãi")}catch(a){throw a instanceof Error?a:new Error("Không thể cập nhật trạng thái khuyến mãi")}}async function ql(t){if(!Number.isFinite(t)||t<=0)return[];try{const{data:s}=await H.get(`/shops/${t}/promotions/active`);if(s?.success&&Array.isArray(s.data))return s.data;throw new Error(ra(s,"Không thể tải khuyến mãi đang áp dụng"))}catch(s){throw s instanceof Error?s:new Error("Không thể tải khuyến mãi đang áp dụng")}}async function Il(t){if(!Number.isFinite(t)||t<=0)throw new Error("Mã khuyến mãi không hợp lệ");try{const{data:s}=await H.delete(`/shops/me/promotions/${t}`);if(!s?.success)throw new Error(s?.error?.message||s?.message||"Không thể xóa khuyến mãi")}catch(s){throw s instanceof Error?s:new Error("Không thể xóa khuyến mãi")}}const Pa=()=>{const t=new Date,s=t.getTimezoneOffset()*60*1e3;return new Date(t.getTime()-s).toISOString().split("T")[0]},Ge=t=>{const[s,a]=t.split(":").map(Number);return s*60+a},Bl=(t,s)=>{const a=Ge(t)+s,r=Math.floor(a/60).toString().padStart(2,"0"),l=(a%60).toString().padStart(2,"0");return`${r}:${l}`},As=t=>t<=0?"0 phút":t%60===0?`${t/60} giờ`:`${t} phút`,Ds=Cl,Rl=(t,s)=>{if(typeof s=="number"&&!Number.isNaN(s)){const l=new Date(s*1e3);if(!Number.isNaN(l.getTime()))return l.toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"})}if(!t)return"";const a=t.replace(" ","T"),r=new Date(a);return Number.isNaN(r.getTime())?"":r.toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"})},Ht=(t,s)=>t instanceof Error&&t.message||typeof t=="object"&&t!==null&&"message"in t&&typeof t.message=="string"?t.message:s,Kl=t=>{const s=String(t.status??"").toLowerCase(),a=String(t.availability_state??t.availability_status??"").toLowerCase();let r;const l=o=>{if(typeof o=="boolean"){if(o===!1){r=!1;return}r!==!1&&(r=!0)}};l(t.is_available),a==="available"?l(!0):(a==="unavailable"||a==="unavailable_slot")&&l(!1),s==="available"&&l(!0),["booked","blocked","on_hold","held","hold","confirmed","reserved","disabled"].includes(s)&&l(!1);const d=["held","on_hold","holding","hold"].includes(s),c=["booked","confirmed","reserved"].includes(s),f=["blocked","disabled"].includes(s);return{isAvailable:r!==!1&&!d&&!c&&!f,isHeld:d,isBooked:c,isBlocked:f,normalizedStatus:s}},Ut=1e3,Vl=6e4,Ol=1e3,zl=2147483647,Hl=()=>{const{id:t}=Kt(),s=ys(),a=We(),{user:r}=Oe(),l=typeof s.state=="object"&&s.state!==null?s.state:void 0,d=l?.field,c=l?.bookingDetails,f=n.useMemo(()=>{if(!c)return null;const A=Math.round((c.duration??0)*60),I=Bl(c.startTime,A);return{...c,endTime:I}},[c]),j=f?.date??Pa(),[o,x]=n.useState(d??null),[i,m]=n.useState(!d&&!!t),[b,p]=n.useState("");n.useEffect(()=>{let A=!1;if(!d&&t){const I=Number(t);if(!Number.isFinite(I)){p("Mã sân không hợp lệ."),m(!1);return}(async()=>{m(!0),p("");try{const z=await Xs(I);A||x(z??null)}catch(z){if(!A){const Q=Ht(z,"Không thể tải thông tin sân. Vui lòng thử lại.");p(Q),x(null)}}finally{A||m(!1)}})()}return()=>{A=!0}},[d,t]);const[w,g]=n.useState(j),[_,k]=n.useState([]),[u,M]=n.useState(!1),[U,J]=n.useState(""),[V,R]=n.useState([]),[P,F]=n.useState(),[D,G]=n.useState(0),[N,q]=n.useState(!1),[y,L]=n.useState([]),[v,B]=n.useState([]),O=n.useRef(null),re=n.useRef(null),te=n.useRef(Ut),ve=n.useRef(null),[T,se]=n.useState(""),[ce,ge]=n.useState([]),[de,De]=n.useState(!1),[Je,et]=n.useState("");n.useEffect(()=>{if(!o?.field_code||!w){k([]);return}let A=!1;return M(!0),J(""),k([]),(async()=>{try{const I=await Sa(o.field_code,w);A||(k(I.slots??[]),I.slots?.length||J("Ngày này chưa mở lịch hoặc đã kín lịch."))}catch(I){if(!A){k([]);const z=Ht(I,"Không thể tải khung giờ trống. Vui lòng thử lại.");J(z)}}finally{A||M(!1)}})(),()=>{A=!0}},[o?.field_code,w,D]),n.useEffect(()=>{const A=()=>{O.current!==null&&(clearTimeout(O.current),O.current=null),re.current=null};if(!_.length){A(),te.current=Ut,ve.current=null;return}const I=Date.now(),z=_.map(he=>dn(he.hold_expires_at,he.hold_expires_at_ts??null)).filter(he=>!!he).map(he=>he.getTime()).filter(he=>he>I).sort((he,Ne)=>he-Ne)[0];if(!z){A(),te.current=Ut,ve.current=null;return}const Q=ve.current;Q!==null&&Math.abs(Q-z)<=Ol?te.current=Math.min(te.current*2,Vl):te.current=Ut,ve.current=z;const K=Math.max(500,z-I+200),Z=Math.min(Math.max(te.current,K),zl),X=I+Z,le=re.current;O.current!==null&&le!==null&&Math.abs(le-X)<=250||(A(),re.current=X,O.current=window.setTimeout(()=>{O.current=null,re.current=null,G(he=>he+1)},Z))},[_]),n.useEffect(()=>()=>{O.current!==null&&(clearTimeout(O.current),O.current=null),re.current=null,te.current=Ut,ve.current=null},[]),n.useEffect(()=>{if(!o?.field_code){B([]);return}if(Array.isArray(o.quantities)&&o.quantities.length>0){B(o.quantities);return}let A=!1;return(async()=>{try{const I=await Or(o.field_code);A||B(I.quantities??[])}catch(I){console.error("Không thể tải danh sách sân con:",I),A||B([])}})(),()=>{A=!0}},[o?.field_code,o?.quantities]);const ze=n.useMemo(()=>{if(!_.length)return[];const A=new Map;_.forEach(z=>{const Q=`${z.play_date}|${z.start_time}|${z.end_time}`;let K=A.get(Q);K||(K={aggregatedSlot:void 0,baseSlot:z,courts:[]},A.set(Q,K)),z.quantity_id===null||z.quantity_id===void 0?K.aggregatedSlot=z:K.courts.push(z),K.baseSlot||(K.baseSlot=z)});const I=Array.from(A.entries()).map(([z,Q])=>{const K=Q.courts.filter(ee=>typeof ee.quantity_id=="number").sort((ee,je)=>{const Ee=(typeof ee.quantity_number=="number"?ee.quantity_number:ee.quantity_id)??0,Re=(typeof je.quantity_number=="number"?je.quantity_number:je.quantity_id)??0;return Ee-Re}),Z=Q.aggregatedSlot??Q.baseSlot??K[0]??Q.courts[0];if(!Z)return null;const X=new Map;K.forEach(ee=>{typeof ee.quantity_id=="number"&&X.set(ee.quantity_id,ee)});const le=(ee,je)=>-((Math.abs(ee)||1)*1e3+je),he=Q.aggregatedSlot??Z,ie=(v.length?v:K.filter(ee=>typeof ee.quantity_id=="number").map(ee=>({quantity_id:ee.quantity_id,quantity_number:typeof ee.quantity_number=="number"?ee.quantity_number:ee.quantity_id}))).map(ee=>{const je=Number(ee.quantity_id);if(!Number.isFinite(je))return null;const Ee=X.get(je);return Ee||{...he,slot_id:le(he.slot_id,je),quantity_id:je,quantity_number:typeof ee.quantity_number=="number"?ee.quantity_number:je,status:"available",hold_expires_at:null,hold_expires_at_ts:null,is_available:!0}}).filter(ee=>!!ee),fe=ie.length>0?ie:K,ue=fe.length>0&&fe.every(ee=>String(ee.status??"").toLowerCase()!=="available");return{key:z,baseSlot:Z,courts:fe,play_date:Z.play_date,start_time:Z.start_time,end_time:Z.end_time,isFullyBooked:ue}}).filter(Boolean);return I.sort((z,Q)=>{const K=z.play_date.localeCompare(Q.play_date);return K!==0?K:z.start_time.localeCompare(Q.start_time)}),I},[_,v]),He=n.useMemo(()=>ze.map(A=>A.baseSlot),[ze]),rt=n.useMemo(()=>{const A=new Map;return ze.forEach(I=>{A.set(I.baseSlot.slot_id,I)}),A},[ze]);n.useEffect(()=>{if(!He.length){R([]);return}const A=[...He].sort((z,Q)=>z.start_time.localeCompare(Q.start_time)),I=()=>{if(!f||f.date!==w||!f.startTime)return[];const z=Math.round(Math.max(0,(f.duration??0)*60));if(z<=0)return[];const Q=A.findIndex(X=>X.start_time===f.startTime);if(Q===-1)return[];const K=[];let Z=z;for(let X=Q;X<A.length&&Z>0;X+=1){const le=A[X];if(X>Q){const Ne=A[X-1];if(Ge(le.start_time)!==Ge(Ne.end_time))return[]}const he=Ge(le.end_time)-Ge(le.start_time);if(he<=0)return[];K.push(le),Z-=he}return Z>0?[]:K.map(X=>X.slot_id)};R(z=>{const Q=z.filter(Z=>A.some(X=>X.slot_id===Z));if(Q.length>0)return Q.length===z.length?z:Q;const K=I();return K.length>0?K:[]})},[He,f,w]);const ye=n.useMemo(()=>{if(!V.length)return[];const A=new Map(He.map(I=>[I.slot_id,I]));return V.map(I=>A.get(I)).filter(I=>!!I).sort((I,z)=>I.start_time.localeCompare(z.start_time))},[V,He]),$e=n.useMemo(()=>V.map(A=>rt.get(A)).filter(A=>!!A),[V,rt]),Me=n.useMemo(()=>$e.some(A=>A.courts.length>0),[$e]);n.useEffect(()=>{if(!o||V.length===0){L([]),F(void 0),q(!1);return}if(!$e.length){L([]),F(void 0),q(!1);return}if(!Me){L([]),F(void 0),q(!1);return}q(!0);let A=!1;const I=Array.from(new Map($e.map(K=>[`${K.play_date}|${K.start_time}|${K.end_time}`,K])).values()),z=new Map;$e.forEach(K=>{K.courts.forEach(Z=>{const X=Z.quantity_id;if(typeof X!="number")return;const le=String(Z.status??"").toLowerCase(),he=typeof Z.hold_expires_at_ts=="number"?Z.hold_expires_at_ts:null;on(le)&&Zs(Z.hold_expires_at??null,he)?z.set(X,{raw:Z.hold_expires_at??null,ts:he}):z.has(X)&&!Zs(Z.hold_expires_at??null,he)&&z.delete(X)})});const Q=new Map;return v.forEach(K=>{const Z=Number(K.quantity_id);if(!Number.isFinite(Z))return;const X=typeof K.quantity_number=="number"?K.quantity_number:Z;Q.set(Z,{quantity_id:Z,quantity_number:X,baseStatus:K.status})}),Q.size===0&&$e.forEach(K=>{K.courts.forEach(Z=>{const X=Z.quantity_id;if(typeof X!="number")return;const le=typeof Z.quantity_number=="number"?Z.quantity_number:X;Q.has(X)||Q.set(X,{quantity_id:X,quantity_number:le})})}),(async()=>{try{const K=await Promise.all(I.map(ie=>Vr(o.field_code,ie.play_date,ie.start_time,ie.end_time)));if(A)return;K.forEach(ie=>{ie.availableQuantities.forEach(fe=>{const ue=Number(fe.quantity_id);if(!Number.isFinite(ue))return;const ee=typeof fe.quantity_number=="number"?fe.quantity_number:ue;Q.has(ue)||Q.set(ue,{quantity_id:ue,quantity_number:ee})}),ie.bookedQuantities.forEach(fe=>{const ue=Number(fe.quantity_id);if(!Number.isFinite(ue))return;const ee=typeof fe.quantity_number=="number"?fe.quantity_number:ue;Q.has(ue)||Q.set(ue,{quantity_id:ue,quantity_number:ee})})});const Z=Array.from(Q.values());if(Z.length===0){L([]),F(void 0);return}const X=new Map,le=(ie,fe)=>(X.has(ie)||X.set(ie,{quantity_id:ie,quantity_number:fe,statuses:[]}),X.get(ie)),he=(ie,fe,ue)=>{le(ie,fe).statuses.push(ue)};K.forEach(ie=>{const fe=new Set(ie.availableQuantities.map(ee=>Number(ee.quantity_id)).filter(ee=>Number.isFinite(ee))),ue=new Map;ie.bookedQuantities.forEach(ee=>{const je=Number(ee.quantity_id);if(!Number.isFinite(je))return;const Ee=Ds(ee.status,z.get(je)?.raw??null,z.get(je)?.ts??null);ue.set(je,Ee==="held"?"held":"booked")}),Z.forEach(ee=>{const{quantity_id:je,quantity_number:Ee}=ee;if(!Number.isFinite(je))return;let Re;if(fe.has(je))Re="available";else{const Ot=ue.get(je);if(Ot==="held")Re="held";else if(Ot==="booked")Re="booked";else if(ee.baseStatus&&ee.baseStatus!=="available"){const cs=z.get(je);Re=Ds(ee.baseStatus,cs?.raw??null,cs?.ts??null)==="held"?"held":"booked"}else Re="booked"}he(je,Ee,Re)})});const Ne=Array.from(X.values()).map(ie=>{const fe=ie.statuses.every(Ee=>Ee==="available")?"available":ie.statuses.some(Ee=>Ee==="held")?"held":"booked",ue=z.get(ie.quantity_id),ee=fe==="held"?ue?.raw??null:null,je=fe==="held"?ue?.ts??null:null;return{quantity_id:ie.quantity_id,quantity_number:ie.quantity_number,status:fe,holdExpiresAt:ee,holdExpiresAtTs:je}}).sort((ie,fe)=>ie.quantity_number-fe.quantity_number);L(Ne),F(ie=>{if(!Ne.length)return;if(typeof ie=="number"&&Ne.some(ue=>ue.quantity_id===ie&&ue.status==="available"))return ie;const fe=Ne.find(ue=>ue.status==="available");return fe?fe.quantity_id:void 0})}catch(K){if(A)return;console.error("Không thể tải danh sách sân trống:",K),L([]),F(void 0),J(Z=>Z||"Không thể tải danh sách sân cho các khung giờ đã chọn. Vui lòng thử lại.")}finally{A||q(!1)}})(),()=>{A=!0}},[o,V,$e,Me,v,D]),n.useEffect(()=>{if(!o?.shop?.shop_code){ge([]),et("");return}let A=!1;return(async()=>{try{De(!0),et("");const I=await ql(o.shop.shop_code);A||ge(I)}catch(I){A||(ge([]),et(Ht(I,"Không thể tải danh sách khuyến mãi của sân.")))}finally{A||De(!1)}})(),()=>{A=!0}},[o?.shop?.shop_code]);const ne=n.useMemo(()=>{if(!o||!ye.length||!w)return null;const A=ye.reduce((le,he)=>{const Ne=Ge(he.end_time)-Ge(he.start_time);return Ne<=0?le:le+Ne},0);if(A<=0)return null;const I=ye[0],z=ye[ye.length-1];let Q=!0;for(let le=1;le<ye.length;le+=1){const he=ye[le-1],Ne=ye[le];if(Ge(he.end_time)!==Ge(Ne.start_time)){Q=!1;break}}const K=A/60,Z=Bt(o),X=K*Z;return{date:w,startTime:I.start_time,endTime:z.end_time,duration:K,totalPrice:X,slotCount:ye.length,isContiguous:Q}},[o,w,ye]),E=A=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",minimumFractionDigits:0}).format(A),me=!!r?.user_code,be=T.trim().toUpperCase(),Vt=n.useMemo(()=>be?ce.find(A=>A.promotion_code===be)??null:null,[ce,be]),lt=vl(ne,Vt,me,T),Fe=lt.discount,qe=lt.final,Be=lt.feedback,it=lt.feedbackClass,is=Fe>0,[Qe,tt]=n.useState(!1),[Xe,Ye]=n.useState(!1),[we,h]=n.useState(null),{register:C,handleSubmit:S,formState:{errors:W}}=yt({defaultValues:{customer_name:r?.user_name||"",customer_email:r?.email||"",payment_method:"banktransfer"}}),oe=async A=>{if(!o||!ne||!ye.length){J("Vui lòng chọn khung giờ trống trước khi tiếp tục.");return}if(Me&&!P){J("Vui lòng chọn sân trước khi tiếp tục.");return}tt(!0),J(""),Ye(!1),h(null);try{const I=typeof P=="number"?y.find(X=>X.quantity_id===P):void 0,z=typeof r?.user_code=="number"?Number(r.user_code):void 0,K={slots:ye.map(X=>{const le=typeof X.quantity_id=="number"?X.quantity_id:void 0,he=typeof X.quantity_number=="number"?X.quantity_number:void 0,Ne=Me?P:le,ie=Me?I?.quantity_number:he;return{slot_id:Number(X.slot_id),play_date:X.play_date,start_time:X.start_time,end_time:X.end_time,...typeof Ne=="number"?{quantity_id:Ne}:{},...typeof ie=="number"?{quantity_number:ie}:{}}}),payment_method:A.payment_method,total_price:qe,customer:{name:A.customer_name,email:A.customer_email,phone:A.customer_phone},notes:A.notes};typeof z=="number"&&Number.isFinite(z)&&z>0&&(K.created_by=z),Me&&typeof P=="number"&&(K.quantity_id=P),me&&be&&(K.promotion_code=be),me&&(K.isLoggedInCustomer=!0);const Z=await El(o.field_code,K);h(Z),Ye(!0),Z?.booking_code&&a(`/payment/${Z.booking_code}/transfer`,{state:{qrCode:Z.qr_code,paymentID:Z.paymentID,amount:Z.amount}})}catch(I){if(Ye(!1),I instanceof Error&&(I.message.includes("409")||I.message.includes("đã được đặt")||I.message.includes("Sân"))){const Q=I instanceof Error?I.message:"Sân này đã được đặt trong khung giờ này";if(J(Q),ye.length>0)try{if(o?.field_code&&w){M(!0);const K=await Sa(o.field_code,w);k(K.slots??[]),K.slots?.length||J("Ngày này chưa mở lịch hoặc đã kín lịch."),M(!1)}F(void 0)}catch(K){console.error("Error refreshing available quantities:",K),M(!1)}}else{const Q=Ht(I,"Không thể xác nhận thanh toán. Vui lòng thử lại.");J(Q)}}finally{tt(!1)}},Y=Pa(),ae=A=>{g(A),R([]),J("")},pe=ne?As(Math.round(ne.duration*60)):null,_e=o?.images?.[0],ct=Rt(_e?.image_url,_e?.storage)||"https://images.pexels.com/photos/274506/pexels-photo-274506.jpeg",Ue=i&&!o,Ss=!!ne;if(Xe&&we&&o&&ne){const A=(()=>{const le=we.payment_method?we.payment_method.toString().toLowerCase():"";return["banktransfer","bank_transfer"].includes(le)?"Chuyển khoản ngân hàng":le==="ewallet"?"Ví điện tử":le==="card"?"Thẻ":le==="cash"?"Tiền mặt":we.payment_method||"Không xác định"})(),I=(()=>{const le=we.payment_status?we.payment_status.toString():"";return le?le==="mock_success"?"Thanh toán mô phỏng thành công":le.replace(/_/g," ").replace(/^\w/,he=>he.toUpperCase()):"Không xác định"})(),z=we.amount_before_discount??ne.totalPrice,Q=we.amount??z,K=we.discount_amount??Math.max(z-Q,0),Z=we.transaction_id&&we.transaction_id.trim()?we.transaction_id:"Đang chờ cấp",X=we.hold_expires_at&&we.hold_expires_at.trim()?new Date(we.hold_expires_at):null;return e.jsx("div",{className:"page",children:e.jsx("div",{className:"container",children:e.jsxs("div",{className:"section text-center",children:[e.jsx("div",{className:"success-icon",children:e.jsx(ta,{className:"success-icon-inner"})}),e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Đặt sân thành công!"}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-green-800 mb-2",children:"Mã đặt sân của bạn:"}),e.jsx("div",{className:"text-3xl font-mono font-bold text-green-600 bg-white p-4 rounded border-2 border-green-300",children:we.booking_code}),e.jsx("p",{className:"text-sm text-green-700 mt-2",children:"Vui lòng lưu mã này để check-in khi đến sân."})]}),e.jsxs("div",{className:"mb-6 grid gap-3 text-left md:grid-cols-3",children:[e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-white px-4 py-3 shadow-sm",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Phương thức thanh toán"}),e.jsx("p",{className:"mt-1 text-sm font-medium text-gray-900",children:A}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Mã: ",we.payment_method]})]}),e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-white px-4 py-3 shadow-sm",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Trạng thái thanh toán"}),e.jsx("p",{className:"mt-1 text-sm font-medium text-emerald-700",children:I})]}),e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-white px-4 py-3 shadow-sm",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Mã giao dịch"}),e.jsx("p",{className:"mt-1 font-mono text-sm text-gray-900",children:Z})]})]}),e.jsxs("div",{className:"text-left bg-gray-50 rounded-lg p-6 mb-6 space-y-2",children:[e.jsx("h4",{className:"font-bold text-gray-900 mb-3",children:"Chi tiết đặt sân:"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Sân:"})," ",o.field_name]}),P&&y.length>0&&e.jsxs("div",{children:[e.jsx("strong",{children:"Số sân:"})," Sân"," ",y.find(le=>le.quantity_id===P)?.quantity_number]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Ngày:"})," ",new Date(ne.date).toLocaleDateString("vi-VN")]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Giờ:"})," ",ne.startTime," -"," ",ne.endTime," (",As(Math.round(ne.duration*60)),")"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Giá gốc:"})," ",E(z)]}),K>0&&e.jsxs("div",{className:"text-emerald-600",children:[e.jsx("strong",{children:"Giảm:"})," -",E(K),we.promotion_code?` (Mã ${we.promotion_code})`:""]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Tổng tiền:"})," ",E(Q)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Địa chỉ:"})," ",o.address]}),X&&!Number.isNaN(X.getTime())&&e.jsxs("div",{children:[e.jsx("strong",{children:"Giữ chỗ đến:"})," ",X.toLocaleString("vi-VN")]})]}),X&&!Number.isNaN(X.getTime())&&me&&e.jsxs("p",{className:"text-sm text-gray-600 mb-6",children:["Bạn có thể tiếp tục thanh toán sau trong"," ",e.jsx(ke,{to:"/cart",className:"font-medium text-emerald-600 hover:text-emerald-700",children:"Giỏ hàng"})," ","miễn là thời gian giữ chỗ còn hiệu lực."]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>a("/"),className:"btn-primary w-full",children:"Về trang chủ"}),e.jsx("button",{onClick:()=>a("/fields"),className:"btn-ghost w-full",children:"Đặt sân khác"})]}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Lưu ý:"})," Vui lòng đến sân trước 15 phút so với giờ đặt. Mang theo mã đặt sân, mã giao dịch và giấy tờ tùy thân để xác nhận. Thông tin chi tiết đã được gửi tới email của bạn."]})})]})})})}return!Xe&&!i&&b?e.jsx("div",{className:"page",children:e.jsx("div",{className:"container",children:e.jsxs("div",{className:"section text-center space-y-4",children:[e.jsx(Ce,{className:"w-12 h-12 text-red-500 mx-auto"}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Không thể tải thông tin sân"}),e.jsx("p",{className:"text-gray-600",children:b}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>{t&&(p(""),m(!0),(async()=>{try{const A=await Xs(Number(t));x(A??null),p("")}catch(A){const I=Ht(A,"Không thể tải thông tin sân. Vui lòng thử lại.");p(I),x(null)}finally{m(!1)}})())},children:"Thử lại"})]})})}):!Xe&&!i&&!o?e.jsx("div",{className:"page",children:e.jsx("div",{className:"container",children:e.jsxs("div",{className:"section text-center space-y-4",children:[e.jsx(Ce,{className:"w-12 h-12 text-amber-500 mx-auto"}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Không tìm thấy sân"}),e.jsx("p",{className:"text-gray-600",children:"Vui lòng quay lại trang chi tiết sân để chọn lại."}),e.jsx("button",{type:"button",className:"btn-primary",onClick:()=>a(`/fields/${t??""}`),children:"Quay lại trang sân"})]})})}):e.jsx("div",{className:"page bg-slate-50/80 pb-10",children:e.jsxs("div",{className:"container max-w-6xl",children:[e.jsxs("div",{className:"mb-6 flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("button",{onClick:()=>a(-1),className:"btn-link inline-flex items-center gap-2 text-sm",children:[e.jsx(at,{className:"w-5 h-5"}),"Quay lại"]}),o?.field_code&&e.jsxs("span",{className:"text-xs font-medium uppercase tracking-wide text-gray-500",children:["Mã sân: ",o.field_code]})]}),e.jsx("div",{className:"mb-8",children:e.jsxs("ol",{className:"flex flex-wrap items-center gap-3 text-sm",children:[e.jsxs("li",{className:"flex items-center gap-2 rounded-full border border-emerald-400 bg-emerald-50 px-3 py-1 text-emerald-700",children:[e.jsx("span",{className:"flex h-6 w-6 items-center justify-center rounded-full bg-emerald-500 text-xs font-semibold text-white",children:"1"}),"Chọn khung giờ"]}),e.jsxs("li",{className:`flex items-center gap-2 rounded-full border px-3 py-1 ${Ss?"border-emerald-500 bg-emerald-50 text-emerald-700":"border-gray-200 text-gray-600"}`,children:[e.jsx("span",{className:`flex h-6 w-6 items-center justify-center rounded-full text-xs font-semibold ${Ss?"bg-emerald-500 text-white":"bg-gray-200 text-gray-700"}`,children:"2"}),"Nhập thông tin"]}),e.jsxs("li",{className:"flex items-center gap-2 rounded-full border border-gray-200 px-3 py-1 text-gray-500",children:[e.jsx("span",{className:"flex h-6 w-6 items-center justify-center rounded-full bg-gray-200 text-xs font-semibold text-gray-700",children:"3"}),"Xác nhận thanh toán"]})]})}),e.jsxs("div",{className:"grid gap-8 lg:grid-cols-[2fr,1fr]",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("section",{className:"section space-y-6",children:[e.jsx("div",{children:Ue?e.jsx("div",{className:"rounded-xl border border-gray-200 bg-white/70 p-4 shadow-sm",children:e.jsxs("div",{className:"flex animate-pulse gap-4",children:[e.jsx("div",{className:"h-20 w-20 rounded-lg bg-gray-200"}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsx("div",{className:"h-4 w-2/3 rounded bg-gray-200"}),e.jsx("div",{className:"h-3 w-1/2 rounded bg-gray-200"}),e.jsx("div",{className:"h-3 w-3/4 rounded bg-gray-200"})]})]})}):o?e.jsx("div",{className:"rounded-xl border border-gray-200 bg-white/90 p-4 shadow-sm",children:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"h-20 w-20 overflow-hidden rounded-lg bg-gray-100 shadow-inner",children:e.jsx("img",{src:ct,alt:o.field_name,className:"h-full w-full object-cover"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-emerald-600",children:o.shop?.shop_name||"Cơ sở"}),e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:o.field_name}),e.jsx("p",{className:"text-sm text-gray-600",children:o.address})]})]}),e.jsxs("div",{className:"grid w-full gap-3 text-sm md:w-auto md:grid-cols-2",children:[e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-gray-50 px-3 py-2",children:[e.jsx("span",{className:"block text-xs uppercase tracking-wide text-gray-500",children:"Giá / giờ"}),e.jsx("span",{className:"mt-1 block font-semibold text-gray-900",children:(()=>{const A=Bt(o);return A>0?E(A):"Liên hệ"})()})]}),e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-gray-50 px-3 py-2",children:[e.jsx("span",{className:"block text-xs uppercase tracking-wide text-gray-500",children:"Loại sân"}),e.jsx("span",{className:"mt-1 block font-semibold text-gray-900 capitalize",children:Ze(o.sport_type)})]})]})]})}):e.jsxs("div",{className:"flex items-start gap-2 rounded-lg border border-yellow-200 bg-yellow-50 px-4 py-3 text-yellow-700",children:[e.jsx(Ce,{className:"h-5 w-5 shrink-0"}),e.jsx("span",{children:"Không tìm thấy thông tin sân. Vui lòng quay lại trang trước."})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-baseline md:justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"1. Chọn ngày và khung giờ"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Lịch trống hiển thị theo thời gian thực từ hệ thống quản lý của sân."})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-[220px,1fr]",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"label inline-flex items-center gap-2",children:[e.jsx(Wt,{className:"h-4 w-4"}),"Ngày đặt"]}),e.jsx("input",{type:"date",className:"input",min:Y,value:w,onChange:A=>ae(A.target.value),disabled:Ue})]}),e.jsx("div",{className:"rounded-lg border border-dashed border-emerald-200 bg-emerald-50/70 px-4 py-3 text-sm text-emerald-700",children:Ss&&ne?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("span",{children:["Đã chọn"," ",new Date(ne.date).toLocaleDateString("vi-VN")," ","• ",ne.startTime," -"," ",ne.endTime," (",pe,","," ",ne.slotCount," khung giờ)"]}),!ne.isContiguous&&e.jsx("span",{className:"block text-xs text-amber-700",children:"Lưu ý: các khung giờ đã chọn không liền kề nhau."})]}):e.jsx("span",{children:"Chọn ngày và khung giờ phù hợp để tiếp tục điền thông tin đặt sân."})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label inline-flex items-center gap-2",children:[e.jsx(Se,{className:"h-4 w-4"}),"Khung giờ trống"]}),u?e.jsxs("div",{className:"flex items-center gap-3 text-gray-600",children:[e.jsx("div",{className:"spinner"}),"Đang tải khung giờ..."]}):ze.length>0?e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid gap-3 sm:grid-cols-2 xl:grid-cols-3",children:ze.map(A=>{const I=A.baseSlot,z=Kl(I),Q=!A.isFullyBooked,{isHeld:K,isBooked:Z,isBlocked:X,normalizedStatus:le}=z,he=typeof P=="number"&&A.courts.some(Te=>typeof Te.quantity_id=="number"&&Te.quantity_id===P),Ne=Q&&V.includes(I.slot_id),ie=Ge(I.end_time)-Ge(I.start_time),fe=ie>0?As(ie):"",ue=K?Rl(I.hold_expires_at,I.hold_expires_at_ts??null):"",ee=Q?z.isAvailable?"Có thể đặt":K?"Đang giữ chỗ":Z?"Có thể đặt":X?"Không khả dụng":le?le.replace(/_/g," ").replace(/^\w/,Te=>Te.toUpperCase()):"Không khả dụng":"Đã hết sân",je=Ne?"bg-emerald-500 text-white":Q?"bg-emerald-100 text-emerald-700":K?"bg-amber-100 text-amber-700":"bg-gray-200 text-gray-600",Ee=["relative flex h-full flex-col gap-2 rounded-xl border px-4 py-3 text-left transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400 focus-visible:ring-offset-1",Ne?"border-emerald-500 bg-emerald-50 shadow-sm":K?"border-amber-200 bg-amber-50/70":Q?"border-gray-200 bg-white hover:border-emerald-300 hover:bg-emerald-50/60":"border-gray-200 bg-gray-100 text-gray-500",he&&!Ne?"ring-1 ring-emerald-200":"",Q?"":"cursor-not-allowed opacity-70"].join(" "),Re=A.courts.length,Ot=A.courts.map(Te=>({status:Ds(Te.status,Te.hold_expires_at??null,Te.hold_expires_at_ts??null),holdExpiresAt:Te.hold_expires_at??null,holdExpiresAtTs:Te.hold_expires_at_ts??null})),cs=Ot.filter(Te=>Te.status==="available").length,Cs=Ot.filter(Te=>Te.status==="held").length;return e.jsxs("button",{type:"button",onClick:()=>{Q&&(R(Te=>{const ca=Te.includes(I.slot_id)?Te.filter(Ke=>Ke!==I.slot_id):[...Te,I.slot_id];if(!ca.length)return[];const jn=new Map(He.map(Ke=>[Ke.slot_id,Ke]));return ca.map(Ke=>jn.get(Ke)).filter(Ke=>!!Ke).sort((Ke,yn)=>Ke.start_time.localeCompare(yn.start_time)).map(Ke=>Ke.slot_id)}),J(""))},disabled:!Q,className:Ee,"aria-pressed":Ne,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("span",{className:"font-semibold text-gray-900",children:[I.start_time," - ",I.end_time]}),e.jsx("span",{className:`rounded-full px-2 py-0.5 text-xs font-medium ${je}`,children:ee})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsx("span",{children:fe}),e.jsxs("div",{className:"flex items-center gap-2",children:[Re>0&&e.jsxs("span",{className:"rounded-full bg-emerald-50 px-2 py-0.5 font-medium text-emerald-700",children:[cs,"/",Re," sân trống"]}),Cs>0&&e.jsxs("span",{className:"font-medium text-amber-600",children:[Cs," sân đang giữ"]}),ue&&e.jsxs("span",{className:"font-medium text-amber-600",children:["Giữ đến ",ue]})]})]}),!Q&&Re>0&&e.jsx("span",{className:"text-xs text-gray-500",children:"Khung giờ này đã hết sân."})]},I.slot_id)})})}):e.jsxs("div",{className:"flex items-start gap-2 rounded-lg border border-yellow-200 bg-yellow-50 px-4 py-3 text-yellow-700",children:[e.jsx(Ce,{className:"h-5 w-5 shrink-0"}),e.jsx("span",{children:U||"Ngày này chưa có lịch trống được mở."})]}),U&&ze.length>0&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:U})]}),ne&&e.jsx("div",{className:"rounded-xl border border-emerald-200 bg-emerald-50 px-4 py-4",children:e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-emerald-700",children:"Khung giờ đã chọn"}),e.jsxs("p",{className:"text-base font-semibold text-emerald-900",children:[new Date(ne.date).toLocaleDateString("vi-VN")," ","• ",ne.startTime," -"," ",ne.endTime]})]}),e.jsxs("div",{className:"text-sm text-emerald-700",children:[e.jsx("span",{className:"font-medium",children:"Thời lượng:"})," ",pe,e.jsx("span",{className:"ml-3 font-medium",children:"Khung giờ:"})," ",ne.slotCount]})]})}),ye.length>0&&(Me||N||y.length>0)&&e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:e.jsx(Al,{courts:y,selectedQuantityID:P,onSelectCourt:F,loading:N})})]})]}),e.jsxs("section",{className:"section space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-baseline md:justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"2. Thông tin người đặt"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Nhập chính xác để nhận mã đặt sân và thông báo từ hệ thống."})]}),!o||!ne?e.jsx("div",{className:"rounded-lg border border-blue-200 bg-blue-50 px-4 py-3 text-blue-700",children:"Vui lòng chọn ngày và khung giờ trước khi nhập thông tin đặt sân."}):e.jsxs("form",{onSubmit:S(oe),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"label text-sm font-medium text-gray-700",children:["Họ và tên ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ws,{className:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",...C("customer_name",{required:"Vui lòng nhập họ và tên",minLength:{value:2,message:"Ít nhất 2 ký tự"}}),className:"input pl-10",placeholder:"Nhập họ và tên của bạn"})]}),W.customer_name&&e.jsx("p",{className:"text-sm text-red-500",children:W.customer_name.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"label text-sm font-medium text-gray-700",children:["Email ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Nt,{className:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"email",...C("customer_email",{required:"Vui lòng nhập email",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Email không hợp lệ"}}),className:"input pl-10",placeholder:"Nhập email của bạn"})]}),W.customer_email&&e.jsx("p",{className:"text-sm text-red-500",children:W.customer_email.message})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"label text-sm font-medium text-gray-700",children:["Số điện thoại ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(rs,{className:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"tel",...C("customer_phone",{required:"Vui lòng nhập số điện thoại",pattern:{value:/^[0-9]{10,11}$/,message:"Số điện thoại phải có 10-11 chữ số"}}),className:"input pl-10",placeholder:"Nhập số điện thoại của bạn",inputMode:"tel"})]}),W.customer_phone&&e.jsx("p",{className:"text-sm text-red-500",children:W.customer_phone.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"label inline-flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx($t,{className:"h-4 w-4"}),"Phương thức thanh toán"]}),e.jsxs("label",{className:"radio-tile",children:[e.jsx("input",{type:"radio",value:"banktransfer",...C("payment_method"),defaultChecked:!0}),e.jsxs("div",{className:"radio-body",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-gray-900",children:"Chuyển khoản ngân hàng"}),e.jsx("span",{className:"rounded-full bg-emerald-100 px-2 py-0.5 text-xs font-medium text-emerald-700",children:"Khuyến nghị"})]}),e.jsx("p",{className:"card-subtitle",children:"Thanh toán an toàn qua chuyển khoản sau khi hệ thống xác nhận giữ chỗ."})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Hướng dẫn chuyển khoản chi tiết sẽ được gửi qua email cùng mã đặt sân."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"label text-sm font-medium text-gray-700",children:"Ghi chú (tùy chọn)"}),e.jsx("textarea",{...C("notes"),rows:3,className:"input min-h-[100px] resize-y",placeholder:"Ví dụ: muốn mượn bóng, yêu cầu chuẩn bị nước uống..."})]}),e.jsx("button",{type:"submit",disabled:Qe,className:"btn-primary flex w-full items-center justify-center gap-3","aria-busy":Qe,children:Qe?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-5 w-5 rounded-full border-2 border-white border-t-transparent animate-spin"}),e.jsx("span",{children:"Đang xử lý thanh toán..."})]}):e.jsxs(e.Fragment,{children:[e.jsx($t,{className:"h-5 w-5"}),e.jsx("span",{children:"Xác nhận đặt sân"})]})})]})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("aside",{className:"section sticky top-8 space-y-5",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Tóm tắt đặt sân"}),Ue?e.jsx("div",{className:"loading-wrap",children:e.jsx("div",{className:"spinner"})}):o?e.jsxs("div",{className:"space-y-5",children:[e.jsx("div",{className:"overflow-hidden rounded-xl border border-gray-200",children:e.jsx("img",{src:ct,alt:o.field_name,className:"h-40 w-full object-cover"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:o.field_name}),e.jsx("p",{className:"text-sm text-gray-600 capitalize",children:Ze(o.sport_type)}),e.jsx("p",{className:"text-sm text-gray-500",children:o.address}),o.shop?.shop_name&&e.jsx("p",{className:"text-xs font-medium uppercase tracking-wide text-gray-500",children:o.shop.shop_name})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Wt,{className:"h-4 w-4"}),"Ngày"]}),e.jsx("span",{className:"font-medium",children:ne?new Date(ne.date).toLocaleDateString("vi-VN"):"-"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Se,{className:"h-4 w-4"}),"Giờ"]}),e.jsx("span",{className:"font-medium",children:ne?`${ne.startTime} - ${ne.endTime}`:"-"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Thời lượng"}),e.jsx("span",{className:"font-medium",children:pe??"-"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Số khung giờ"}),e.jsx("span",{className:"font-medium",children:ne?ne.slotCount:"-"})]}),ne&&!ne.isContiguous&&e.jsx("div",{className:"rounded border border-amber-200 bg-amber-50 px-3 py-2 text-xs text-amber-800",children:"Các khung giờ được chọn không liền nhau. Vui lòng kiểm tra lại trước khi xác nhận."})]}),e.jsxs("div",{className:"space-y-2 rounded-xl border border-gray-200 bg-white px-4 py-3",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-semibold text-gray-700",children:[e.jsx(er,{className:"h-4 w-4"})," Mã khuyến mãi"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:T,onChange:A=>se(A.target.value.toUpperCase()),placeholder:"Nhập mã (nếu có)",className:"input flex-1 uppercase",disabled:de}),T?e.jsx("button",{type:"button",className:"btn-outline shrink-0",onClick:()=>se(""),title:"Xoá mã khuyến mãi",children:e.jsx(Lr,{className:"h-4 w-4"})}):null]}),de&&e.jsx("p",{className:"text-xs text-gray-500",children:"Đang tải khuyến mãi..."}),Je&&e.jsx("p",{className:"text-xs text-red-600",children:Je}),Be&&e.jsx("p",{className:`text-xs ${it}`,children:Be}),ce.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 pt-1",children:ce.map(A=>{const I=A.promotion_code===be,z=ne?ne.totalPrice>=(A.min_order_amount??0):!1;return e.jsx("button",{type:"button",onClick:()=>se(A.promotion_code),title:A.title,className:`rounded-full border px-3 py-1 text-xs font-semibold transition ${I?"border-emerald-500 bg-emerald-50 text-emerald-600":"border-gray-200 text-gray-600 hover:border-emerald-400"} ${z?"":"opacity-60"}`,children:A.promotion_code},A.promotion_id)})})]}),e.jsxs("div",{className:"rounded-xl border border-emerald-200 bg-emerald-50 px-4 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-700",children:[e.jsx("span",{children:"Giá gốc"}),e.jsx("span",{className:"font-medium",children:ne?E(ne.totalPrice):"-"})]}),is&&e.jsxs("div",{className:"mt-1 flex items-center justify-between text-sm text-emerald-600",children:[e.jsx("span",{children:"Giảm"}),e.jsxs("span",{children:["-",E(Fe)]})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-lg font-bold",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ft,{className:"h-5 w-5"}),"Tạm tính"]}),e.jsx("span",{className:"text-emerald-600",children:ne?E(qe):"-"})]}),e.jsxs("p",{className:"mt-2 text-xs text-emerald-700",children:["Giá tạm tính dựa trên thời lượng đã chọn.",is?" Đã bao gồm khuyến mãi áp dụng.":" Hoàn tất thanh toán để đảm bảo giữ chỗ."]})]}),e.jsx("div",{className:"rounded-lg border border-blue-200 bg-blue-50 px-4 py-3 text-xs text-blue-800",children:"Sau khi xác nhận, mã đặt sân và hướng dẫn thanh toán sẽ được gửi qua email và hiển thị trong lịch sử đặt sân của bạn."})]}):e.jsx("div",{className:"card-subtitle",children:"Không tìm thấy thông tin sân."})]})})]})]})})},ht=(t,s)=>{if(t instanceof Error)return t.message;const a=t,r=a.response?.data;return r?.error?.message||r?.message||a.message||s},Ul=t=>typeof t!="number"?"-":new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",minimumFractionDigits:0}).format(t),Gl=t=>{const s={pending:{bg:"bg-amber-100",text:"text-amber-700",label:"Chờ xác nhận"},confirmed:{bg:"bg-emerald-100",text:"text-emerald-700",label:"Đã xác nhận"},cancelled:{bg:"bg-red-100",text:"text-red-700",label:"Đã hủy"},completed:{bg:"bg-blue-100",text:"text-blue-700",label:"Hoàn thành"}};return{...s[t]||s.pending,value:t}},Ql=t=>{const s={pending:{bg:"bg-amber-100",text:"text-amber-700",label:"Chưa thanh toán"},paid:{bg:"bg-emerald-100",text:"text-emerald-700",label:"Đã thanh toán"},failed:{bg:"bg-red-100",text:"text-red-700",label:"Thanh toán thất bại"},refunded:{bg:"bg-gray-100",text:"text-gray-700",label:"Đã hoàn tiền"}};return{...s[t]||s.pending,value:t}},Xl=t=>{const s=String(t??"").toLowerCase();return["held","holding","on_hold","pending","pending_hold"].includes(s)?{bg:"bg-amber-100",text:"text-amber-700",label:"Đang giữ chỗ"}:["cancelled","canceled"].includes(s)?{bg:"bg-red-100",text:"text-red-700",label:"Đã hủy"}:["available"].includes(s)?{bg:"bg-emerald-50",text:"text-emerald-700",label:"Trống"}:["booked","confirmed","reserved"].includes(s)?{bg:"bg-emerald-100",text:"text-emerald-700",label:"Đã đặt"}:{bg:"bg-gray-100",text:"text-gray-700",label:t||"Không xác định"}},Yl=()=>{const{bookingCode:t}=Kt(),s=We(),[a,r]=n.useState(!0),[l,d]=n.useState(null),[c,f]=n.useState(null);if(n.useEffect(()=>{let x=!1;if(!t){d("Thiếu mã booking."),r(!1);return}return(async()=>{r(!0),d(null);try{console.log("🔍 BookingDetailPage: bookingCode param =",t);const i=await hn(t);console.log("✅ Booking detail response:",i),x||f(i.data?i.data:null)}catch(i){console.error("❌ Error fetching booking detail:",i),x||d(ht(i,"Không thể tải chi tiết đặt sân. Vui lòng thử lại."))}finally{x||r(!1)}})(),()=>{x=!0}},[t]),a)return e.jsx("div",{className:"page bg-slate-50/80 pb-10 min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-3 text-gray-700",children:[e.jsx("div",{className:"h-8 w-8 rounded-full border-3 border-gray-300 border-t-emerald-500 animate-spin"}),e.jsx("span",{className:"text-lg",children:"Đang tải chi tiết đặt sân..."})]})});if(l)return e.jsx("div",{className:"page bg-slate-50/80 pb-10 min-h-screen flex items-center justify-center px-4",children:e.jsx("div",{className:"container max-w-2xl",children:e.jsxs("div",{className:"section text-center space-y-6",children:[e.jsx(Ce,{className:"w-16 h-16 text-red-500 mx-auto"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Lỗi tải dữ liệu"}),e.jsx("p",{className:"text-gray-600 text-lg",children:l})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsxs("button",{onClick:()=>s(-1),className:"btn-primary inline-flex items-center justify-center gap-2",children:[e.jsx(at,{className:"w-4 h-4"}),"Quay lại"]}),e.jsx("button",{onClick:()=>s("/"),className:"btn-ghost inline-flex items-center justify-center gap-2",children:"Về trang chủ"})]})]})})});if(!c||!c.BookingCode)return e.jsx("div",{className:"page bg-slate-50/80 pb-10 min-h-screen flex items-center justify-center px-4",children:e.jsx("div",{className:"container max-w-2xl",children:e.jsxs("div",{className:"section text-center space-y-6",children:[e.jsx(Ce,{className:"w-16 h-16 text-amber-500 mx-auto"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Không tìm thấy đặt sân"}),e.jsx("p",{className:"text-gray-600",children:"Mã booking không hợp lệ hoặc đã bị xóa."})]}),e.jsxs("button",{onClick:()=>s(-1),className:"btn-primary inline-flex items-center justify-center gap-2",children:[e.jsx(at,{className:"w-4 h-4"}),"Quay lại"]})]})})});const j=Gl(c.BookingStatus||"pending"),o=Ql(c.PaymentStatus||"pending");return e.jsx("div",{className:"page bg-slate-50/80 pb-10",children:e.jsxs("div",{className:"container max-w-4xl",children:[e.jsxs("button",{onClick:()=>s(-1),className:"btn-link inline-flex items-center gap-2 text-sm mb-6",children:[e.jsx(at,{className:"w-5 h-5"}),"Quay lại"]}),e.jsxs("div",{className:"section space-y-6",children:[e.jsx("div",{className:"space-y-4 pb-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Chi Tiết Đặt Sân"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Mã booking:"," ",e.jsx("span",{className:"font-mono font-semibold text-gray-900",children:c.BookingCode})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:`rounded-full px-4 py-2 text-sm font-semibold text-center ${j.bg} ${j.text}`,children:j.label}),e.jsx("span",{className:`rounded-full px-4 py-2 text-sm font-semibold text-center ${o.bg} ${o.text}`,children:o.label})]})]})}),(c.FieldName||c.ShopName)&&e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-white px-4 py-3",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500 mb-1",children:"Chi nhánh"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:c.FieldName||"-"})]}),e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-white px-4 py-3",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500 mb-1",children:"Cơ sở"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:c.ShopName||"-"})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"rounded-xl border border-emerald-200 bg-emerald-50 px-6 py-4",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-emerald-700 mb-2 flex items-center gap-1",children:"Sân"}),e.jsxs("span",{className:"text-2xl font-bold text-emerald-900",children:["Sân ",c.slots[0].QuantityNumber]})]}),e.jsxs("div",{className:"rounded-xl border border-blue-200 bg-blue-50 px-6 py-4",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-blue-700 mb-2 flex items-center gap-1",children:"Tổng tiền"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:Ul(c.TotalPrice)})]})]}),c.slots&&c.slots.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-lg font-semibold text-gray-900",children:[e.jsx(Se,{className:"w-5 h-5"}),"Khung giờ đã đặt"]}),e.jsx("div",{className:"rounded-lg border border-gray-200 divide-y bg-white",children:c.slots.map((x,i)=>e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 px-4 py-3",children:[e.jsx("span",{className:"text-sm text-gray-600",children:x.PlayDate?new Date(x.PlayDate).toLocaleDateString("vi-VN"):"-"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[x.StartTime," - ",x.EndTime]}),e.jsxs("div",{className:"flex items-center gap-2",children:[typeof x.QuantityID=="number"&&e.jsxs("span",{className:"rounded-full bg-slate-100 px-2.5 py-0.5 text-xs font-medium text-slate-700",children:["Sân ",x.QuantityNumber]}),(()=>{const m=Xl(x.Status);return e.jsx("span",{className:`rounded-full px-2.5 py-0.5 text-xs font-semibold ${m.bg} ${m.text}`,children:m.label})})()]})]},i))})]}),(c.CustomerName||c.CustomerEmail||c.CustomerPhone)&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-lg font-semibold text-gray-900",children:[e.jsx(dr,{className:"w-5 h-5"}),"Thông tin người đặt"]}),e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-white p-4 space-y-3",children:[c.CustomerName&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500 mb-1",children:"Họ và tên"}),e.jsx("p",{className:"text-gray-900",children:c.CustomerName})]}),c.CustomerEmail&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500 mb-1",children:"Email"}),e.jsx("p",{className:"text-gray-900 break-all",children:c.CustomerEmail})]}),c.CustomerPhone&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500 mb-1",children:"Số điện thoại"}),e.jsx("p",{className:"text-gray-900",children:c.CustomerPhone})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>s(`/bookings/${c.BookingCode}/checkin-code`),className:"btn-primary flex-1 flex items-center justify-center gap-2",children:"Xem Mã Check-in"}),e.jsx("button",{onClick:()=>s(-1),className:"btn-ghost flex-1",children:"Quay lại"})]}),e.jsxs("div",{className:"rounded-lg border border-blue-200 bg-blue-50 px-4 py-3 text-sm text-blue-800",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Thông tin cần biết:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-xs",children:[e.jsx("li",{children:"Vui lòng đến sân 15 phút trước giờ đặt"}),e.jsx("li",{children:"Mang theo mã check-in để xác nhận khi check-in"})]})]})]})]})})},Zl=()=>{const{bookingCode:t}=Kt(),s=We(),[a,r]=n.useState(!0),[l,d]=n.useState(null),[c,f]=n.useState(null),[j,o]=n.useState(!1);n.useEffect(()=>{let i=!1;if(!t){d("Thiếu mã booking."),r(!1);return}return(async()=>{r(!0),d(null);try{console.log("🔍 CheckinCodePage: bookingCode param =",t);const m=await Pl(t);console.log("✅ Checkin code response:",m),i||f(m.data||null)}catch(m){console.error("❌ Error fetching checkin code:",m),i||d(ht(m,"Không thể tải mã check-in. Vui lòng thử lại."))}finally{i||r(!1)}})(),()=>{i=!0}},[t]);const x=()=>{c?.checkinCode&&navigator.clipboard.writeText(c.checkinCode).then(()=>{o(!0),setTimeout(()=>o(!1),2e3)})};return a?e.jsx("div",{className:"page bg-slate-50/80 pb-10 min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-3 text-gray-700",children:[e.jsx("div",{className:"h-8 w-8 rounded-full border-3 border-gray-300 border-t-emerald-500 animate-spin"}),e.jsx("span",{className:"text-lg",children:"Đang tải mã check-in..."})]})}):l?e.jsx("div",{className:"page bg-slate-50/80 pb-10 min-h-screen flex items-center justify-center px-4",children:e.jsx("div",{className:"container max-w-2xl",children:e.jsxs("div",{className:"section text-center space-y-6",children:[e.jsx(Ce,{className:"w-16 h-16 text-red-500 mx-auto"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Lỗi tải dữ liệu"}),e.jsx("p",{className:"text-gray-600 text-lg",children:l})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsxs("button",{onClick:()=>s(-1),className:"btn-primary inline-flex items-center justify-center gap-2",children:[e.jsx(at,{className:"w-4 h-4"}),"Quay lại"]}),e.jsx("button",{onClick:()=>s("/"),className:"btn-ghost inline-flex items-center justify-center gap-2",children:"Về trang chủ"})]})]})})}):!c||!c.checkinCode?e.jsx("div",{className:"page bg-slate-50/80 pb-10 min-h-screen flex items-center justify-center px-4",children:e.jsx("div",{className:"container max-w-2xl",children:e.jsxs("div",{className:"section text-center space-y-6",children:[e.jsx(Ce,{className:"w-16 h-16 text-amber-500 mx-auto"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Không tìm thấy mã check-in"}),e.jsx("p",{className:"text-gray-600",children:"Mã booking không hợp lệ hoặc chưa có mã check-in."})]}),e.jsxs("button",{onClick:()=>s(-1),className:"btn-primary inline-flex items-center justify-center gap-2",children:[e.jsx(at,{className:"w-4 h-4"}),"Quay lại"]})]})})}):e.jsx("div",{className:"page bg-gradient-to-br from-emerald-50 to-blue-50 pb-10",children:e.jsxs("div",{className:"container max-w-2xl",children:[e.jsxs("button",{onClick:()=>s(-1),className:"btn-link inline-flex items-center gap-2 text-sm mb-6 mt-4",children:[e.jsx(at,{className:"w-5 h-5"}),"Quay lại"]}),e.jsxs("div",{className:"section space-y-8",children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-emerald-100",children:e.jsx(Nr,{className:"w-8 h-8 text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Mã Check-In"}),e.jsx("p",{className:"text-gray-600",children:"Sử dụng mã này để check-in khi đến sân"})]})]}),e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-white px-4 py-3",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500 mb-1",children:"Mã Booking"}),e.jsx("p",{className:"font-mono text-lg font-semibold text-gray-900 break-all",children:c.bookingCode})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"relative rounded-2xl border-2 border-emerald-300 bg-gradient-to-br from-emerald-50 to-emerald-100 p-8 shadow-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-widest text-emerald-700 mb-3",children:"Mã Check-in"}),e.jsx("div",{className:"font-mono text-5xl font-bold text-emerald-900 tracking-wider mb-4 select-all",children:c.checkinCode}),e.jsx("p",{className:"text-sm text-emerald-700",children:"Vui lòng xuất trình mã này khi đến sân"})]})}),e.jsxs("button",{onClick:x,className:`w-full flex items-center justify-center gap-2 px-4 py-3 rounded-lg border font-medium transition ${j?"bg-emerald-50 border-emerald-300 text-emerald-700":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(rr,{className:"w-5 h-5"}),j?"✓ Đã sao chép":"Sao chép mã"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"📋 Hướng dẫn check-in"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-4 rounded-lg border border-blue-200 bg-blue-50 p-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-blue-200 font-semibold text-blue-700",children:"1"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900",children:"Đến sân trước 15 phút so với giờ đặt"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Vui lòng đến đúng giờ để có thể chuẩn bị"})]})]}),e.jsxs("div",{className:"flex gap-4 rounded-lg border border-blue-200 bg-blue-50 p-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-blue-200 font-semibold text-blue-700",children:"2"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900",children:"Báo mã check-in này cho nhân viên sân"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Nhân viên sẽ xác nhận thông tin đặt sân của bạn"})]})]})]})]}),e.jsxs("div",{className:"rounded-lg border border-amber-200 bg-amber-50 px-4 py-3 text-sm text-amber-800",children:[e.jsx("p",{className:"font-semibold mb-2",children:"⚠️ Lưu ý quan trọng:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-xs",children:[e.jsx("li",{children:"Mã check-in này chỉ có hiệu lực vào ngày đặt"}),e.jsx("li",{children:"Liên hệ cơ sở nếu có bất kỳ thay đổi nào"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>s(`/bookings/${c.bookingCode}`),className:"btn-primary flex-1 flex items-center justify-center gap-2",children:"Xem Chi Tiết Booking"}),e.jsx("button",{onClick:()=>s(-1),className:"btn-ghost flex items-center justify-center flex-1",children:"Quay lại"})]})]})]})})},Wl=async()=>(await H.get("/cart")).data,Jl=new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",maximumFractionDigits:0}),$s=t=>Jl.format(t||0),ei=t=>{if(t<=0)return"0 giây";const s=Math.floor(t/60),a=t%60;return s<=0?`${a} giây`:`${s} phút ${a.toString().padStart(2,"0")} giây`},ti=()=>{const[t,s]=n.useState([]),[a,r]=n.useState(!0),[l,d]=n.useState(null),[c,f]=n.useState(()=>Date.now()),[j,o]=n.useState({}),x=We(),i=n.useCallback(async()=>{try{r(!0),d(null);const _=(await Wl()).data;s(_?.items??[])}catch(g){const _=ht(g,"Không thể tải giỏ hàng");d(_),s([])}finally{r(!1)}},[]);n.useEffect(()=>{i()},[i]),n.useEffect(()=>{const g=setInterval(()=>f(Date.now()),1e3);return()=>clearInterval(g)},[]);const m=n.useCallback(g=>{const _=new Date(g.expiresAt).getTime();return Number.isNaN(_)?0:Math.max(0,Math.floor((_-c)/1e3))},[c]);n.useEffect(()=>{if(t.length===0)return;t.some(_=>m(_)<=0&&!j[_.bookingCode])&&i()},[t,m,i,j]);const b=g=>{x(`/payment/${g}/transfer`)},p=async g=>{if(window.confirm("Bạn có chắc chắn muốn hủy giữ chỗ cho đơn này? Khung giờ sẽ được mở lại cho khách khác.")){o(_=>({..._,[g.bookingCode]:!0}));try{await Ml(g.bookingCode.toString()),await i()}catch(_){const k=ht(_,"Không thể hủy giữ chỗ");d(k)}finally{o(_=>{const k={..._};return delete k[g.bookingCode],k})}}},w=n.useMemo(()=>t.reduce((g,_)=>g+(_.totalPrice||0),0),[t]);return e.jsx("div",{className:"page",children:e.jsx("div",{className:"container",children:e.jsxs("section",{className:"section space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"flex items-center gap-2 text-3xl font-bold text-gray-900",children:[e.jsx(zs,{className:"h-7 w-7 text-emerald-600"}),"Giỏ hàng của bạn"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Các đơn giữ chỗ sẽ hết hạn sau 15 phút kể từ thời điểm xác nhận."}),t.length>0&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Tổng giá trị đang giữ: ",$s(w)]})]}),e.jsxs("button",{onClick:i,disabled:a,className:"inline-flex items-center gap-2 rounded-lg border border-emerald-200 px-4 py-2 text-sm font-medium text-emerald-700 transition hover:bg-emerald-50 disabled:cursor-not-allowed disabled:opacity-60",children:[e.jsx(bt,{className:"h-4 w-4"}),"Làm mới"]})]}),l&&e.jsxs("div",{className:"flex items-start gap-3 rounded-lg border border-red-200 bg-red-50 p-4 text-red-700",children:[e.jsx(Ce,{className:"mt-0.5 h-5 w-5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Đã xảy ra lỗi"}),e.jsx("p",{className:"text-sm",children:l})]})]}),a?e.jsx("div",{className:"flex justify-center py-16",children:e.jsx(Ja,{size:"lg"})}):t.length===0?e.jsxs("div",{className:"rounded-2xl border border-dashed border-gray-300 bg-white p-12 text-center",children:[e.jsx(zs,{className:"mx-auto h-12 w-12 text-gray-300"}),e.jsx("h2",{className:"mt-4 text-2xl font-semibold text-gray-900",children:"Giỏ hàng đang trống"}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Bạn chưa giữ sân nào. Hãy khám phá các sân và đặt lịch ngay."}),e.jsx("button",{onClick:()=>x("/fields"),className:"btn-primary mt-6 inline-flex items-center justify-center",children:"Khám phá sân"})]}):e.jsx("div",{className:"space-y-6",children:t.map(g=>{const _=m(g),k=_<=0;return e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-6 shadow-sm transition hover:shadow-md",children:[e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:g.fieldName}),e.jsx("p",{className:"text-sm capitalize text-gray-500",children:g.sportType}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(ns,{className:"h-4 w-4 text-emerald-600"}),e.jsx("span",{children:g.address??"Chưa cập nhật"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx($t,{className:"h-4 w-4 text-emerald-600"}),e.jsxs("span",{children:["Tổng tiền:"," ",e.jsx("span",{className:"font-semibold text-gray-900",children:$s(g.totalPrice)})]})]}),g.discountAmount>0&&e.jsxs("p",{className:"text-xs text-emerald-600",children:["Tiết kiệm ",$s(g.discountAmount),g.promotionCode?` với mã ${g.promotionCode}`:""]})]}),e.jsxs("div",{className:"text-right space-y-2",children:[e.jsxs("div",{className:`inline-flex items-center gap-2 rounded-full px-3 py-1 text-sm font-medium ${k?"bg-red-50 text-red-600":_<=120?"bg-amber-50 text-amber-700":"bg-emerald-50 text-emerald-700"}`,children:[e.jsx(Se,{className:"h-4 w-4"}),k?"Đã hết thời gian giữ":`Giữ chỗ còn ${ei(_)}`]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Tạo lúc:"," ",new Date(g.createdAt).toLocaleString("vi-VN")]})]})]}),e.jsxs("div",{className:"mt-5 grid gap-4 md:grid-cols-[2fr_1fr]",children:[e.jsxs("div",{className:"rounded-xl bg-gray-50 p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700",children:"Khung giờ đã giữ"}),e.jsx("div",{className:"mt-3 space-y-2 text-sm text-gray-700",children:g.slots.map(u=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-gray-200 bg-white px-3 py-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Wt,{className:"h-4 w-4 text-emerald-600"}),e.jsx("span",{children:new Date(u.playDate).toLocaleDateString("vi-VN")})]}),e.jsxs("div",{className:"font-medium text-gray-900",children:[u.startTime," - ",u.endTime]})]},`${u.bookingCode}-${u.playDate}-${u.startTime}`))})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("button",{onClick:()=>b(g.bookingCode),disabled:k||!!j[g.bookingCode],className:"btn-primary flex w-full items-center justify-center gap-2 disabled:cursor-not-allowed disabled:opacity-60",children:[e.jsx($t,{className:"h-4 w-4"}),"Thanh toán ngay"]}),e.jsxs("button",{onClick:()=>p(g),disabled:!!j[g.bookingCode],className:"flex w-full items-center justify-center gap-2 rounded-lg border border-red-200 bg-white px-4 py-2 text-sm font-medium text-red-600 transition hover:bg-red-50 disabled:cursor-not-allowed disabled:opacity-60",children:[e.jsx(Pt,{className:"h-4 w-4"}),"Hủy giữ chỗ"]})]})]})]},g.cartId)})})]})})})},si=()=>{const{register:t,handleSubmit:s,formState:{errors:a}}=yt({mode:"onChange"}),[r,l]=n.useState(!1),[d,c]=n.useState(null),f=s(async({email:o})=>{c(null),l(!0);const x=o.trim();try{await zn(x),c({type:"success",message:"Liên kết đặt lại mật khẩu đã được gửi. Vui lòng kiểm tra hộp thư."})}catch{c({type:"error",message:"Đã có lỗi xảy ra. Vui lòng thử lại sau."})}finally{l(!1)}}),j=d?.type==="success";return e.jsxs("div",{className:"hero min-h-screen flex items-center justify-center py-12 px-4",children:[e.jsx("div",{className:"hero-pattern"}),e.jsxs("div",{className:"max-w-md w-full relative space-y-6",children:[j?e.jsxs("div",{className:"hero-card text-center p-8",children:[e.jsx("div",{className:"shop-brand justify-center mb-4",children:e.jsx("div",{className:"shop-brand-logo bg-[var(--brand-500)] text-white",children:e.jsx(nt,{className:"w-8 h-8"})})}),e.jsx("h2",{className:"hero-card-title mb-2",children:"Đã gửi liên kết!"}),e.jsx("p",{className:"hero-card-subtitle",children:d.message})]}):e.jsxs("div",{className:"hero-card p-8",children:[e.jsx("div",{className:"hero-card-header mb-6",children:e.jsxs("div",{className:"shop-brand mb-4",children:[e.jsx("div",{className:"shop-brand-logo bg-[var(--brand-600)] text-white",children:e.jsx(Zt,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"hero-card-title",children:"Quên mật khẩu"}),e.jsx("p",{className:"hero-card-subtitle",children:"Nhập email để nhận liên kết đặt lại."})]})]})}),e.jsxs("form",{onSubmit:f,className:"space-y-5",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"label text-white/80",children:[e.jsx(Nt,{className:"w-4 h-4 inline mr-2"}),"Email"]}),e.jsx("input",{type:"email",...t("email",{required:"Vui lòng nhập email",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Email không hợp lệ"}}),className:"input",placeholder:"nhap@email.com"}),a.email&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:a.email.message}),d?.type==="error"&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:d.message})]}),e.jsx("button",{type:"submit",disabled:r,className:"btn-primary w-full",title:r?"Đang xử lý":"Gửi liên kết đặt lại",children:r?"Đang xử lý...":"Gửi liên kết"})]})]}),e.jsxs(ke,{to:"/login",className:"hero-shortcut",children:[e.jsx("div",{className:"hero-shortcut-icon",children:e.jsx(at,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-white",children:"Quay lại đăng nhập"}),e.jsx("span",{className:"text-sm text-white/70",children:"Bỏ qua và đăng nhập"})]})]})]})]})},ai=()=>{const[t]=wn(),s=t.get("token")||"",a=We(),[r,l]=n.useState(!1),[d,c]=n.useState(!1),[f,j]=n.useState(""),[o,x]=n.useState(!1),[i,m]=n.useState(!1),{register:b,handleSubmit:p,watch:w,formState:{errors:g}}=yt({mode:"onChange"}),_=w("password"),k=async u=>{if(j(""),!s){j("Liên kết không hợp lệ.");return}m(!0);try{const M=await Hn(s,u.password);if(!M?.success)throw new Error(M?.message||"Đặt lại mật khẩu thất bại.");x(!0),j("Đặt lại mật khẩu thành công."),setTimeout(()=>a("/login"),1500)}catch(M){j(M?.response?.data?.message||M?.message||"Có lỗi xảy ra.")}finally{m(!1)}};return o?e.jsxs("div",{className:"hero min-h-screen flex items-center justify-center py-12 px-4",children:[e.jsx("div",{className:"hero-pattern"}),e.jsx("div",{className:"max-w-md w-full relative",children:e.jsxs("div",{className:"hero-card text-center p-8",children:[e.jsx("div",{className:"shop-brand justify-center mb-4",children:e.jsx("div",{className:"shop-brand-logo bg-[var(--brand-500)] text-white",children:e.jsx(nt,{className:"w-8 h-8"})})}),e.jsx("h2",{className:"hero-card-title mb-2",children:"Thành công!"}),e.jsx("p",{className:"hero-card-subtitle",children:"Đang chuyển hướng đến trang đăng nhập…"})]})})]}):e.jsxs("div",{className:"hero min-h-screen flex items-center justify-center py-12 px-4",children:[e.jsx("div",{className:"hero-pattern"}),e.jsxs("div",{className:"max-w-md w-full relative space-y-6",children:[e.jsxs("div",{className:"hero-card p-8",children:[e.jsx("div",{className:"hero-card-header mb-6",children:e.jsxs("div",{className:"shop-brand mb-4",children:[e.jsx("div",{className:"shop-brand-logo bg-[var(--brand-600)] text-white",children:e.jsx(At,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"hero-card-title",children:"Đặt lại mật khẩu"}),e.jsx("p",{className:"hero-card-subtitle",children:"Nhập mật khẩu mới của bạn"})]})]})}),e.jsxs("form",{onSubmit:p(k),className:"space-y-5",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"label text-white/80",children:[e.jsx(At,{className:"w-4 h-4 inline mr-2"})," Mật khẩu mới"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:r?"text":"password",...b("password",{required:"Vui lòng nhập mật khẩu",minLength:{value:6,message:"Tối thiểu 6 ký tự"}}),className:"input",placeholder:"Mật khẩu mới"}),e.jsx("button",{type:"button",onClick:()=>l(!r),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500",children:r?e.jsx(Jt,{className:"w-5 h-5"}):e.jsx(qt,{className:"w-5 h-5"})})]}),g.password&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:g.password.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label text-white/80",children:[e.jsx(At,{className:"w-4 h-4 inline mr-2"})," Xác nhận mật khẩu"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:d?"text":"password",...b("confirmPassword",{required:"Vui lòng xác nhận mật khẩu",validate:u=>u===_||"Mật khẩu xác nhận không khớp"}),className:"input",placeholder:"Nhập lại mật khẩu"}),e.jsx("button",{type:"button",onClick:()=>c(!d),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500",children:d?e.jsx(Jt,{className:"w-5 h-5"}):e.jsx(qt,{className:"w-5 h-5"})})]}),g.confirmPassword&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:g.confirmPassword.message})]}),!!f&&e.jsx("p",{className:`text-sm mt-1 ${f.includes("thành công")?"text-emerald-300":"text-red-400"}`,children:f}),e.jsx("button",{type:"submit",disabled:i,className:"btn-primary w-full",children:i?"Đang đổi...":"Đổi mật khẩu"})]})]}),e.jsxs(ke,{to:"/login",className:"hero-shortcut",children:[e.jsx("div",{className:"hero-shortcut-icon",children:e.jsx(at,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-white",children:"Quay lại đăng nhập"}),e.jsx("span",{className:"text-sm text-white/70",children:"Bỏ qua và đăng nhập"})]})]})]})]})},xt="flex items-center gap-3 rounded-xl px-3 py-2 text-sm transition-all",ut="text-gray-700 hover:text-gray-900 hover:bg-gray-100",gt="bg-gray-900 text-white shadow",ni=()=>{const{user:t}=Oe(),[s,a]=n.useState(null),[r,l]=n.useState(!1);n.useEffect(()=>{let c=!1;return(async()=>{if(t?.user_code)try{const f=await jt();c||a(f??null)}catch(f){console.error(f)}})(),()=>{c=!0}},[t?.user_code]);const d=(s?.shop_name?.trim()?.charAt(0)||"S").toUpperCase();return e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[280px_1fr] gap-6",children:[e.jsxs("aside",{className:["rounded-2xl bg-white shadow-md border border-gray-100 sticky top-6 h-max",r?"lg:w-[84px]":"lg:w-[280px]"].join(" "),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-emerald-100 text-emerald-700 font-semibold",children:d}),!r&&e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold leading-tight",children:s?.shop_name||"Shop Dashboard"}),e.jsx("div",{className:"text-xs text-gray-500",children:s?.address||t?.email})]})]}),e.jsx("button",{onClick:()=>l(c=>!c),className:"hidden lg:flex h-8 w-8 items-center justify-center rounded-lg border border-gray-200 hover:bg-gray-50","aria-label":r?"Expand sidebar":"Collapse sidebar",title:r?"Mở rộng":"Thu gọn",children:r?e.jsx(Ns,{className:"h-4 w-4"}):e.jsx(Lt,{className:"h-4 w-4"})})]}),e.jsxs("nav",{className:"p-3 space-y-1",children:[e.jsxs(Ie,{to:"/shop/fields",className:({isActive:c})=>`${xt} ${c?gt:ut}`,children:[e.jsx(xr,{className:"h-4 w-4"}),!r&&e.jsx("span",{children:"Danh sách sân"})]}),e.jsxs(Ie,{to:"/shop/pricing",className:({isActive:c})=>`${xt} ${c?gt:ut}`,children:[e.jsx(Se,{className:"h-4 w-4"}),!r&&e.jsx("span",{children:"Giờ hoạt động"})]}),e.jsxs(Ie,{to:"/shop/bookings",className:({isActive:c})=>`${xt} ${c?gt:ut}`,children:[e.jsx(Xa,{className:"h-4 w-4"}),!r&&e.jsx("span",{children:"Đơn đặt"})]}),e.jsxs(Ie,{to:"/shop/utilities",className:({isActive:c})=>`${xt} ${c?gt:ut}`,children:[e.jsx(Wa,{className:"h-4 w-4"}),!r&&e.jsx("span",{children:"Tiện ích"})]}),e.jsxs(Ie,{to:"/shop/promotions",className:({isActive:c})=>`${xt} ${c?gt:ut}`,children:[e.jsx(Sr,{className:"h-4 w-4"}),!r&&e.jsx("span",{children:"Khuyến mãi"})]}),e.jsxs(Ie,{to:"/shop/revenue",className:({isActive:c})=>`${xt} ${c?gt:ut}`,children:[e.jsx(Us,{className:"h-4 w-4"}),!r&&e.jsx("span",{children:"Doanh thu"})]}),e.jsx("div",{className:"pt-2 mt-2 border-t border-gray-100"}),e.jsxs(Ie,{to:"/shop/settings",className:({isActive:c})=>`${xt} ${c?gt:ut}`,children:[e.jsx(wr,{className:"h-4 w-4"}),!r&&e.jsx("span",{children:"Thiết lập"})]})]})]}),e.jsx("main",{className:"rounded-2xl bg-white shadow-md border border-gray-100 p-4 lg:p-6 min-h-[60vh]",children:e.jsx(Ua,{})})]})})},La=[{code:"01",name:"Thành phố Hà Nội",districts:[{code:"001",name:"Quận Ba Đình",wards:[{code:"00001",name:"Phường Phúc Xá"},{code:"00004",name:"Phường Trúc Bạch"},{code:"00006",name:"Phường Vĩnh Phúc"}]},{code:"002",name:"Quận Hoàn Kiếm",wards:[{code:"00007",name:"Phường Phan Chu Trinh"},{code:"00008",name:"Phường Hàng Bài"},{code:"00010",name:"Phường Lý Thái Tổ"}]}]},{code:"79",name:"Thành phố Hồ Chí Minh",districts:[{code:"760",name:"Quận 1",wards:[{code:"26734",name:"Phường Bến Nghé"},{code:"26737",name:"Phường Bến Thành"},{code:"26740",name:"Phường Nguyễn Thái Bình"}]},{code:"769",name:"Thành phố Thủ Đức",wards:[{code:"26834",name:"Phường Linh Tây"},{code:"26837",name:"Phường Linh Chiểu"},{code:"26840",name:"Phường Linh Trung"}]}]},{code:"48",name:"Thành phố Đà Nẵng",districts:[{code:"490",name:"Quận Hải Châu",wards:[{code:"20224",name:"Phường Thạch Thang"},{code:"20227",name:"Phường Thanh Bình"},{code:"20230",name:"Phường Thuận Phước"}]},{code:"492",name:"Quận Sơn Trà",wards:[{code:"20263",name:"Phường An Hải Bắc"},{code:"20266",name:"Phường An Hải Đông"},{code:"20269",name:"Phường An Hải Tây"}]}]}],Aa=[{value:"active",label:Dt("active")},{value:"maintenance",label:Dt("maintenance")},{value:"inactive",label:Dt("inactive")}],Gt=[{value:"football",label:Ze("football")},{value:"badminton",label:Ze("badminton")},{value:"tennis",label:Ze("tennis")},{value:"baseball",label:Ze("baseball")},{value:"swimming",label:Ze("swimming")}],pt=24,Qt=5,Ct=t=>t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/đ/g,"d").replace(/Đ/g,"D").trim().toLowerCase(),ri=()=>{const{user:t}=Oe(),[s,a]=n.useState(null),[r,l]=n.useState([]),[d,c]=n.useState({total:0,page:1,pageSize:pt}),[f,j]=n.useState(!0),[o,x]=n.useState(null),[i,m]=n.useState(null),[b,p]=n.useState(!1),[w,g]=n.useState({}),[_,k]=n.useState([]),[u,M]=n.useState(!1),[U,J]=n.useState(""),[V,R]=n.useState(""),[P,F]=n.useState(!1),[D,G]=n.useState({field_name:"",sport_type:Gt[0].value,price_per_hour:0,quantityCount:1,provinceCode:"",districtCode:"",wardCode:"",street:""}),[N,q]=n.useState([]),[y,L]=n.useState(""),[v,B]=n.useState({}),[O,re]=n.useState(""),[te,ve]=n.useState([]),[T,se]=n.useState(!1),[ce,ge]=n.useState(""),de=n.useCallback(h=>{const C={provinceCode:"",districtCode:"",wardCode:"",street:h?.trim()||""};if(!h)return C;const S=h.split(",").map(Ue=>Ue.trim()).filter(Boolean);if(!S.length)return C;let W="",oe="",Y="",ae="";if(S.length>=3?(W=S[S.length-1]??"",oe=S[S.length-2]??"",Y=S[S.length-3]??"",ae=S.slice(0,S.length-3).join(", ")):(W=S[S.length-1]??"",oe=S.length>1?S[S.length-2]:"",ae=S.slice(0,S.length-2).join(", ")||S[0]||""),ae||(ae=S.slice(0,S.length-1).join(", ")||S[0]||""),!te.length)return{provinceCode:"",districtCode:"",wardCode:"",street:ae};const pe=te.find(Ue=>Ct(Ue.name)===Ct(W)),_e=pe?.districts.find(Ue=>Ct(Ue.name)===Ct(oe)),ct=_e?.wards.find(Ue=>Ct(Ue.name)===Ct(Y));return{provinceCode:pe?.code??"",districtCode:_e?.code??"",wardCode:ct?.code??"",street:ae}},[te]);n.useEffect(()=>{if(!O)return;const h=setTimeout(()=>re(""),4e3);return()=>clearTimeout(h)},[O]),n.useEffect(()=>{let h=!1;return(async()=>{se(!0),ge("");try{const S=await fetch("https://provinces.open-api.vn/api/?depth=3");if(!S.ok)throw new Error(`HTTP ${S.status}`);const W=await S.json();if(!h){const oe=W.map(Y=>({code:String(Y.code),name:Y.name,districts:Y.districts.map(ae=>({code:String(ae.code),name:ae.name,wards:ae.wards?.map(pe=>({code:String(pe.code),name:pe.name}))??[]}))}));ve(oe.length?oe:La)}}catch(S){console.error("Failed to load provinces",S),h||(ge("Không thể tải danh sách tỉnh/thành từ API. Đang dùng dữ liệu mặc định."),ve(La))}finally{h||se(!1)}})(),()=>{h=!0}},[]),n.useEffect(()=>{let h=!1;return(async()=>{if(t?.user_code){j(!0);try{const C=await jt();if(h)return;if(a(C??null),C){const S=await Ys(C.shop_code,{page:1,pageSize:pt});if(h)return;const W=S.items??[];l(W);const oe=S.meta?.pagination;c({total:oe?.total??S.total??W.length,page:oe?.page??S.page??1,pageSize:oe?.pageSize??S.pageSize??pt})}else l([]),c({total:0,page:1,pageSize:pt})}catch(C){console.error(C),l([]),c({total:0,page:1,pageSize:pt})}finally{h||j(!1)}}})(),()=>{h=!0}},[t?.user_code]);const De=n.useCallback(()=>{q(h=>(h.forEach(C=>URL.revokeObjectURL(C.url)),[]))},[]);n.useEffect(()=>()=>{De()},[De]);const Je=n.useCallback(h=>{const C=Array.from(h.target.files??[]).filter(W=>W.type.startsWith("image/"));if(!C.length){h.target.value="";return}const S=C.map(W=>({file:W,url:URL.createObjectURL(W)}));q(W=>{const oe=[...W,...S];return oe.length>Qt?(oe.slice(Qt).forEach(Y=>URL.revokeObjectURL(Y.url)),oe.slice(0,Qt)):oe}),h.target.value=""},[]),et=n.useCallback(h=>{q(C=>{const S=[...C],[W]=S.splice(h,1);return W&&URL.revokeObjectURL(W.url),S})},[]),ze=n.useCallback(async h=>{if(!o){h.target.value="";return}const C=o.field_code,S=Array.from(h.target.files??[]).filter(W=>W.type.startsWith("image/"));if(h.target.value="",!!S.length){M(!0),J("");try{for(const W of S){const oe=await Rr(C,W);l(Y=>Y.map(ae=>ae.field_code===C?{...ae,images:[...ae.images??[],oe]}:ae)),x(Y=>Y&&Y.field_code===C?{...Y,images:[...Y.images??[],oe]}:Y)}}catch(W){J(W?.message||"Không thể tải ảnh. Vui lòng thử lại.")}finally{M(!1)}}},[o,l]),He=n.useCallback(h=>{const C={};h.field_name.trim()||(C.field_name="Vui lòng nhập tên sân."),te.length>0&&(h.provinceCode||(C.provinceCode="Vui lòng chọn tỉnh/thành."),h.districtCode||(C.districtCode="Vui lòng chọn quận/huyện."),h.wardCode||(C.wardCode="Vui lòng chọn phường/xã.")),h.street.trim()||(C.street="Vui lòng nhập số nhà, tên đường."),h.sport_type||(C.sport_type="Vui lòng chọn loại sân.");const W=Number(h.price_per_hour);return(!Number.isFinite(W)||W<0)&&(C.price_per_hour="Giá mỗi giờ phải lớn hơn hoặc bằng 0."),C},[te.length]),rt=h=>{x(h);const C=de(h.address??"");m({field_name:h.field_name,sport_type:tn(h.sport_type)??Gt[0].value,price_per_hour:Bt(h),status:aa(h.status)??Aa[0].value,provinceCode:C.provinceCode,districtCode:C.districtCode,wardCode:C.wardCode,street:C.street}),g({}),J(""),R(""),k([])},ye=()=>{x(null),m(null),p(!1),g({}),J(""),M(!1),R(""),k([])},$e=async()=>{if(!o||!i)return;const h=He(i);if(Object.keys(h).length){g(h);return}g({}),R(""),p(!0);const C=Qe?.name??"",S=Xe?.name??"",W=we?.name??"",oe=[i.street.trim(),W,S,C].filter(Boolean).join(", ");try{const Y=await Jr(o.field_code,{field_name:i.field_name.trim(),sport_type:i.sport_type,price_per_hour:Number(i.price_per_hour)||0,address:oe,status:i.status,deleted_images:_});if(Y){l(pe=>pe.map(_e=>_e.field_code===Y.field_code?{..._e,...Y}:_e)),x(pe=>pe&&pe.field_code===Y.field_code?{...pe,...Y}:Y??pe),re(`Đã cập nhật sân "${Y.field_name}" thành công.`);const ae=de(Y?.address??oe);m(pe=>pe&&{...pe,provinceCode:ae.provinceCode||pe.provinceCode,districtCode:ae.districtCode||pe.districtCode,wardCode:ae.wardCode||pe.wardCode,street:ae.street||pe.street}),ye()}}catch(Y){R(Y?.message||"Không thể lưu thay đổi. Vui lòng thử lại.")}finally{p(!1)}},Me=h=>{k(C=>C.includes(h)?C.filter(S=>S!==h):[...C,h])},ne=async h=>{const C=h.status?h.status.toString().trim().toLowerCase():"",W=["bảo trì","maintenance","on_maintenance"].includes(C)?"active":"maintenance",oe=await el(h.field_code,W);oe&&(l(Y=>Y.map(ae=>ae.field_code===oe.field_code?{...ae,status:W}:ae)),o&&o.field_code===h.field_code&&m(Y=>Y&&{...Y,status:W}),x(Y=>Y&&Y.field_code===h.field_code?{...Y,status:W}:Y))},E=async()=>{if(!o)return;if(window.confirm(`Bạn có chắc chắn muốn xoá sân "${o.field_name}" không? Hành động này không thể hoàn tác.`))try{const C=await tl(o.field_code);if(!C||C.deleted!==!0)throw new Error("Xoá sân không thành công.");l(S=>S.filter(W=>W.field_code!==o.field_code)),c(S=>({...S,total:Math.max(0,S.total-1)})),re(`Đã xoá sân "${o.field_name}" thành công.`),ye()}catch(C){R(C?.message||"Không thể xoá sân. Vui lòng thử lại.")}},me=()=>{L(""),B({}),F(!0)},be=()=>{F(!1),p(!1),L(""),B({}),De(),G({field_name:"",sport_type:Gt[0].value,price_per_hour:0,provinceCode:"",districtCode:"",wardCode:"",street:"",quantityCount:1})},Vt=async()=>{if(!s)return;const h=He(D);if(Object.keys(h).length){B(h);return}p(!0),L("");try{const C=Fe?.name??"",S=Be?.name??"",W=is?.name??"",oe=[D.street.trim(),W,S,C].filter(Boolean).join(", ");console.log("📝 Creating field with data:",D),console.log("🔢 QuantityCount being sent:",Number(D.quantityCount),"Type:",typeof Number(D.quantityCount));const Y=await Wr(s.shop_code,{field_name:D.field_name.trim(),sport_type:D.sport_type,price_per_hour:Number(D.price_per_hour)||0,address:oe,status:"active",quantityCount:Number(D.quantityCount)||1,images:N.map(_e=>_e.file)});let ae=null;try{ae=await Ys(s.shop_code,{page:1,pageSize:d.pageSize||pt})}catch(_e){console.error(_e)}if(ae){const _e=ae.items??[];l(_e);const ct=ae.meta?.pagination;c({total:ct?.total??ae.total??_e.length,page:ct?.page??ae.page??1,pageSize:ct?.pageSize??ae.pageSize??(d.pageSize||pt)})}else l(_e=>[Y,..._e]),c(_e=>({..._e,total:_e.total+1}));be();const pe=Y.quantityCount?` với ${Y.quantityCount} sân`:"";re(`Đã tạo sân "${Y.field_name}"${pe} thành công.`)}catch(C){L(C?.message||"Không thể tạo sân mới. Vui lòng thử lại.")}finally{p(!1)}},lt=n.useMemo(()=>r.length>0,[r.length]),Fe=n.useMemo(()=>te.find(h=>h.code===D.provinceCode)??null,[te,D.provinceCode]),qe=Fe?.districts??[],Be=n.useMemo(()=>qe.find(h=>h.code===D.districtCode)??null,[qe,D.districtCode]),it=Be?.wards??[],is=n.useMemo(()=>it.find(h=>h.code===D.wardCode)??null,[it,D.wardCode]),Qe=n.useMemo(()=>i?te.find(h=>h.code===i.provinceCode)??null:null,[i?.provinceCode,te]),tt=Qe?.districts??[],Xe=n.useMemo(()=>i?tt.find(h=>h.code===i.districtCode)??null:null,[tt,i?.districtCode]),Ye=Xe?.wards??[],we=n.useMemo(()=>i?Ye.find(h=>h.code===i.wardCode)??null:null,[Ye,i?.wardCode]);return n.useEffect(()=>{if(te.length){if(!Fe){(D.provinceCode||D.districtCode||D.wardCode)&&G(h=>({...h,provinceCode:"",districtCode:"",wardCode:""}));return}qe.some(h=>h.code===D.districtCode)||G(h=>({...h,districtCode:"",wardCode:""}))}},[te.length,Fe,qe,D.districtCode,D.provinceCode,D.wardCode]),n.useEffect(()=>{if(te.length){if(!Be){D.wardCode&&G(h=>({...h,wardCode:""}));return}it.some(h=>h.code===D.wardCode)||G(h=>({...h,wardCode:""}))}},[te.length,Be,it,D.wardCode]),n.useEffect(()=>{if(!(!i||!te.length)){if(!Qe){(i.provinceCode||i.districtCode||i.wardCode)&&m(h=>h&&{...h,provinceCode:"",districtCode:"",wardCode:""});return}tt.some(h=>h.code===i.districtCode)||m(h=>h&&{...h,districtCode:"",wardCode:""})}},[tt,Qe,i?.provinceCode,i?.districtCode,te.length]),n.useEffect(()=>{if(!(!i||!te.length)){if(!Xe){i.wardCode&&m(h=>h&&{...h,wardCode:""});return}Ye.some(h=>h.code===i.wardCode)||m(h=>h&&{...h,wardCode:""})}},[Ye,Xe,i?.wardCode,te.length]),n.useEffect(()=>{if(!o||!i||!te.length||i.provinceCode||i.districtCode||i.wardCode||!o.address)return;const h=de(o.address);(h.provinceCode||h.districtCode||h.wardCode||h.street)&&m(C=>C&&{...C,provinceCode:h.provinceCode,districtCode:h.districtCode,wardCode:h.wardCode,street:h.street||C.street})},[de,o,te.length]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"shop-header",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"shop-title",children:["Sân của bạn"," ",d.total?e.jsxs("span",{className:"text-sm font-normal text-gray-500",children:["(",d.total,")"]}):null]}),e.jsx("p",{className:"shop-sub text-sm text-gray-500",children:"Quản lý danh sách sân và cập nhật trạng thái hoạt động nhanh chóng."})]}),e.jsxs("button",{className:"btn-primary",onClick:me,children:[e.jsx(ts,{className:"w-4 h-4"}),"Thêm sân"]})]}),O&&e.jsx("div",{className:"mb-4 rounded-xl border border-emerald-200 bg-emerald-50 px-4 py-3 text-emerald-700",children:O}),f?e.jsx("div",{className:"loading-wrap",children:e.jsx("div",{className:"spinner"})}):lt?e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map(h=>{const C=Dt(h.status),S=sn(h.status),W=Bt(h),oe=h.status?h.status.toString().trim().toLowerCase():"",Y=["maintenance","bảo trì","on_maintenance"].includes(oe),ae=h.images?.[0],pe=Rt(ae?.image_url,ae?.storage)||"https://images.pexels.com/photos/274506/pexels-photo-274506.jpeg";return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"aspect-video rounded-lg overflow-hidden mb-3",children:e.jsx("img",{src:pe,alt:h.field_name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900",children:h.field_name}),e.jsx("div",{className:"text-sm text-gray-500",children:Ze(h.sport_type)})]}),e.jsxs("button",{onClick:()=>ne(h),className:`inline-flex items-center gap-1 rounded-lg px-2 py-1 text-xs border ${Y?"border-amber-400 text-amber-600 bg-amber-50":"border-gray-200 text-gray-700 hover:bg-gray-50"}`,title:Y?"Bỏ bảo trì":"Đặt bảo trì",children:[e.jsx(Pr,{className:"w-3.5 h-3.5"}),Y?"Bỏ BT":"Bảo trì"]})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-1 text-gray-700",children:[e.jsx(Ft,{className:"w-4 h-4"}),e.jsxs("span",{children:[new Intl.NumberFormat("vi-VN").format(W),"đ/giờ"]})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[e.jsx("span",{className:S,children:C}),e.jsxs("button",{onClick:()=>rt(h),className:"btn-ghost flex items-center gap-1",children:[e.jsx(br,{className:"w-4 h-4"}),"Chỉnh sửa"]})]})]},h.field_code)})}):e.jsx("div",{className:"card",children:"Chưa có sân nào."}),o&&i&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-start justify-center overflow-y-auto p-4 sm:p-6",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:ye}),e.jsxs("div",{className:"relative z-10 mt-12 w-full max-w-lg rounded-2xl bg-white shadow-xl border border-gray-200 p-5 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Chỉnh sửa sân #",o.field_code]}),e.jsx("button",{onClick:ye,className:"h-8 w-8 inline-flex items-center justify-center rounded-lg hover:bg-gray-100",title:"Đóng",children:e.jsx(as,{className:"w-4 h-4"})})]}),e.jsxs("form",{className:"grid grid-cols-1 gap-4",onSubmit:h=>{h.preventDefault(),$e()},children:[V&&e.jsx("div",{className:"rounded-lg border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700",children:V}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Tên sân *"}),e.jsx("input",{className:"input mt-1 w-full",value:i.field_name,onChange:h=>{const C=h.target.value;m(S=>S&&{...S,field_name:C}),g(S=>({...S,field_name:void 0}))},placeholder:"VD: Sân bóng đá số 3"}),w.field_name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:w.field_name})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Loại môn *"}),e.jsx("select",{className:"input mt-1 w-full",value:i.sport_type,onChange:h=>{const C=h.target.value;m(S=>S&&{...S,sport_type:C}),g(S=>({...S,sport_type:void 0}))},children:Gt.map(h=>e.jsx("option",{value:h.value,children:h.label},h.value))}),w.sport_type&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:w.sport_type})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Giá / giờ *"}),e.jsx("input",{type:"number",min:0,className:"input mt-1 w-full",value:i.price_per_hour,onChange:h=>{const C=Number(h.target.value);m(S=>S&&{...S,price_per_hour:C}),g(S=>({...S,price_per_hour:void 0}))},placeholder:"VD: 150000"}),w.price_per_hour&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:w.price_per_hour})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Tỉnh / Thành *"}),e.jsxs("select",{className:"input mt-1 w-full",value:i.provinceCode,onChange:h=>{const C=h.target.value;m(S=>S&&{...S,provinceCode:C,districtCode:"",wardCode:""}),g(S=>({...S,provinceCode:void 0,districtCode:void 0,wardCode:void 0}))},disabled:T||!te.length,children:[e.jsx("option",{value:"",disabled:!0,children:T?"Đang tải...":"Chọn tỉnh / thành"}),te.map(h=>e.jsx("option",{value:h.code,children:h.name},h.code))]}),w.provinceCode&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:w.provinceCode})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Quận / Huyện *"}),e.jsxs("select",{className:"input mt-1 w-full",value:i.districtCode,onChange:h=>{const C=h.target.value;m(S=>S&&{...S,districtCode:C,wardCode:""}),g(S=>({...S,districtCode:void 0,wardCode:void 0}))},disabled:!Qe||tt.length===0,children:[e.jsx("option",{value:"",disabled:!0,children:Qe?"Chọn quận / huyện":"Chọn tỉnh trước"}),tt.map(h=>e.jsx("option",{value:h.code,children:h.name},h.code))]}),w.districtCode&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:w.districtCode})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Phường / Xã *"}),e.jsxs("select",{className:"input mt-1 w-full",value:i.wardCode,onChange:h=>{const C=h.target.value;m(S=>S&&{...S,wardCode:C}),g(S=>({...S,wardCode:void 0}))},disabled:!Xe||Ye.length===0,children:[e.jsx("option",{value:"",disabled:!0,children:Xe?"Chọn phường / xã":"Chọn quận/huyện trước"}),Ye.map(h=>e.jsx("option",{value:h.code,children:h.name},h.code))]}),w.wardCode&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:w.wardCode})]})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Số nhà, tên đường *"}),e.jsx("input",{className:"input mt-1 w-full",value:i.street,onChange:h=>{const C=h.target.value;m(S=>S&&{...S,street:C}),g(S=>({...S,street:void 0}))},placeholder:"VD: 123 Nguyễn Trãi"}),w.street&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:w.street})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Trạng thái"}),e.jsx("select",{className:"input mt-1 w-full capitalize",value:i.status,onChange:h=>{const C=h.target.value;m(S=>S&&{...S,status:C})},children:Aa.map(h=>e.jsx("option",{value:h.value,children:h.label},h.value))})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Ảnh hiện có"}),o.images?.length?e.jsx("div",{className:"mt-2 grid grid-cols-2 sm:grid-cols-3 gap-3",children:o.images.map((h,C)=>{const S=Rt(h.image_url,h.storage),W=Number(h.sort_order??0)===0,oe=h.image_code??h.image_id,Y=oe??`${C}-${S}`,ae=oe?_.includes(oe):!1;return e.jsxs("div",{className:`relative h-24 w-full overflow-hidden rounded-xl border ${ae?"border-red-300":"border-gray-200"}`,children:[S?e.jsx("img",{src:S,alt:`Ảnh sân hiện có ${C+1}`,className:`h-full w-full object-cover transition-opacity ${ae?"opacity-40":""}`}):e.jsx("div",{className:"h-full w-full bg-gray-100"}),oe&&e.jsx("button",{type:"button",onClick:()=>Me(oe),className:`absolute top-1 right-1 z-10 flex h-7 w-7 items-center justify-center rounded-full shadow-md transition-colors ${ae?"bg-red-500 text-white":"bg-white/80 text-gray-700 hover:bg-white"}`,title:ae?"Hoàn tác xóa":"Xóa ảnh này",children:ae?e.jsx(bt,{className:"h-4 w-4"}):e.jsx(Pt,{className:"h-4 w-4"})}),W&&e.jsx("span",{className:"absolute left-1 bottom-1 rounded-full bg-emerald-500 px-2 py-0.5 text-xs font-semibold text-white shadow",children:"Ảnh chính"})]},Y)})}):e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Chưa có ảnh nào cho sân này."}),e.jsxs("label",{className:"mt-3 flex w-full cursor-pointer flex-col items-center justify-center gap-2 rounded-xl border border-dashed border-gray-300 bg-gray-50 px-4 py-6 text-center text-sm text-gray-600 hover:bg-gray-100",children:[e.jsx(wa,{className:"h-5 w-5 text-gray-500"}),e.jsx("span",{children:"Thêm ảnh mới cho sân"}),e.jsx("input",{type:"file",className:"sr-only",accept:"image/*",multiple:!0,onChange:ze})]}),u&&e.jsxs("p",{className:"mt-2 flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Yt,{className:"h-4 w-4 animate-spin"}),"Đang tải ảnh..."]}),U&&e.jsx("div",{className:"mt-2 rounded-lg border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700",children:U})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 pt-2",children:[e.jsxs("button",{type:"button",onClick:E,className:"btn-danger flex items-center gap-1",children:[e.jsx(Pt,{className:"w-4 h-4"}),"Xoá sân"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:ye,className:"btn-ghost",children:"Hủy"}),e.jsx("button",{type:"submit",disabled:b||u,className:"btn-primary",children:b?"Đang lưu...":"Lưu thay đổi"})]})]})]})]})]}),P&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-start justify-center overflow-y-auto p-4 sm:p-6",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:be}),e.jsxs("div",{className:"relative z-10 mt-12 w-full max-w-lg rounded-2xl bg-white shadow-xl border border-gray-200 p-5 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Thêm sân mới"}),e.jsx("button",{onClick:be,className:"h-8 w-8 inline-flex items-center justify-center rounded-lg hover:bg-gray-100",title:"Đóng",children:e.jsx(as,{className:"w-4 h-4"})})]}),e.jsxs("form",{className:"grid grid-cols-1 gap-4",onSubmit:h=>{h.preventDefault(),Vt()},children:[e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Tên sân *"}),e.jsx("input",{className:"input mt-1 w-full",value:D.field_name,onChange:h=>{G({...D,field_name:h.target.value}),B(C=>({...C,field_name:void 0}))},placeholder:"VD: Sân bóng đá số 3"}),v.field_name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:v.field_name})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Loại môn *"}),e.jsx("select",{className:"input mt-1 w-full",value:D.sport_type,onChange:h=>{G({...D,sport_type:h.target.value}),B(C=>({...C,sport_type:void 0}))},children:Gt.map(h=>e.jsx("option",{value:h.value,children:h.label},h.value))}),v.sport_type&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:v.sport_type})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Giá / giờ *"}),e.jsx("input",{type:"number",min:0,className:"input mt-1 w-full",value:D.price_per_hour,onChange:h=>{G({...D,price_per_hour:Number(h.target.value)}),B(C=>({...C,price_per_hour:void 0}))},placeholder:"VD: 150000"}),v.price_per_hour&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:v.price_per_hour})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Số sân *"}),e.jsx("input",{type:"number",min:1,max:20,className:"input mt-1 w-full",value:D.quantityCount||1,onChange:h=>{const C=h.target.value;G({...D,quantityCount:C?Number(C):1}),B(S=>({...S,quantityCount:void 0}))},placeholder:"VD: 3"}),v.quantityCount&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:v.quantityCount})]})]}),ce&&e.jsx("div",{className:"rounded-lg border border-amber-200 bg-amber-50 px-3 py-2 text-sm text-amber-700",children:ce}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Tỉnh / Thành *"}),e.jsxs("select",{className:"input mt-1 w-full",value:D.provinceCode,onChange:h=>{const C=h.target.value;G(S=>({...S,provinceCode:C,districtCode:"",wardCode:""})),B(S=>({...S,provinceCode:void 0,districtCode:void 0,wardCode:void 0}))},disabled:T||!te.length,children:[e.jsx("option",{value:"",disabled:!0,children:T?"Đang tải...":"Chọn tỉnh / thành"}),te.map(h=>e.jsx("option",{value:h.code,children:h.name},h.code))]}),v.provinceCode&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:v.provinceCode})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Quận / Huyện *"}),e.jsxs("select",{className:"input mt-1 w-full",value:D.districtCode,onChange:h=>{const C=h.target.value;G(S=>({...S,districtCode:C,wardCode:""})),B(S=>({...S,districtCode:void 0,wardCode:void 0}))},disabled:!Fe||qe.length===0,children:[e.jsx("option",{value:"",disabled:!0,children:Fe?"Chọn quận / huyện":"Chọn tỉnh trước"}),qe.map(h=>e.jsx("option",{value:h.code,children:h.name},h.code))]}),v.districtCode&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:v.districtCode})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Phường / Xã *"}),e.jsxs("select",{className:"input mt-1 w-full",value:D.wardCode,onChange:h=>{G(C=>({...C,wardCode:h.target.value})),B(C=>({...C,wardCode:void 0}))},disabled:!Be||it.length===0,children:[e.jsx("option",{value:"",disabled:!0,children:Be?"Chọn phường / xã":"Chọn quận/huyện trước"}),it.map(h=>e.jsx("option",{value:h.code,children:h.name},h.code))]}),v.wardCode&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:v.wardCode})]})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Số nhà, tên đường *"}),e.jsx("input",{className:"input mt-1 w-full",value:D.street,onChange:h=>{G({...D,street:h.target.value}),B(C=>({...C,street:void 0}))},placeholder:"VD: 123 Nguyễn Trãi"}),v.street&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:v.street})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Ảnh sân"}),e.jsxs("label",{className:"mt-1 flex w-full cursor-pointer flex-col items-center justify-center gap-2 rounded-xl border border-dashed border-gray-300 bg-gray-50 px-4 py-6 text-center text-sm text-gray-600 hover:bg-gray-100",children:[e.jsx(wa,{className:"h-5 w-5 text-gray-500"}),e.jsxs("span",{children:["Chọn ảnh (tối đa ",Qt," ảnh mỗi lần)"]}),e.jsx("input",{type:"file",className:"sr-only",accept:"image/*",multiple:!0,onChange:Je})]}),N.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-3 grid grid-cols-2 sm:grid-cols-3 gap-3",children:[e.jsxs("p",{className:"col-span-3 text-xs text-gray-500",children:["Đã chọn ",N.length,"/",Qt," ảnh. Ảnh đầu tiên sẽ được ưu tiên hiển thị trên danh sách."]}),N.map((h,C)=>e.jsxs("div",{className:"relative h-24 w-full overflow-hidden rounded-xl border border-gray-200",children:[e.jsx("img",{src:h.url,alt:`Ảnh sân ${C+1}`,className:"h-full w-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>et(C),className:"absolute right-1 top-1 inline-flex h-7 w-7 items-center justify-center rounded-full bg-white/90 text-gray-600 shadow hover:bg-white",title:"Xóa ảnh",children:e.jsx(Pt,{className:"h-4 w-4"})})]},`${h.url}-${C}`))]}),e.jsxs("button",{type:"button",onClick:De,className:"mt-3 inline-flex items-center gap-2 text-sm text-gray-500 hover:text-gray-700",children:[e.jsx(Pt,{className:"h-4 w-4"}),"Xóa tất cả ảnh đã chọn"]})]})]}),y&&e.jsx("div",{className:"mt-3 rounded-lg border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700 whitespace-pre-wrap break-words",children:y}),e.jsxs("div",{className:"mt-5 flex items-center justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:be,className:"btn-ghost",children:"Hủy"}),e.jsx("button",{type:"submit",disabled:b,className:"btn-primary min-w-[120px] justify-center",children:b?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Yt,{className:"h-4 w-4 animate-spin"}),"Đang tạo..."]}):"Tạo sân"})]})]})]})]})]})},xn=["Chủ nhật","Thứ hai","Thứ ba","Thứ tư","Thứ năm","Thứ sáu","Thứ bảy"],Da=t=>{if(!t)return null;const s=t.trim();return s?/^\d{2}:\d{2}:\d{2}$/.test(s)?s.slice(0,5):s:null},xs=t=>{const[s,a]=t.split(":").map(r=>Number(r));return s*60+a},li=t=>t?{isOpen24h:!!t.is_open_24h,openingTime:Da(t.opening_time),closingTime:Da(t.closing_time)}:null,ii=({operatingHours:t,onEdit:s,onDelete:a})=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white border border-gray-200 rounded-lg hover:shadow-md transition-shadow hover:border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("div",{className:"flex-shrink-0 w-24 font-semibold text-gray-900",children:xn[t.day_of_week]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-blue-50 rounded-lg",children:[e.jsx(Se,{className:"h-4 w-4 text-blue-600"}),e.jsxs("span",{className:"text-sm font-medium text-gray-800",children:[t.start_time," - ",t.end_time]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>s(t),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Chỉnh sửa",children:e.jsx(ir,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>a(t.pricing_id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Xóa",children:e.jsx(Pt,{className:"h-4 w-4"})})]})]}),ci=({isOpen:t,onClose:s,onSave:a,operatingHours:r,fieldCode:l,shopWindow:d})=>{const[c,f]=n.useState({field_code:l,day_of_week:1,start_time:"08:00",end_time:"22:00"});n.useEffect(()=>{const o=d?.isOpen24h?"00:00":d?.openingTime||"08:00",x=d?.isOpen24h?"23:59":d?.closingTime||"22:00";f(r?{field_code:r.field_code,day_of_week:r.day_of_week,start_time:r.start_time,end_time:r.end_time}:{field_code:l,day_of_week:1,start_time:o,end_time:x})},[r,l,d]);const j=o=>{o.preventDefault();const x=Number(c.day_of_week),i=Number(l),m=(c.start_time||"").trim(),b=(c.end_time||"").trim();if(!Number.isFinite(i)||!Number.isInteger(x)||x<0||x>6||!m||!b)return;if(d&&!d.isOpen24h){const w=d.openingTime,g=d.closingTime;if(!w||!g){alert("Vui lòng thiết lập giờ mở/đóng cửa của shop tại trang Cài đặt trước khi thêm khung giờ.");return}const _=xs(m),k=xs(b);if(_<xs(w)||k>xs(g)){alert(`Khung giờ phải nằm trong khoảng ${w} - ${g}.`);return}}a({field_code:i,day_of_week:x,start_time:m,end_time:b})};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:r?"Chỉnh sửa giờ hoạt động":"Thêm giờ hoạt động"}),e.jsx("button",{onClick:s,className:"p-1 hover:bg-white rounded-lg transition-colors",children:e.jsx(as,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:j,className:"p-6 space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Ngày trong tuần"}),e.jsx("select",{value:c.day_of_week,onChange:o=>f({...c,day_of_week:parseInt(o.target.value)}),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:xn.map((o,x)=>e.jsx("option",{value:x,children:o},x))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Giờ mở cửa"}),e.jsx("input",{type:"time",value:c.start_time,onChange:o=>f({...c,start_time:o.target.value}),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Giờ đóng cửa"}),e.jsx("input",{type:"time",value:c.end_time,onChange:o=>f({...c,end_time:o.target.value}),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]})]}),d&&!d.isOpen24h&&d.openingTime&&d.closingTime&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Khung giờ phải nằm trong khoảng ",d.openingTime," - ",d.closingTime,"."]}),d&&!d.isOpen24h&&(!d.openingTime||!d.closingTime)&&e.jsx("p",{className:"text-xs text-rose-600",children:"Shop chưa thiết lập giờ mở cửa. Vui lòng cập nhật tại trang Cài đặt shop."}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:s,className:"flex-1 px-4 py-2.5 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors font-medium",children:"Hủy"}),e.jsxs("button",{type:"submit",className:"flex-1 px-4 py-2.5 bg-blue-600 text-white hover:bg-blue-700 rounded-lg transition-colors flex items-center justify-center gap-2 font-medium",children:[e.jsx(vr,{className:"h-4 w-4"}),"Lưu"]})]})]})]})}):null},oi=({field:t,operatingHoursList:s,onAddOperatingHours:a,onEditOperatingHours:r,onDeleteOperatingHours:l,isLoading:d=!1,disabled:c=!1})=>{const f=s.filter(x=>x.field_code===t.field_code),[j,o]=n.useState(!1);return e.jsxs("div",{className:"border border-gray-200 rounded-xl overflow-hidden bg-white shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between p-5 bg-gradient-to-r from-gray-50 to-white cursor-pointer hover:from-blue-50 hover:to-indigo-50 transition-colors border-b border-gray-100",onClick:()=>o(!j),children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("div",{className:"flex-shrink-0 w-3 h-3 rounded-full bg-green-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900 text-base",children:t.field_name}),e.jsxs("p",{className:"text-sm text-gray-500 mt-0.5",children:[t.sport_type," • ",t.address]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"hidden sm:flex items-center gap-2 bg-blue-50 px-3 py-1.5 rounded-lg",children:[e.jsx(Se,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:d?"Đang tải...":`${f.length} khung giờ`})]}),e.jsx("button",{onClick:x=>{x.stopPropagation(),a(t.field_code)},className:`p-2 text-blue-600 rounded-lg transition-colors flex-shrink-0 ${d||c?"opacity-50 cursor-not-allowed":"hover:bg-blue-50"}`,title:c?"Vui lòng thiết lập giờ mở/đóng cửa trong mục Cài đặt shop":"Thêm giờ hoạt động",disabled:d||c,children:e.jsx(ts,{className:"h-5 w-5"})})]})]}),j&&e.jsx("div",{className:"border-t border-gray-200 bg-white",children:e.jsx("div",{className:"p-5 space-y-3",children:d?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-10 h-10 rounded-full border-4 border-gray-200 border-t-blue-600 animate-spin mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Đang tải khung giờ..."})]}):f.length===0?e.jsxs("div",{className:"text-center py-12 px-4",children:[e.jsx(Se,{className:"h-14 w-14 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-gray-600 font-medium mb-4",children:"Chưa có giờ hoạt động"}),e.jsxs("button",{onClick:()=>a(t.field_code),className:`inline-flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-sm ${c?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700 transition-colors"}`,disabled:c,children:[e.jsx(ts,{className:"h-4 w-4"}),"Thêm giờ hoạt động đầu tiên"]})]}):f.map(x=>e.jsx(ii,{operatingHours:x,onEdit:r,onDelete:l},x.pricing_id))})})]})},di=()=>{const[t,s]=n.useState([]),[a,r]=n.useState([]),[l,d]=n.useState(null),[c,f]=n.useState(!0),[j,o]=n.useState(!0),[x,i]=n.useState({}),[m,b]=n.useState(null),[p,w]=n.useState(),[g,_]=n.useState(!1),[k,u]=n.useState(null);n.useEffect(()=>{U(),M()},[]);const M=async()=>{try{f(!0);const N=await jt();d(li(N??null))}catch(N){console.error("Lỗi khi tải thông tin shop:",N),d(null)}finally{f(!1)}},U=async()=>{try{o(!0),u(null);const N=await Ys();s(N.items||[]),N.items&&N.items.length>0&&await J(N.items)}catch(N){console.error("Lỗi khi tải danh sách sân:",N),u("Không thể tải danh sách sân. Vui lòng thử lại.")}finally{o(!1)}},J=async N=>{const q=[];for(const y of N)try{i(v=>({...v,[y.field_code]:!0}));const L=await al(y.field_code);q.push(...L)}catch(L){console.error(`Lỗi khi tải giờ hoạt động cho sân ${y.field_name}:`,L)}finally{i(L=>({...L,[y.field_code]:!1}))}r(q)},V=!!(l?.isOpen24h||l?.openingTime&&l?.closingTime),R=()=>V?!0:(alert("Vui lòng thiết lập giờ mở và đóng cửa của shop trong trang Cài đặt trước khi thao tác."),!1),P=N=>{R()&&(b(N),w(void 0),_(!0))},F=N=>{R()&&(b(N.field_code),w(N),_(!0))},D=async N=>{try{u(null);let q;p?(q=await rl(p.pricing_id,N),r(y=>y.map(L=>L.pricing_id===p.pricing_id?q:L))):(q=await nl(N),r(y=>[...y,q])),_(!1),w(void 0),b(null)}catch(q){console.error("Lỗi khi lưu giờ hoạt động:",q),u(`Không thể lưu giờ hoạt động: ${q instanceof Error?q.message:"Unknown error"}`)}},G=async N=>{if(confirm("Bạn có chắc chắn muốn xóa giờ hoạt động này?"))try{u(null),await ll(N),r(q=>q.filter(y=>y.pricing_id!==N))}catch(q){console.error("Lỗi khi xóa giờ hoạt động:",q),u("Không thể xóa giờ hoạt động. Vui lòng thử lại.")}};return j?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-full border-4 border-gray-200 border-t-blue-600 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Đang tải dữ liệu..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 py-8",children:[e.jsxs("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Se,{className:"h-8 w-8 text-blue-600"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Giờ hoạt động"})]}),e.jsx("p",{className:"text-gray-600 ml-11",children:"Thiết lập giờ mở cửa và đóng cửa cho từng sân mỗi ngày"})]}),k&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg flex items-start gap-3",children:[e.jsx(Ce,{className:"h-5 w-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-red-900",children:"Lỗi"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:k})]}),e.jsx("button",{onClick:U,className:"text-sm text-red-600 hover:text-red-700 font-medium whitespace-nowrap",children:"Thử lại"})]}),e.jsx("div",{className:"mb-6",children:c?e.jsx("div",{className:"p-4 bg-white border border-gray-200 rounded-lg text-sm text-gray-600",children:"Đang tải thông tin giờ hoạt động của shop..."}):l?e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-blue-900",children:l.isOpen24h?"Shop đang mở cửa 24/24.":`Shop hoạt động từ ${l.openingTime??"--:--"} đến ${l.closingTime??"--:--"}.`}),!l.isOpen24h&&l.openingTime&&l.closingTime&&e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Chỉ được thêm khung giờ nằm trong khoảng này."}),!l.isOpen24h&&(!l.openingTime||!l.closingTime)&&e.jsx("p",{className:"text-sm text-amber-700 mt-1",children:"Shop chưa thiết lập đầy đủ giờ hoạt động. Vui lòng cập nhật trong mục Cài đặt shop."})]}),e.jsx("a",{href:"/shop/settings",className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:"Cập nhật giờ mở cửa"})]}):e.jsx("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-lg text-sm text-amber-800",children:"Không thể tải thông tin giờ hoạt động của shop. Vui lòng kiểm tra lại trong mục Cài đặt shop."})}),t.length>0&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4 shadow-sm",children:[e.jsx("div",{className:"text-gray-600 text-sm font-medium",children:"Tổng sân"}),e.jsx("div",{className:"text-3xl font-bold text-gray-900 mt-1",children:t.length})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-blue-200 p-4 shadow-sm bg-gradient-to-br from-white to-blue-50",children:[e.jsx("div",{className:"text-blue-700 text-sm font-medium",children:"Khung giờ"}),e.jsx("div",{className:"text-3xl font-bold text-blue-900 mt-1",children:a.length})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-green-200 p-4 shadow-sm bg-gradient-to-br from-white to-green-50",children:[e.jsx("div",{className:"text-green-700 text-sm font-medium",children:"Sân có giờ"}),e.jsx("div",{className:"text-3xl font-bold text-green-900 mt-1",children:t.filter(N=>a.some(q=>q.field_code===N.field_code)).length})]})]}),t.length===0?e.jsxs("div",{className:"text-center py-16 bg-white rounded-2xl border-2 border-dashed border-gray-300",children:[e.jsx(Se,{className:"h-16 w-16 mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Chưa có sân nào"}),e.jsx("p",{className:"text-gray-500 mb-6 max-w-sm mx-auto",children:"Bạn cần tạo sân trước khi có thể thiết lập giờ hoạt động"}),e.jsxs("button",{className:"inline-flex items-center gap-2 px-6 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:[e.jsx(ts,{className:"h-4 w-4"}),"Tạo sân đầu tiên"]})]}):e.jsx("div",{className:"space-y-4",children:t.map(N=>e.jsx(oi,{field:N,operatingHoursList:a,onAddOperatingHours:P,onEditOperatingHours:F,onDeleteOperatingHours:G,isLoading:x[N.field_code]||!1,disabled:!V},N.field_code))})]}),e.jsx(ci,{isOpen:g,onClose:()=>{_(!1),w(void 0),b(null)},onSave:D,operatingHours:p,fieldCode:m||0,shopWindow:l})]})},Xt=10,hi=()=>{const{user:t}=Oe(),[s,a]=n.useState([]),[r,l]=n.useState(!0),[d,c]=n.useState("all"),[f,j]=n.useState(1),[o,x]=n.useState("");n.useEffect(()=>{let u=!1;return(async()=>{if(t?.user_code){l(!0);try{const M=await H.get("/shops/me/bookings");if(u)return;const U=M.data?.data?.data||M.data?.data||[];a(Array.isArray(U)?U:[]),j(1)}catch(M){console.error("Error fetching bookings:",M),u||a([])}finally{u||l(!1)}}})(),()=>{u=!0}},[t?.user_code]);const i=n.useMemo(()=>{try{let u=s;if(d!=="all"&&(u=u.filter(M=>M.PaymentStatus===d)),o.trim()){const M=o.toLowerCase().trim();u=u.filter(U=>{const J=String(U.BookingCode||"").toLowerCase(),V=String(U.FieldName||"").toLowerCase(),R=String(U.CustomerPhone||"").toLowerCase(),P=String(U.CheckinCode||"").toLowerCase(),F=String(U.CustomerName||"").toLowerCase();return J.includes(M)||V.includes(M)||R.includes(M)||P.includes(M)||F.includes(M)})}return u}catch(u){return console.error("Error filtering bookings:",u),[]}},[s,d,o]),m=n.useMemo(()=>{const u=(f-1)*Xt;return i.slice(u,u+Xt)},[i,f]),b=Math.max(1,Math.ceil(i.length/Xt));n.useEffect(()=>{f>b&&j(1)},[b,f]);const p=n.useMemo(()=>({total:s.length,pending:s.filter(u=>u.PaymentStatus==="pending").length,paid:s.filter(u=>u.PaymentStatus==="paid").length,failed:s.filter(u=>u.PaymentStatus==="failed").length}),[s]),w=u=>{switch(u){case"paid":return"bg-emerald-100 text-emerald-800 border-emerald-200";case"pending":return"bg-amber-100 text-amber-800 border-amber-200";case"failed":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},g=u=>{switch(u){case"confirmed":return"bg-green-50 text-green-700 border-green-200";case"completed":return"bg-blue-50 text-blue-700 border-blue-200";case"cancelled":return"bg-red-50 text-red-700 border-red-200";case"pending":default:return"bg-gray-50 text-gray-700 border-gray-200"}},_=u=>{switch(u){case"pending":return"Chờ xác nhận";case"confirmed":return"Đã xác nhận";case"completed":return"Hoàn thành";case"cancelled":return"Đã hủy";default:return u}},k=u=>{switch(u){case"paid":return"Đã thanh toán";case"pending":return"Chờ thanh toán";case"failed":return"Thất bại";default:return u}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Quản lý Đơn Đặt"}),e.jsx("p",{className:"text-gray-600",children:"Theo dõi và quản lý tất cả đơn đặt sân của bạn"})]}),r?e.jsx("div",{className:"flex justify-center items-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-full border-4 border-gray-200 border-t-blue-600 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Đang tải dữ liệu..."})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6 shadow-sm hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"text-gray-600 text-sm font-medium mb-2",children:"Tổng Đơn"}),e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:p.total}),e.jsx("div",{className:"text-xs text-gray-500 mt-2",children:"Tất cả các đơn đặt"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-amber-200 p-6 shadow-sm hover:shadow-md transition-shadow bg-gradient-to-br from-white to-amber-50",children:[e.jsx("div",{className:"text-amber-800 text-sm font-medium mb-2",children:"Chờ Thanh Toán"}),e.jsx("div",{className:"text-3xl font-bold text-amber-900",children:p.pending}),e.jsx("div",{className:"text-xs text-amber-700 mt-2",children:"Đang chờ xử lý"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-emerald-200 p-6 shadow-sm hover:shadow-md transition-shadow bg-gradient-to-br from-white to-emerald-50",children:[e.jsx("div",{className:"text-emerald-800 text-sm font-medium mb-2",children:"Đã Thanh Toán"}),e.jsx("div",{className:"text-3xl font-bold text-emerald-900",children:p.paid}),e.jsx("div",{className:"text-xs text-emerald-700 mt-2",children:"Hoàn thành thanh toán"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-red-200 p-6 shadow-sm hover:shadow-md transition-shadow bg-gradient-to-br from-white to-red-50",children:[e.jsx("div",{className:"text-red-800 text-sm font-medium mb-2",children:"Thất Bại"}),e.jsx("div",{className:"text-3xl font-bold text-red-900",children:p.failed}),e.jsx("div",{className:"text-xs text-red-700 mt-2",children:"Thanh toán thất bại"})]})]}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6 mb-6 shadow-sm",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(sa,{className:"absolute left-3 top-3 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Tìm kiếm theo tên, số điện thoại, mã Checkin...",value:o,onChange:u=>{x(u.target.value),j(1)},className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition"})]}),e.jsxs("select",{value:d,onChange:u=>{c(u.target.value),j(1)},className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition",children:[e.jsxs("option",{value:"all",children:["Tất cả Trạng Thái (",p.total,")"]}),e.jsxs("option",{value:"pending",children:["Chờ Thanh Toán (",p.pending,")"]}),e.jsxs("option",{value:"paid",children:["Đã Thanh Toán (",p.paid,")"]}),e.jsxs("option",{value:"failed",children:["Thất Bại (",p.failed,")"]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden",children:i.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"text-gray-400 mb-2 text-5xl",children:"∅"}),e.jsx("p",{className:"text-gray-600 font-medium mb-1",children:"Không có dữ liệu"}),e.jsx("p",{className:"text-gray-500 text-sm",children:o?"Không tìm thấy kết quả phù hợp":"Chưa có đơn đặt nào"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto -mx-4 md:mx-0",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Mã"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Sân"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Số Sân"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Khách"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Số Điện Thoại"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Mã Check-in"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Ngày & Giờ"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Tiền"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Thanh Toán"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Trạng Thái"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:m.map(u=>e.jsxs("tr",{className:"hover:bg-blue-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 text-sm font-semibold text-gray-900",children:u.BookingCode}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:u.FieldName||`Sân ${u.FieldCode}`}),e.jsx("td",{className:"px-6 py-4 text-sm",children:u.quantityNumber?e.jsxs("span",{className:"inline-block px-2 py-1 rounded-full bg-emerald-100 text-emerald-700 text-xs font-medium",children:["Sân ",u.quantityNumber]}):e.jsx("span",{className:"text-gray-400 text-xs",children:"-"})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:u.CustomerName||`Khách #${u.CustomerUserID}`}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:u.CustomerPhone||"-"}),e.jsx("td",{className:"px-6 py-4 text-sm font-mono text-gray-700",children:u.CheckinCode||"-"}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:u.slots&&u.slots.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{children:new Date(u.slots[0].PlayDate).toLocaleDateString("vi-VN")}),e.jsx("div",{className:"text-gray-500 text-xs flex flex-col gap-1",children:u.slots.map(M=>e.jsxs("span",{children:[M.StartTime?.substring(0,5)," -"," ",M.EndTime?.substring(0,5)]},M.Slot_ID))})]}):e.jsx("div",{children:"-"})}),e.jsxs("td",{className:"px-6 py-4 text-right text-sm font-semibold text-gray-900",children:[u.TotalPrice?.toLocaleString("vi-VN"),"đ"]}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsx("span",{className:`inline-block px-3 py-1 rounded-full text-xs font-medium border ${w(u.PaymentStatus)}`,children:k(u.PaymentStatus)})}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsx("span",{className:`inline-block px-3 py-1 rounded-full text-xs font-medium border ${g(u.BookingStatus)}`,children:_(u.BookingStatus)})})]},u.BookingCode))})]})}),b>1&&e.jsxs("div",{className:"bg-gray-50 border-t border-gray-200 px-6 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Hiển thị ",(f-1)*Xt+1," đến"," ",Math.min(f*Xt,i.length)," ","trong ",i.length," đơn"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>j(u=>Math.max(1,u-1)),disabled:f===1,className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition",children:e.jsx(Lt,{className:"w-4 h-4"})}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:b},(u,M)=>M+1).map(u=>e.jsx("button",{onClick:()=>j(u),className:`w-8 h-8 rounded-lg border text-sm font-medium transition ${u===f?"bg-blue-600 text-white border-blue-600":"border-gray-300 text-gray-700 hover:bg-gray-100"}`,children:u},u))}),e.jsx("button",{onClick:()=>j(u=>Math.min(b,u+1)),disabled:f===b,className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition",children:e.jsx(Ns,{className:"w-4 h-4"})})]})]})]})})]})]})})},mi=()=>{const{user:t}=Oe(),[s,a]=n.useState(null),[r,l]=n.useState(!0),[d,c]=n.useState(!1),[f,j]=n.useState(""),[o,x]=n.useState(""),[i,m]=n.useState([]),[b,p]=n.useState([]);n.useEffect(()=>{let k=!1;return(async()=>{if(t?.user_code)try{l(!0),j("");const u=await jt();if(!k&&u){a(u.shop_code);const M=await Ma(u.shop_code);if(!k){p(M);const U=M.map(J=>J.utility_id);m(U)}}}catch(u){k||j(u?.message||"Không thể tải dữ liệu")}finally{k||l(!1)}})(),()=>{k=!0}},[t?.user_code]);const w=k=>{m(u=>u.includes(k)?u.filter(M=>M!==k):[...u,k])},g=async()=>{if(s)try{c(!0),j(""),x(""),await bl(s,i),x("Cập nhật tiện ích thành công!");const k=await Ma(s);p(k),setTimeout(()=>x(""),3e3)}catch(k){j(k?.message||"Không thể cập nhật tiện ích")}finally{c(!1)}},_=n.useMemo(()=>[{title:"Tiện ích Cơ Bản",utilities:dt.slice(0,4)},{title:"Tiện ích Bổ Sung",utilities:dt.slice(4)}],[]);return r?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(es,{className:"animate-spin w-8 h-8 text-blue-600"})}):e.jsxs("div",{className:"max-w-4xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Quản lý Tiện ích"}),e.jsx("p",{className:"text-gray-600",children:"Chọn các tiện ích mà sân của bạn cung cấp để giúp khách hàng dễ dàng tìm kiếm"})]}),f&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-3",children:[e.jsx(Ce,{className:"w-5 h-5 text-red-600 flex-shrink-0"}),e.jsx("span",{className:"text-red-800",children:f})]}),o&&e.jsxs("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg flex items-center gap-3",children:[e.jsx(nt,{className:"w-5 h-5 text-green-600 flex-shrink-0"}),e.jsx("span",{className:"text-green-800",children:o})]}),e.jsx("div",{className:"space-y-8",children:_.map(k=>e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:k.title}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:k.utilities.map(u=>{const M=i.includes(u.id);return e.jsxs("button",{onClick:()=>w(u.id),className:`relative p-6 rounded-xl border-2 transition-all text-left ${M?"border-blue-500 bg-blue-50":"border-gray-200 bg-white hover:border-gray-300"}`,children:[M&&e.jsx("div",{className:"absolute top-3 right-3 w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-3xl",children:u.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:u.label}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:xi(u.id)})]})]})]},u.id)})})]},k.title))}),e.jsxs("div",{className:"mt-8 flex gap-4",children:[e.jsxs("button",{onClick:g,disabled:d,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition font-semibold flex items-center gap-2",children:[d&&e.jsx(es,{className:"w-4 h-4 animate-spin"}),d?"Đang lưu...":"Lưu Thay Đổi"]}),e.jsx("button",{onClick:()=>{const k=b.map(u=>u.utility_id);m(k),j(""),x("")},className:"px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition font-semibold",children:"↻ Hoàn tác"})]}),e.jsx("div",{className:"mt-8 p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Tiện ích được chọn"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:[i.length,"/",dt.length]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Thay đổi"}),e.jsx("p",{className:`text-2xl font-bold mt-1 ${i.length===b.length?"text-gray-400":"text-blue-600"}`,children:i.length===b.length?"0":"Chưa lưu"})]})]})})]})};function xi(t){return{parking:"Bãi đỗ xe rộng rãi",restroom:"Nhà vệ sinh sạch sẽ",changing_room:"Phòng thay đồ riêng",ac:"Hệ thống điều hòa",hot_water:"Nước nóng, tắm rửa",wifi:"Kết nối WiFi miễn phí",racket_rental:"Cho thuê vợt, dạo cầu",ball_rental:"Cho thuê bóng, dụng cụ"}[t]||""}const $a=async()=>(await H.get("/shops/me/wallet")).data,ui=async t=>(await H.post("/shops/me/payout-requests",t)).data,gi=async(t,s=10,a=0)=>{const r={limit:s,offset:a};return(await H.get("/shops/me/payout-requests",{params:r})).data},pi=()=>{const{user:t}=Oe(),[s,a]=n.useState([]),[r,l]=n.useState(!0),[d,c]=n.useState(!1),[f,j]=n.useState(""),[o,x]=n.useState(""),[i,m]=n.useState(!1),[b,p]=n.useState(""),[w,g]=n.useState(!1),[_,k]=n.useState([]),[u,M]=n.useState(null),[U,J]=n.useState(!1),[V,R]=n.useState([]),[P,F]=n.useState(!1);n.useEffect(()=>{let v=!1;return(async()=>{if(t?.user_code){l(!0);try{const B=await jt();if(v)return;if(B){const O=await Ta();if(!v){const ve=O.filter(T=>T.BookingStatus==="confirmed"&&T.PaymentStatus==="paid");a(ve)}const re=await sl();v||k(Array.isArray(re)?re:[]);const te=await $a();v||M(te.data)}}catch(B){console.error(B),v||a([])}finally{v||l(!1)}}})(),()=>{v=!0}},[t?.user_code]);const D=async()=>{F(!0);try{const v=await gi();if(v.data){const B=v.data.data||v.data.list||[];R(B)}}catch(v){console.error("Error fetching payout requests:",v)}finally{F(!1)}},G=()=>{J(!0),D()},N=n.useMemo(()=>s.reduce((v,B)=>v+B.TotalPrice,0),[s]),q=n.useMemo(()=>Math.floor(N*.95),[N]),y=async v=>{v.preventDefault(),p("");const B=parseFloat(f);if(!B||B<=0){p("Vui lòng nhập số tiền hợp lệ");return}if(B>(u?.available||0)){p("Số tiền rút không được vượt quá số tiền có sẵn trong ví");return}if(!o){p("Vui lòng nhập mật khẩu xác nhận");return}if(_.length===0){p("Chưa có tài khoản ngân hàng. Vui lòng thêm tài khoản ngân hàng trong cài đặt.");return}m(!0);try{const O=_[0];await ui({amount:Math.floor(B),bank_id:O.ShopBankID,note:`Yêu cầu rút tiền - ${O.BankName} - ${O.AccountNumber}`,password:o}),g(!0),j(""),x(""),setTimeout(()=>{c(!1),g(!1)},2e3);const re=await Ta();a(re.filter(ve=>ve.BookingStatus==="confirmed"&&ve.PaymentStatus==="paid"));const te=await $a();M(te.data),U&&D()}catch(O){const re=O?.response?.data?.message||O?.message||"Lỗi khi tạo đơn rút tiền";p(re)}finally{m(!1)}},L=v=>{switch(v){case"paid":return{bgColor:"bg-green-100",textColor:"text-green-800",icon:ta,label:"Đã Thanh Toán"};case"processing":return{bgColor:"bg-blue-100",textColor:"text-blue-800",icon:Se,label:"Đang Xử Lý"};case"requested":return{bgColor:"bg-yellow-100",textColor:"text-yellow-800",icon:Se,label:"Chờ Duyệt"};case"rejected":return{bgColor:"bg-red-100",textColor:"text-red-800",icon:Ce,label:"Bị Từ Chối"};default:return{bgColor:"bg-gray-100",textColor:"text-gray-800",icon:Se,label:v}}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"shop-header",children:e.jsx("h1",{className:"shop-title",children:"Doanh Thu Và Rút Tiền"})}),r?e.jsx("div",{className:"loading-wrap",children:e.jsx("div",{className:"spinner"})}):e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-8 bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 rounded-lg p-6 shadow-lg",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-6",children:"📊 Tóm Tắt Doanh Thu"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-md hover:shadow-lg transition",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:"Tổng Tiền Đơn Đặt"}),e.jsx(Ft,{className:"w-5 h-5 text-blue-500"})]}),e.jsxs("p",{className:"text-3xl font-bold text-blue-600",children:[new Intl.NumberFormat("vi-VN").format(N),"đ"]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[s.length," đơn (100%)"]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-md hover:shadow-lg transition",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:"Thực Thu (95%)"}),e.jsx(It,{className:"w-5 h-5 text-green-500"})]}),e.jsxs("p",{className:"text-3xl font-bold text-green-600",children:[new Intl.NumberFormat("vi-VN").format(q),"đ"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Shop nhận được"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-md hover:shadow-lg transition",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:"Có Sẵn Rút"}),e.jsx(Zt,{className:"w-5 h-5 text-purple-500"})]}),e.jsxs("p",{className:"text-3xl font-bold text-purple-600",children:[new Intl.NumberFormat("vi-VN").format(u?.available||0),"đ"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Sẵn sàng rút tiền"})]})]})]}),e.jsxs("div",{className:"mb-6 flex gap-3 flex-wrap",children:[e.jsxs("button",{onClick:()=>{c(!d),p(""),j(""),x("")},className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold rounded-lg transition shadow-md hover:shadow-lg",children:[e.jsx(Zt,{className:"w-5 h-5"}),d?"Hủy":"Rút Tiền"]}),e.jsxs("button",{onClick:G,className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-indigo-500 to-indigo-600 hover:from-indigo-600 hover:to-indigo-700 text-white font-semibold rounded-lg transition shadow-md hover:shadow-lg",children:[e.jsx(ja,{className:"w-5 h-5"}),"Những Đơn Đã Rút"]})]}),d&&e.jsxs("div",{className:"mb-6 bg-white border border-gray-200 rounded-lg p-6 shadow-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Tạo Đơn Rút Tiền"}),e.jsxs("form",{onSubmit:y,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Số Tiền Rút (VNĐ)"}),e.jsx("input",{type:"number",value:f,onChange:v=>j(v.target.value),placeholder:"Nhập số tiền muốn rút",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",max:u?.available||0,step:"1000"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Tối đa:"," ",new Intl.NumberFormat("vi-VN").format(u?.available||0),"đ"]})]}),_.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Tài Khoản Nhận Tiền"}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Ngân Hàng:"})," ",_[0].BankName]}),e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Số Tài Khoản:"})," ",_[0].AccountNumber]}),_[0].AccountHolder&&e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Chủ Tài Khoản:"})," ",_[0].AccountHolder]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Xác Nhận Mật Khẩu"}),e.jsx("input",{type:"password",value:o,onChange:v=>x(v.target.value),placeholder:"Nhập mật khẩu để xác nhận",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"})]}),b&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 text-red-700 rounded-lg text-sm",children:b}),w&&e.jsx("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 text-green-700 rounded-lg text-sm",children:"✓ Đơn rút tiền đã được tạo thành công! Admin sẽ xử lý sớm nhất."}),e.jsx("div",{className:"flex gap-3",children:e.jsxs("button",{type:"submit",disabled:i,className:"flex items-center gap-2 px-6 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white font-semibold rounded-lg transition",children:[e.jsx(Zt,{className:"w-4 h-4"}),i?"Đang xử lý...":"Gửi Đơn Rút Tiền"]})})]})]}),e.jsxs("div",{className:"table-wrap",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800 flex items-center gap-2",children:"📝 Chi Tiết Các Đơn Đặt"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[s.length," đơn được xác nhận và thanh toán"]})]}),e.jsx("div",{className:"overflow-x-auto bg-white rounded-lg border border-gray-200 shadow-md",children:e.jsxs("table",{className:"table w-full",children:[e.jsx("thead",{className:"bg-gradient-to-r from-blue-50 to-blue-100 border-b-2 border-blue-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 font-semibold text-gray-700",children:"Mã Đơn"}),e.jsx("th",{className:"text-left px-4 py-3 font-semibold text-gray-700",children:"Sân"}),e.jsx("th",{className:"text-left px-4 py-3 font-semibold text-gray-700",children:"Khách Hàng"}),e.jsx("th",{className:"text-left px-4 py-3 font-semibold text-gray-700",children:"Ngày & Giờ"}),e.jsx("th",{className:"text-right px-4 py-3 font-semibold text-gray-700",children:"Tổng Tiền"}),e.jsx("th",{className:"text-right px-4 py-3 font-semibold text-green-700",children:"Thực Thu (95%)"})]})}),e.jsx("tbody",{children:s.length>0?s.map(v=>e.jsxs("tr",{className:"border-b border-gray-200 hover:bg-blue-50 transition",children:[e.jsx("td",{className:"px-4 py-3 font-mono text-sm text-blue-600 font-semibold",children:v.BookingCode}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("div",{className:"font-medium text-gray-800",children:v.FieldName??`Sân #${v.FieldCode}`})}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[e.jsx("div",{className:"text-gray-700",children:v.CustomerName??"Khách hàng"}),v.CustomerPhone&&e.jsx("div",{className:"text-xs text-gray-500",children:v.CustomerPhone})]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("div",{className:"flex flex-col gap-1",children:v.slots&&v.slots.length>0?e.jsx(e.Fragment,{children:v.slots.map(B=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-gray-700",children:[e.jsx(Wt,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-sm",children:new Date(B.PlayDate).toLocaleDateString("vi-VN")})]}),e.jsxs("div",{className:"flex items-center gap-1 text-gray-700 ml-5",children:[e.jsx(Se,{className:"w-4 h-4 text-orange-500"}),e.jsxs("span",{className:"text-sm",children:[B.StartTime.substring(0,5)," -"," ",B.EndTime.substring(0,5)]})]})]},B.Slot_ID))}):e.jsx("span",{className:"text-gray-400 italic text-xs",children:"Chưa có slot"})})}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right font-semibold text-gray-800",children:[new Intl.NumberFormat("vi-VN").format(v.TotalPrice),"đ"]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right font-bold text-green-600 bg-green-50",children:[new Intl.NumberFormat("vi-VN").format(Math.floor(v.TotalPrice*.95)),"đ"]})]},v.BookingCode)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center text-gray-500 py-8 text-sm",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("span",{className:"text-3xl",children:"📭"}),e.jsx("span",{children:"Chưa có đơn đặt được xác nhận và thanh toán."}),e.jsx("span",{className:"text-xs text-gray-400",children:"Khi có đơn, chúng sẽ hiển thị ở đây"})]})})})})]})})]}),U&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-4xl w-full my-8",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-indigo-50 to-indigo-100 border-b border-indigo-200 px-6 py-4 flex items-center justify-between rounded-t-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ja,{className:"w-6 h-6 text-indigo-600"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Lịch Sử Rút Tiền"})]}),e.jsx("button",{onClick:()=>J(!1),className:"p-2 hover:bg-indigo-200 rounded-lg transition",children:e.jsx(as,{className:"w-6 h-6 text-gray-600"})})]}),e.jsx("div",{className:"p-6",children:P?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"spinner"})}):V.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 border-b-2 border-gray-300",children:[e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"Mã Đơn"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"Số Tiền"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"Trạng Thái"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"Ghi Chú"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"Lý Do Từ Chối"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:"Ngày Tạo"})]})}),e.jsx("tbody",{children:V.map(v=>{const B=L(v.Status),O=B.icon;return e.jsxs("tr",{className:"border-b border-gray-200 hover:bg-indigo-50 transition",children:[e.jsxs("td",{className:"px-4 py-3 font-mono text-sm font-semibold text-indigo-600",children:["#",v.PayoutID]}),e.jsxs("td",{className:"px-4 py-3 font-semibold text-gray-800",children:[new Intl.NumberFormat("vi-VN").format(v.Amount),"đ"]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold ${B.bgColor} ${B.textColor}`,children:[e.jsx(O,{className:"w-3.5 h-3.5"}),B.label]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700 max-w-xs truncate",children:v.Note||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:v.RejectionReason?e.jsx("div",{className:"text-red-600 bg-red-50 px-2 py-1 rounded text-xs max-w-xs",children:v.RejectionReason}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:new Date(v.CreateAt).toLocaleDateString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})})]},v.PayoutID)})})]})}),e.jsx("div",{className:"md:hidden space-y-4",children:V.map(v=>{const B=L(v.Status),O=B.icon;return e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-lg p-4 hover:shadow-md transition",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-mono text-sm font-bold text-indigo-600",children:["#",v.PayoutID]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800 mt-1",children:[new Intl.NumberFormat("vi-VN").format(v.Amount),"đ"]})]}),e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold ${B.bgColor} ${B.textColor}`,children:[e.jsx(O,{className:"w-3.5 h-3.5"}),B.label]})]}),v.Note&&e.jsxs("div",{className:"mb-3 pb-3 border-b border-gray-100",children:[e.jsx("p",{className:"text-xs text-gray-600 font-medium",children:"GHI CHÚ"}),e.jsx("p",{className:"text-sm text-gray-700 mt-1",children:v.Note})]}),v.RejectionReason&&e.jsxs("div",{className:"mb-3 pb-3 border-b border-gray-100",children:[e.jsx("p",{className:"text-xs text-red-600 font-medium",children:"LÝ DO TỪ CHỐI"}),e.jsx("p",{className:"text-sm text-red-700 mt-1 bg-red-50 px-2 py-1 rounded",children:v.RejectionReason})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 font-medium",children:"NGÀY TẠO"}),e.jsx("p",{className:"text-sm text-gray-700 mt-1",children:new Date(v.CreateAt).toLocaleDateString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})})]})]},v.PayoutID)})})]}):e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("div",{className:"text-5xl mb-4",children:"📭"}),e.jsx("p",{className:"text-gray-500 text-lg",children:"Chưa có đơn rút tiền nào"}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Hãy tạo một đơn rút tiền để bắt đầu"})]})}),e.jsx("div",{className:"bg-gray-50 border-t border-gray-200 px-6 py-4 rounded-b-lg flex justify-end gap-3",children:e.jsx("button",{onClick:()=>J(!1),className:"px-6 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold rounded-lg transition",children:"Đóng"})})]})})]})]})},Fa=/^([01]\d|2[0-3]):[0-5]\d$/,fi=/^[0-9]{10,11}$/,us=t=>{if(!t)return"";const s=t.trim();return s?/^\d{2}:\d{2}:\d{2}$/.test(s)?s.slice(0,5):s:""},qa=t=>{const[s,a]=t.split(":").map(r=>Number(r));return s*60+a},bi=()=>{const{user:t}=Oe(),[s,a]=n.useState(null),[r,l]=n.useState(""),[d,c]=n.useState(""),[f,j]=n.useState(""),[o,x]=n.useState(""),[i,m]=n.useState(""),[b,p]=n.useState(""),[w,g]=n.useState(""),[_,k]=n.useState(!1),u=()=>(s?.shop_name||r||"").trim()||void 0,[M,U]=n.useState(!1),[J,V]=n.useState(""),[R,P]=n.useState("");n.useEffect(()=>{let N=!1;return(async()=>{if(t?.user_code)try{const q=await jt();N||a(q??null)}catch(q){if(console.error(q),N)return;q?.response?.status!==404&&V(q?.message||"Không thể tải thông tin shop.")}})(),()=>{N=!0}},[t?.user_code]),n.useEffect(()=>{s&&(l(s.shop_name||""),c(s.address||""),j(s.bank_name||""),x(s.bank_account_number||""),m(s.phone_number||""),k(!!s.is_open_24h),p(us(s.opening_time)),g(us(s.closing_time)))},[s]);const F=()=>{const N=r.trim(),q=d.trim(),y=i.trim();if(N.length<2)return"Tên shop phải có ít nhất 2 ký tự.";if(q.length<5)return"Địa chỉ phải có ít nhất 5 ký tự.";if(y&&!fi.test(y))return"Số điện thoại phải có 10-11 chữ số.";if(!_){const L=b.trim(),v=w.trim();if(!L||!v)return"Vui lòng nhập giờ mở và đóng cửa.";if(!Fa.test(L)||!Fa.test(v))return"Giờ mở/đóng cửa phải có định dạng HH:MM.";if(qa(L)>=qa(v))return"Giờ mở cửa phải nhỏ hơn giờ đóng cửa."}return""},D=async()=>{V(""),P("");const N=F();if(N){V(N);return}U(!0);try{const q=await Yr({shop_name:r.trim(),address:d.trim(),bank_account_number:o.trim()||void 0,bank_name:f.trim()||void 0,bank_account_holder:u(),phone_number:i.trim()||void 0,opening_time:_?null:b.trim(),closing_time:_?null:w.trim(),is_open_24h:_});try{const y=await jt();a(y??q)}catch{a(q)}P("Đã lưu thay đổi thành công.")}catch(q){const y=q,L=y.response?.status,v=y.response?.data?.error?.message||y.response?.data?.message||y.message;V(L===400?v||"Dữ liệu không hợp lệ (400).":L===401?v||"Bạn cần đăng nhập (401).":L===404?v||"Không tìm thấy shop (404).":L===500?v||"Lỗi máy chủ (500).":v||"Không thể lưu thay đổi.")}finally{U(!1)}},G=()=>{if(!s){k(!1),p(""),g("");return}k(!!s.is_open_24h),p(us(s.opening_time)),g(us(s.closing_time))};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"shop-header",children:e.jsx("h1",{className:"shop-title",children:"Cài đặt"})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"section",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Thông tin shop"}),J&&e.jsx("div",{className:"mb-3 rounded-lg border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700",children:J}),R&&e.jsx("div",{className:"mb-3 rounded-lg border border-emerald-200 bg-emerald-50 px-3 py-2 text-sm text-emerald-700",children:R}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Tên shop"}),e.jsx("input",{className:"input",value:r,onChange:N=>l(N.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Địa chỉ"}),e.jsx("input",{className:"input",value:d,onChange:N=>c(N.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Ngân hàng"}),e.jsx("input",{className:"input",value:f,onChange:N=>j(N.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Số tài khoản"}),e.jsx("input",{className:"input",value:o,onChange:N=>x(N.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Số điện thoại"}),e.jsx("input",{className:"input",value:i,onChange:N=>m(N.target.value)})]}),e.jsx("button",{className:"btn-primary",onClick:D,disabled:M,children:M?"Đang lưu...":"Lưu thay đổi"})]}),e.jsxs("div",{className:"section",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Giờ hoạt động"}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{className:"label flex items-center justify-between",children:[e.jsx("span",{children:"Giờ mở cửa"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:_,onChange:N=>k(N.target.checked)}),"Mở cửa 24/24"]})]}),e.jsx("input",{className:"input",type:"time",placeholder:"06:00",value:b,onChange:N=>p(N.target.value),disabled:_})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Giờ đóng cửa"}),e.jsx("input",{className:"input",type:"time",placeholder:"22:00",value:w,onChange:N=>g(N.target.value),disabled:_})]}),!_&&e.jsxs("p",{className:"text-xs text-gray-500 mb-3",children:["Chỉ được tạo khung giờ trong khoảng ",b||"HH:MM"," -"," ",w||"HH:MM"," ở mục Giá thuê sân."]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{className:"btn-ghost",type:"button",onClick:G,children:"Đặt lại"}),e.jsx("button",{className:"btn-outline",type:"button",onClick:()=>{k(!1),p(""),g("")},children:"Xoá giờ hoạt động"})]})]})]})]})},Ia=(t,s,a)=>{if(t&&"reportValidity"in t){const r=Rs(a,s);t.setCustomValidity(r&&r.message||""),t.reportValidity()}},un=(t,s)=>{for(const a in s.fields){const r=s.fields[a];r&&r.ref&&"reportValidity"in r.ref?Ia(r.ref,a,t):r&&r.refs&&r.refs.forEach(l=>Ia(l,a,t))}},ji=(t,s)=>{s.shouldUseNativeValidation&&un(t,s);const a={};for(const r in t){const l=Rs(s.fields,r),d=Object.assign(t[r]||{},{ref:l&&l.ref});if(yi(s.names||Object.keys(t),r)){const c=Object.assign({},Rs(a,r));Ts(c,"root",d),Ts(a,r,c)}else Ts(a,r,d)}return a},yi=(t,s)=>{const a=Ba(s);return t.some(r=>Ba(r).match(`^${a}\\.\\d+`))};function Ba(t){return t.replace(/\]|\[/g,"")}function Ni(t,s,a){return a===void 0&&(a={}),function(r,l,d){try{return Promise.resolve((function(c,f){try{var j=(s?.context,Promise.resolve(t[a.mode==="sync"?"validateSync":"validate"](r,Object.assign({abortEarly:!1},s,{context:l}))).then(function(o){return d.shouldUseNativeValidation&&un({},d),{values:a.raw?Object.assign({},r):o,errors:{}}}))}catch(o){return f(o)}return j&&j.then?j.then(void 0,f):j})(0,function(c){if(!c.inner)throw c;return{values:{},errors:ji((f=c,j=!d.shouldUseNativeValidation&&d.criteriaMode==="all",(f.inner||[]).reduce(function(o,x){if(o[x.path]||(o[x.path]={message:x.message,type:x.type}),j){var i=o[x.path].types,m=i&&i[x.type];o[x.path]=Cn(x.path,j,o,x.type,m?[].concat(m,x.message):x.message)}return o},{})),d)};var f,j}))}catch(c){return Promise.reject(c)}}}const vi=Tn({promotion_code:st().trim().required("Vui lòng nhập mã khuyến mãi").matches(/^[A-Z0-9_-]+$/i,"Mã chỉ gồm chữ, số, dấu gạch ngang hoặc gạch dưới").min(3,"Mã khuyến mãi phải có ít nhất 3 ký tự").max(50,"Mã khuyến mãi không được vượt quá 50 ký tự"),title:st().trim().required("Vui lòng nhập tiêu đề chiến dịch").min(3,"Tiêu đề phải có ít nhất 3 ký tự").max(150,"Tiêu đề không được vượt quá 150 ký tự"),description:st().trim().max(2e3,"Mô tả không được vượt quá 2000 ký tự").optional(),discount_type:oa().oneOf(["percent","fixed"],"Loại giảm giá không hợp lệ").required(),discount_value:En().typeError("Giá trị giảm không hợp lệ").positive("Giá trị giảm phải lớn hơn 0").when("discount_type",{is:"percent",then:t=>t.max(100,"Giảm theo % tối đa 100%"),otherwise:t=>t.max(1e8,"Giảm tối đa 100 triệu")}).required("Vui lòng nhập giá trị giảm"),max_discount_amount:st().trim().optional(),min_order_amount:st().trim().optional(),usage_limit:st().trim().optional(),usage_per_customer:st().trim().optional(),start_at:st().required("Vui lòng chọn thời gian bắt đầu"),end_at:st().required("Vui lòng chọn thời gian kết thúc").test("endAfterStart","Thời gian kết thúc phải sau thời gian bắt đầu",function(t){const{start_at:s}=this.parent;return!t||!s?!0:new Date(t)>new Date(s)}),status:oa().oneOf(["draft","active"],"Trạng thái không hợp lệ").default("draft")}).required(),wi={draft:"Nháp",scheduled:"Sắp diễn ra",active:"Đang chạy",expired:"Hết hạn",disabled:"Tạm dừng"},_i={draft:"bg-amber-100 text-amber-700",scheduled:"bg-blue-100 text-blue-700",active:"bg-emerald-100 text-emerald-700",expired:"bg-gray-200 text-gray-600",disabled:"bg-rose-100 text-rose-700"};function Ra(t){const s=a=>a.toString().padStart(2,"0");return`${t.getFullYear()}-${s(t.getMonth()+1)}-${s(t.getDate())}T${s(t.getHours())}:${s(t.getMinutes())}`}function Fs(){const t=new Date;t.setMinutes(0,0,0),t.setHours(t.getHours()+2);const s=new Date(t);return s.setDate(s.getDate()+7),{promotion_code:"",title:"",description:"",discount_type:"percent",discount_value:10,max_discount_amount:"",min_order_amount:"",usage_limit:"",usage_per_customer:"",start_at:Ra(t),end_at:Ra(s),status:"draft"}}function gs(t,s){return t instanceof Error&&t.message?t.message:typeof t=="string"&&t.trim()?t:s}const ki=new Intl.NumberFormat("vi-VN"),Ws=new Intl.DateTimeFormat("vi-VN",{dateStyle:"short",timeStyle:"short"}),qs=t=>t==null?"—":`${ki.format(t)}₫`,Si=(t,s)=>{try{const a=Ws.format(new Date(t)),r=Ws.format(new Date(s));return`${a} → ${r}`}catch{return"—"}},Ka=t=>{switch(t.current_status){case"disabled":return{label:"Kích hoạt",next:"active"};case"draft":return{label:"Kích hoạt",next:"active"};case"expired":return null;default:return{label:"Tạm dừng",next:"disabled"}}},Ci=()=>{const[t,s]=n.useState([]),[a,r]=n.useState(!0),[l,d]=n.useState(""),[c,f]=n.useState(!1),[j,o]=n.useState(null),[x,i]=n.useState(!1),[m,b]=n.useState(null),[p,w]=n.useState(null),[g,_]=n.useState("all"),[k,u]=n.useState(""),M=n.useMemo(()=>Fs(),[]),{register:U,handleSubmit:J,reset:V,watch:R,setValue:P,formState:{errors:F}}=yt({resolver:Ni(vi),defaultValues:M,mode:"onBlur"}),D=R("discount_type"),G=n.useCallback(async()=>{r(!0),d("");try{const T=await Dl();s(T)}catch(T){d(gs(T,"Không thể tải danh sách khuyến mãi"))}finally{r(!1)}},[]);n.useEffect(()=>{G()},[G]);const N=(T,se)=>{if(!se||!se.trim())return null;const ce=Number(se);if(!Number.isFinite(ce))throw new Error(`${T} không hợp lệ`);return ce},q=(T,se)=>{if(!se||!se.trim())return null;const ce=Number(se);if(!Number.isFinite(ce)||!Number.isInteger(ce))throw new Error(`${T} phải là số nguyên`);if(ce<=0)throw new Error(`${T} phải lớn hơn 0`);return ce},y=J(async T=>{o(null),d("");try{const se=N("Giá trị giảm tối đa",T.max_discount_amount),ce=N("Đơn tối thiểu",T.min_order_amount),ge=q("Giới hạn lượt dùng",T.usage_limit),de=q("Số lượt mỗi khách",T.usage_per_customer);if(ge!==null&&de!==null&&de>ge)throw new Error("Số lượt mỗi khách không được vượt quá tổng lượt sử dụng");if(se!==null&&se<=0)throw new Error("Giá trị giảm tối đa phải lớn hơn 0");if(ce!==null&&ce<0)throw new Error("Đơn tối thiểu không được âm");const De={promotion_code:T.promotion_code.trim().toUpperCase(),title:T.title.trim(),description:T.description?.trim()?T.description.trim():null,discount_type:T.discount_type,discount_value:T.discount_value,max_discount_amount:T.discount_type==="percent"?se:null,min_order_amount:ce??0,usage_limit:ge,usage_per_customer:de??1,start_at:T.start_at,end_at:T.end_at,status:T.status};i(!0);const Je=await $l(De);s(et=>[Je,...et]),o({type:"success",text:"Tạo khuyến mãi thành công"}),V(Fs()),f(!1)}catch(se){o({type:"error",text:gs(se,"Không thể tạo khuyến mãi")})}finally{i(!1)}}),L=async()=>{await G()},v=async T=>{const se=Ka(T);if(se){b(T.promotion_id),d("");try{const ce=await Fl(T.promotion_id,se.next);s(ge=>ge.map(de=>de.promotion_id===ce.promotion_id?ce:de))}catch(ce){d(gs(ce,"Không thể cập nhật trạng thái khuyến mãi"))}finally{b(null)}}},B=async T=>{if(window.confirm(`Bạn chắc chắn muốn xóa mã ${T.promotion_code}? Hành động này không thể hoàn tác.`)){w(T.promotion_id),d("");try{await Il(T.promotion_id),s(ce=>ce.filter(ge=>ge.promotion_id!==T.promotion_id))}catch(ce){d(gs(ce,"Không thể xóa khuyến mãi. Vui lòng thử lại."))}finally{w(null)}}},O=T=>{if(T.discount_type==="percent"){const se=T.max_discount_amount?` (tối đa ${qs(T.max_discount_amount)})`:"";return`${T.discount_value}%${se}`}return qs(T.discount_value)},re=n.useMemo(()=>{const T=t.length,se=t.filter(de=>de.current_status==="active").length,ce=t.filter(de=>de.current_status==="scheduled").length,ge=t.filter(de=>de.current_status==="expired").length;return[{title:"Tổng chiến dịch",value:T,subtitle:"Tất cả thời gian",accent:"from-emerald-400/20 to-emerald-500/10 text-emerald-700",icon:e.jsx(ss,{className:"h-5 w-5"})},{title:"Đang chạy",value:se,subtitle:"Tích cực trong tháng",accent:"from-blue-400/20 to-blue-500/10 text-blue-700",icon:e.jsx(Na,{className:"h-5 w-5"})},{title:"Sắp diễn ra",value:ce,subtitle:"Chuẩn bị kích hoạt",accent:"from-amber-400/20 to-amber-500/10 text-amber-700",icon:e.jsx(nr,{className:"h-5 w-5"})},{title:"Đã hết hạn",value:ge,subtitle:"Cần xem xét tái khởi động",accent:"from-gray-400/20 to-gray-500/10 text-gray-700",icon:e.jsx(ya,{className:"h-5 w-5"})}]},[t]),te=n.useMemo(()=>{const T=k.trim().toLowerCase();return t.filter(se=>g==="all"||se.current_status===g?T?[se.promotion_code,se.title,se.description??""].join(" ").toLowerCase().includes(T):!0:!1)},[t,g,k]),ve=g!=="all"||k.trim().length>0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"shop-header",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"shop-title",children:"Chiến dịch khuyến mãi"}),e.jsx("p",{className:"shop-sub",children:"Tạo mã giảm giá và quản lý hiệu quả các chương trình ưu đãi"})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{type:"button",className:"btn-outline",onClick:L,disabled:a,children:[e.jsx(bt,{className:"mr-2 h-4 w-4"}),"Làm mới"]}),e.jsxs("button",{type:"button",className:"btn-primary",onClick:()=>{f(T=>!T),o(null)},children:[e.jsx(ts,{className:"mr-2 h-4 w-4"}),c?"Đóng biểu mẫu":"Tạo khuyến mãi"]})]})]}),l&&e.jsx("div",{className:"rounded-lg border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700",children:l}),c&&e.jsx("div",{className:"section",children:e.jsxs("form",{onSubmit:y,className:"grid gap-4 md:grid-cols-2",children:[j&&e.jsx("div",{className:`md:col-span-2 rounded-lg border px-3 py-2 text-sm ${j.type==="success"?"border-emerald-200 bg-emerald-50 text-emerald-700":"border-red-200 bg-red-50 text-red-700"}`,children:j.text}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Mã khuyến mãi"}),e.jsx("input",{className:"input uppercase",placeholder:"SUMMER50",...U("promotion_code"),onBlur:T=>P("promotion_code",T.target.value.toUpperCase())}),F.promotion_code&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:F.promotion_code.message})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Tiêu đề"}),e.jsx("input",{className:"input",placeholder:"Giảm 20% sân cuối tuần",...U("title")}),F.title&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:F.title.message})]}),e.jsxs("div",{className:"form-group md:col-span-2",children:[e.jsx("label",{className:"label",children:"Mô tả"}),e.jsx("textarea",{className:"input min-h-[100px]",placeholder:"Mô tả ngắn gọn về ưu đãi, điều kiện áp dụng...",...U("description")}),F.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:F.description.message})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Loại giảm"}),e.jsxs("select",{className:"input",...U("discount_type"),children:[e.jsx("option",{value:"percent",children:"Phần trăm"}),e.jsx("option",{value:"fixed",children:"Số tiền cố định"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{className:"label",children:["Giá trị giảm ",D==="percent"?"(%)":"(₫)"]}),e.jsx("input",{type:"number",step:D==="percent"?1:1e3,min:0,className:"input",...U("discount_value",{valueAsNumber:!0})}),F.discount_value&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:F.discount_value.message})]}),D==="percent"&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Giảm tối đa (₫)"}),e.jsx("input",{type:"number",min:0,step:1e3,className:"input",placeholder:"Ví dụ: 50000",...U("max_discount_amount")})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Đơn tối thiểu (₫)"}),e.jsx("input",{type:"number",min:0,step:1e3,className:"input",placeholder:"Không bắt buộc",...U("min_order_amount")})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Giới hạn lượt dùng"}),e.jsx("input",{type:"number",min:1,step:1,className:"input",placeholder:"Không giới hạn nếu để trống",...U("usage_limit")})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Mỗi khách sử dụng"}),e.jsx("input",{type:"number",min:1,step:1,className:"input",placeholder:"Mặc định 1",...U("usage_per_customer")})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Bắt đầu"}),e.jsx("input",{type:"datetime-local",className:"input",...U("start_at")}),F.start_at&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:F.start_at.message})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Kết thúc"}),e.jsx("input",{type:"datetime-local",className:"input",...U("end_at")}),F.end_at&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:F.end_at.message})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Trạng thái khi tạo"}),e.jsxs("select",{className:"input",...U("status"),children:[e.jsx("option",{value:"draft",children:"Nháp"}),e.jsx("option",{value:"active",children:"Kích hoạt khi đến hạn"})]})]}),e.jsxs("div",{className:"md:col-span-2 flex items-center gap-3 pt-2",children:[e.jsxs("button",{type:"submit",className:"btn-primary",disabled:x,children:[x&&e.jsx(Yt,{className:"mr-2 h-4 w-4 animate-spin"}),"Lưu chiến dịch"]}),e.jsx("button",{type:"button",className:"btn-outline",onClick:()=>V(Fs()),disabled:x,children:"Đặt lại"})]})]})}),e.jsx("div",{className:"grid gap-4 lg:grid-cols-4 md:grid-cols-2",children:re.map(T=>e.jsx("div",{className:`rounded-2xl border border-transparent bg-gradient-to-br ${T.accent} p-5 shadow-sm`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wider text-gray-500",children:T.title}),e.jsx("p",{className:"mt-1 text-3xl font-bold text-gray-900",children:T.value}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:T.subtitle})]}),e.jsx("span",{className:"rounded-full bg-white/70 p-2 text-gray-700 shadow",children:T.icon})]})},T.title))}),e.jsxs("div",{className:"section space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Danh sách chiến dịch"}),e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:[{key:"all",label:"Tất cả"},{key:"active",label:"Đang chạy"},{key:"scheduled",label:"Sắp diễn ra"},{key:"draft",label:"Nháp"},{key:"disabled",label:"Tạm dừng"},{key:"expired",label:"Hết hạn"}].map(T=>e.jsx("button",{type:"button",onClick:()=>_(T.key),className:`rounded-full border px-3 py-1 text-xs font-semibold transition ${g===T.key?"border-emerald-500 bg-emerald-50 text-emerald-600":"border-gray-200 text-gray-600 hover:border-emerald-400"}`,children:T.label},T.key))}),e.jsxs("div",{className:"relative",children:[e.jsx(sa,{className:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"search",className:"input pl-9 pr-3",placeholder:"Tìm theo mã, tiêu đề, mô tả...",value:k,onChange:T=>u(T.target.value)})]})]})]}),a?e.jsx("div",{className:"loading-wrap",children:e.jsx("div",{className:"spinner"})}):te.length===0?e.jsxs("div",{className:"rounded-xl border border-dashed border-gray-300 bg-gray-50 px-6 py-10 text-center text-gray-500",children:[e.jsx("p",{className:"text-sm",children:t.length===0?"Chưa có chiến dịch nào. Hãy tạo khuyến mãi đầu tiên!":"Không tìm thấy khuyến mãi phù hợp với bộ lọc hiện tại."}),ve&&e.jsx("button",{type:"button",className:"btn-outline mt-4 inline-flex items-center",onClick:()=>{_("all"),u("")},children:"Đặt lại bộ lọc"})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:te.map(T=>{const se=Ka(T);return e.jsxs("div",{className:"group flex h-full flex-col justify-between rounded-2xl border border-gray-200 bg-white p-5 shadow-sm transition hover:-translate-y-1 hover:shadow-lg",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wider text-gray-400",children:T.promotion_code}),e.jsx("h3",{className:"mt-1 text-lg font-semibold text-gray-900",children:T.title})]}),e.jsx("span",{className:`inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold ${_i[T.current_status]}`,children:wi[T.current_status]||"—"})]}),T.description&&e.jsx("p",{className:"text-sm text-gray-600",children:T.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"rounded-lg border border-gray-100 bg-gray-50 p-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Giảm"}),e.jsx("p",{className:"font-semibold text-gray-900",children:O(T)})]}),e.jsxs("div",{className:"rounded-lg border border-gray-100 bg-gray-50 p-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Đơn tối thiểu"}),e.jsx("p",{className:"font-semibold text-gray-900",children:T.min_order_amount?qs(T.min_order_amount):"Không yêu cầu"})]}),e.jsxs("div",{className:"rounded-lg border border-gray-100 bg-gray-50 p-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Giới hạn"}),e.jsx("p",{className:"font-semibold text-gray-900",children:T.usage_limit?`${T.usage_count}/${T.usage_limit}`:"Không giới hạn"})]}),e.jsxs("div",{className:"rounded-lg border border-gray-100 bg-gray-50 p-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Mỗi khách"}),e.jsx("p",{className:"font-semibold text-gray-900",children:T.usage_per_customer??1})]})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-dashed border-emerald-200 bg-emerald-50/60 px-3 py-2 text-xs text-emerald-700",children:[e.jsx("span",{children:"Thời gian áp dụng"}),e.jsx("span",{className:"font-semibold",children:Si(T.start_at,T.end_at)})]})]}),e.jsxs("div",{className:"mt-5 flex items-center justify-between",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["Cập nhật"," ",Ws.format(new Date(T.update_at))]}),e.jsxs("div",{className:"flex items-center gap-2",children:[se?e.jsxs("button",{type:"button",className:"btn-outline flex items-center gap-1",onClick:()=>v(T),disabled:m===T.promotion_id,children:[m===T.promotion_id?e.jsx(Yt,{className:"h-4 w-4 animate-spin"}):se.next==="disabled"?e.jsx(ya,{className:"h-4 w-4"}):e.jsx(Na,{className:"h-4 w-4"}),se.label]}):e.jsxs("div",{className:"inline-flex items-center gap-1 text-xs text-gray-400",children:["Đã kết thúc",e.jsx(Wn,{className:"h-3.5 w-3.5"})]}),e.jsx("button",{type:"button",className:"btn-outline border-rose-200 text-rose-700 hover:border-rose-400 hover:text-rose-800",onClick:()=>B(T),disabled:p===T.promotion_id,children:p===T.promotion_id?e.jsx(Yt,{className:"h-4 w-4 animate-spin"}):"Xóa"})]})]})]},T.promotion_id)})})]})]})},Tt="flex items-center gap-3 rounded-xl px-3 py-2 text-sm transition-all",Et="text-gray-700 hover:text-gray-900 hover:bg-gray-100",Mt="bg-gray-900 text-white shadow";function Ti(){const{user:t}=Oe(),[s,a]=n.useState(!1);return e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[280px_1fr] gap-6",children:[e.jsxs("aside",{className:["rounded-2xl bg-white shadow-md border border-gray-100 sticky top-6 h-max",s?"lg:w-[84px]":"lg:w-[280px]"].join(" "),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-emerald-100 text-emerald-700 font-semibold",children:"A"}),!s&&e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold leading-tight",children:"Admin Panel"}),e.jsx("div",{className:"text-xs text-gray-500",children:t?.email})]})]}),e.jsx("button",{onClick:()=>a(r=>!r),className:"hidden lg:flex h-8 w-8 items-center justify-center rounded-lg border border-gray-200 hover:bg-gray-50","aria-label":s?"Expand sidebar":"Collapse sidebar",title:s?"Mở rộng":"Thu gọn",children:s?e.jsx(Ns,{className:"h-4 w-4"}):e.jsx(Lt,{className:"h-4 w-4"})})]}),e.jsxs("nav",{className:"p-3 space-y-1",children:[e.jsxs(Ie,{to:"/admin/dashboard",className:({isActive:r})=>`${Tt} ${r?Mt:Et}`,children:[e.jsx(ur,{className:"h-4 w-4"}),!s&&e.jsx("span",{children:"Tổng quan"})]}),e.jsxs(Ie,{to:"/admin/users",className:({isActive:r})=>`${Tt} ${r?Mt:Et}`,children:[e.jsx(_s,{className:"h-4 w-4"}),!s&&e.jsx("span",{children:"Quản lý người dùng"})]}),e.jsxs(Ie,{to:"/admin/shops",className:({isActive:r})=>`${Tt} ${r?Mt:Et}`,children:[e.jsx(Za,{className:"h-4 w-4"}),!s&&e.jsx("span",{children:"Chủ sân"})]}),e.jsxs(Ie,{to:"/admin/requests",className:({isActive:r})=>`${Tt} ${r?Mt:Et}`,children:[e.jsx(or,{className:"h-4 w-4"}),!s&&e.jsx("span",{children:"Yêu cầu mở sân"})]}),e.jsxs(Ie,{to:"/admin/insights",className:({isActive:r})=>`${Tt} ${r?Mt:Et}`,children:[e.jsx(Ks,{className:"h-4 w-4"}),!s&&e.jsx("span",{children:"Insights"})]}),e.jsxs(Ie,{to:"/admin/payouts",className:({isActive:r})=>`${Tt} ${r?Mt:Et}`,children:[e.jsx($t,{className:"h-4 w-4"}),!s&&e.jsx("span",{children:"Yêu Cầu Rút Tiền"})]})]})]}),e.jsx("main",{className:"rounded-2xl bg-white shadow-md border border-gray-100 p-4 lg:p-6 min-h-[60vh]",children:e.jsx(Ua,{})})]})})}const mt=(t,s)=>{if(t?.success&&t.data!==void 0)return t.data;const a=t?.error?.message||t?.message||s;throw new Error(a)},ls=t=>Array.isArray(t)?t:Array.isArray(t.items)?t.items:Array.isArray(t.data)?t.data:Array.isArray(t.rows)?t.rows:[],gn=t=>t&&typeof t=="object"&&!Array.isArray(t)&&"items"in t?t.items:t&&typeof t=="object"&&!Array.isArray(t)&&"data"in t?t.data:t&&typeof t=="object"&&!Array.isArray(t)&&"rows"in t?t.rows:t,kt=(t,s)=>{if(t instanceof Error&&t.message)return t.message;if(typeof t=="object"&&t!==null){const a=t,r=a.response?.data?.error?.message||a.response?.data?.message||a.message;if(r)return r}return s};async function pn(){try{const{data:t}=await H.get("/admin/users"),s=mt(t,"Không thể tải danh sách người dùng.");return ls(s)}catch(t){throw new Error(kt(t,"Không thể tải danh sách người dùng."))}}async function Ei(){try{const{data:t}=await H.get("/admin/users/levels"),s=mt(t,"Không thể tải thông tin phân quyền.");return ls(s)}catch(t){throw new Error(kt(t,"Không thể tải thông tin phân quyền."))}}async function la(){try{const{data:t}=await H.get("/admin/shops"),s=mt(t,"Không thể tải danh sách shop.");return ls(s)}catch(t){throw new Error(kt(t,"Không thể tải danh sách shop."))}}async function fn(t){try{const{data:s}=await H.get("/admin/revenue",{params:t?{year:t}:void 0}),a=mt(s,"Không thể tải dữ liệu doanh thu.");return ls(a)}catch(s){throw new Error(kt(s,"Không thể tải dữ liệu doanh thu."))}}async function ia(){try{const{data:t}=await H.get("/admin/shop-requests"),s=mt(t,"Không thể tải danh sách yêu cầu mở shop.");return ls(s)}catch(t){throw new Error(kt(t,"Không thể tải danh sách yêu cầu mở shop."))}}async function Mi(t={}){try{const s=new URLSearchParams;t.startDate&&s.set("startDate",t.startDate),t.endDate&&s.set("endDate",t.endDate),t.fieldCode&&s.set("fieldCode",t.fieldCode),t.customerUserID&&s.set("customerUserID",t.customerUserID),t.bookingStatus&&t.bookingStatus!=="all"&&s.set("bookingStatus",t.bookingStatus),typeof t.limit=="number"&&s.set("limit",String(t.limit)),typeof t.offset=="number"&&s.set("offset",String(t.offset));const{data:a}=await H.get("/admin/finance/bookings",{params:s});return mt(a,"Không thể tải dữ liệu tài chính.")}catch(s){throw new Error(kt(s,"Không thể tải dữ liệu tài chính."))}}async function Pi(t,s){const{data:a}=await H.patch(`/admin/users/${t}/status`,{isActive:s}),r=mt(a,s?"Không thể mở khóa tài khoản người dùng.":"Không thể khóa tài khoản người dùng."),l=gn(r);if(!l)throw new Error("Không nhận được dữ liệu người dùng đã cập nhật.");return l}async function Li(t,s){try{const{data:a}=await H.patch(`/admin/shop-requests/${t}/status`,{status:s}),r=mt(a,"Không thể cập nhật trạng thái yêu cầu mở shop."),l=gn(r);if(!l)throw new Error("Không nhận được dữ liệu yêu cầu đã cập nhật.");return l}catch(a){throw new Error(kt(a,"Không thể cập nhật trạng thái yêu cầu mở shop."))}}const ps=async(t,s,a=10,r=0)=>{const l={limit:a,offset:r};return t&&(l.status=t),(await H.get("/admin/payout-requests",{params:l})).data},Ai=async(t,s)=>(await H.patch(`/admin/payout-requests/${t}/approve`,{})).data,Di=async(t,s)=>(await H.patch(`/admin/payout-requests/${t}/reject`,s)).data,$i=[{value:"all",label:"Tất cả"},{value:"pending",label:"Pending"},{value:"confirmed",label:"Confirmed"},{value:"cancelled",label:"Cancelled"},{value:"completed",label:"Completed"}],Fi=[["today","Hôm nay"],["week","7 ngày"],["month","Tháng này"],["year","Năm nay"]],Is={total_records:0,total_total_price:0,total_platform_fee:0,total_net_to_shop:0,total_checkins:0,total_quantity_ids:0,first_create_at:null,last_create_at:null},ft=t=>Number(t??0).toLocaleString("vi-VN"),qi=new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",minimumFractionDigits:0}),Pe=t=>qi.format(t??0),fs=t=>{const s=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${s}-${a}-${r}`},bs=(t,s="-")=>{if(!t)return s;const a=new Date(t);return Number.isNaN(a.getTime())?t:a.toLocaleString("vi-VN",{hour12:!1})},Ii={emerald:"bg-emerald-500",blue:"bg-sky-500",orange:"bg-orange-500",slate:"bg-slate-500"},Va=()=>{const t=new Date,s=new Date(t.getFullYear(),t.getMonth(),1),a={startDate:fs(s),endDate:fs(t),fieldCode:"",customerUserID:"",bookingStatus:"all"},[r,l]=n.useState(a),[d,c]=n.useState(a),[f,j]=n.useState([]),[o,x]=n.useState(Is),[i,m]=n.useState(!1),[b,p]=n.useState(""),[w,g]=n.useState("");n.useEffect(()=>{let y=!1;return(async()=>{try{m(!0),p("");const L=await Mi({...d,limit:500,offset:0});y||(j(L.items??[]),x(L.summary??Is),g(new Date().toISOString()))}catch(L){console.error(L),y||(j([]),x(Is),p(L?.message||"Không thể tải dữ liệu tài chính."))}finally{y||m(!1)}})(),()=>{y=!0}},[d]);const _=n.useMemo(()=>f.reduce((y,L)=>{const v=L.booking_status?.trim()||"other";return y[v]=(y[v]??0)+1,y},{}),[f]),k=n.useMemo(()=>f.reduce((y,L)=>{const v=L.payment_status?.trim()||"other";return y[v]=(y[v]??0)+1,y},{}),[f]),u=(y,L)=>{l(v=>({...v,[y]:L}))},M=()=>{c(r)},U=()=>{c(y=>({...y}))},J=y=>{const L=new Date;let v=new Date;switch(y){case"today":break;case"week":v.setDate(v.getDate()-6);break;case"month":v=new Date(L.getFullYear(),L.getMonth(),1);break;case"year":v=new Date(L.getFullYear(),0,1);break}const B={...r,startDate:fs(v),endDate:fs(L)};l(B),c(B)},V=()=>{l(a),c(a)},R=n.useMemo(()=>{const y=o.total_records||0,L=o.total_total_price||0,v=o.total_net_to_shop||0,B=o.total_platform_fee||0,O=y?L/y:0,re=y?v/y:0,te=L?B/L*100:0,ve=L?v/L*100:0,T=y||1,se=Object.entries(_).map(([ge,de])=>({label:ge,count:de,percent:Math.round(de/T*100)})).sort((ge,de)=>de.count-ge.count),ce=Object.entries(k).map(([ge,de])=>({label:ge,count:de,percent:Math.round(de/T*100)})).sort((ge,de)=>de.count-ge.count);return{totalRecords:y,totalPrice:L,totalNet:v,totalPlatform:B,averageTicket:O,averageNet:re,platformShare:te,netShare:ve,statusDistribution:se,paymentDistribution:ce}},[o,_,k]),P=n.useMemo(()=>{const y=new Map;return f.forEach(L=>{const v=L.customer_user_id!==null?`id-${L.customer_user_id}`:L.customer_name||"anonymous",B=y.get(v)??{name:L.customer_name?.trim()||"Khách lẻ",total:0,count:0};B.total+=L.net_to_shop??0,B.count+=1,y.set(v,B)}),Array.from(y.values()).sort((L,v)=>v.total-L.total).slice(0,5)},[f]),F=n.useMemo(()=>{const y=new Map;return f.forEach(L=>{const v=y.get(L.field_code)??{name:L.field_name||`Sân #${L.field_code}`,total:0,bookings:0};v.total+=L.total_price??0,v.bookings+=1,y.set(L.field_code,v)}),Array.from(y.entries()).map(([L,v])=>({code:L,...v})).sort((L,v)=>v.total-L.total).slice(0,5)},[f]),D=n.useMemo(()=>[...f].filter(y=>y.create_at).sort((y,L)=>new Date(L.create_at||0).getTime()-new Date(y.create_at||0).getTime()).slice(0,6),[f]),G=(y,L)=>{if(!y.length)return e.jsx("div",{className:"rounded-xl border border-dashed border-slate-200 p-8 text-center text-sm text-slate-500",children:"Chưa có dữ liệu cho bộ lọc hiện tại."});const v=Ii[L];return e.jsx("div",{className:"space-y-4",children:y.map(B=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm font-medium text-slate-700",children:[e.jsx("span",{className:"capitalize",children:B.label||"Khác"}),e.jsxs("span",{className:"text-xs font-semibold text-slate-500",children:[ft(B.count)," · ",B.percent,"%"]})]}),e.jsx("div",{className:"relative h-2 overflow-hidden rounded-full bg-slate-100",children:e.jsx("div",{className:`absolute inset-y-0 left-0 rounded-full ${v}`,style:{width:`${Math.min(B.percent,100)}%`}})})]},B.label))})},N=bs(o.last_create_at,"Chưa có dữ liệu"),q=bs(w,"—");return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("section",{className:"relative overflow-hidden rounded-3xl bg-gradient-to-r from-emerald-500 via-emerald-400 to-emerald-600 text-white shadow-xl",children:[e.jsxs("div",{className:"absolute inset-0 opacity-40 mix-blend-overlay",children:[e.jsx("div",{className:"absolute -left-10 top-10 h-48 w-48 rounded-full bg-white/20 blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-0 h-56 w-56 rounded-full bg-emerald-900/40 blur-3xl"})]}),e.jsxs("div",{className:"relative px-8 py-10 lg:px-12",children:[e.jsxs("div",{className:"flex flex-col gap-6 lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs("div",{className:"max-w-2xl space-y-3",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full bg-white/15 px-4 py-2 text-sm font-medium",children:[e.jsx(Yn,{className:"h-4 w-4"}),"Trung tâm tài chính"]}),e.jsx("h1",{className:"text-3xl font-bold tracking-tight md:text-4xl",children:"Bảng điều khiển doanh thu & dòng tiền"}),e.jsx("p",{className:"text-base text-emerald-50/90 md:text-lg",children:"Theo dõi hiệu suất tài chính theo thời gian thực, quản lý doanh thu đa kênh và phát hiện cơ hội tối ưu hóa chỉ trong một màn hình."}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-6 gap-y-2 text-sm text-emerald-50/80",children:[e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(Se,{className:"h-4 w-4"}),"Dữ liệu đến: ",N]}),e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(Os,{className:`h-4 w-4 ${i?"animate-spin":""}`}),"Lần làm mới gần nhất: ",q]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{className:"btn-ghost hover:text-white hover:bg-white/10",onClick:V,disabled:i,children:"Đặt lại"}),e.jsxs("button",{className:"btn-primary bg-white/20 font-semibold text-emerald-900 hover:brightness-110",onClick:U,disabled:i,children:[e.jsx(Os,{className:`h-4 w-4 ${i?"animate-spin":""}`}),"Làm mới dữ liệu"]})]})]}),e.jsxs("div",{className:"mt-10 grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"rounded-2xl border border-white/15 bg-white/10 p-5 backdrop-blur",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm font-semibold text-emerald-50/80",children:["Tổng doanh thu",e.jsx(Ft,{className:"h-5 w-5 text-emerald-100"})]}),e.jsx("div",{className:"mt-4 text-3xl font-bold",children:Pe(R.totalPrice)}),e.jsx("p",{className:"mt-2 text-sm text-emerald-50/70",children:"Toàn bộ giá trị booking phát sinh theo bộ lọc hiện tại."})]}),e.jsxs("div",{className:"rounded-2xl border border-white/15 bg-white/10 p-5 backdrop-blur",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm font-semibold text-emerald-50/80",children:["Doanh thu thực nhận",e.jsx(Us,{className:"h-5 w-5 text-emerald-100"})]}),e.jsx("div",{className:"mt-4 text-3xl font-bold",children:Pe(R.totalNet)}),e.jsxs("p",{className:"mt-2 text-sm text-emerald-50/70",children:["Sau khi trừ phí nền tảng · ",R.netShare.toFixed(1),"% tổng booking."]})]}),e.jsxs("div",{className:"rounded-2xl border border-white/15 bg-white/10 p-5 backdrop-blur",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm font-semibold text-emerald-50/80",children:["Phí nền tảng",e.jsx(Ks,{className:"h-5 w-5 text-emerald-100"})]}),e.jsx("div",{className:"mt-4 text-3xl font-bold",children:Pe(R.totalPlatform)}),e.jsxs("p",{className:"mt-2 text-sm text-emerald-50/70",children:["Chiếm ",R.platformShare.toFixed(1),"% tổng booking ·"," ",ft(o.total_checkins)," lượt check-in."]})]})]})]})]}),e.jsxs("section",{className:"grid gap-6 lg:grid-cols-[360px_1fr]",children:[e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white/80 p-6 shadow-sm backdrop-blur",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-900",children:[e.jsx(vs,{className:"h-5 w-5 text-emerald-500"}),e.jsx("h2",{className:"text-lg font-semibold",children:"Bộ lọc nâng cao"})]}),e.jsx("p",{className:"mt-1 text-sm text-slate-500",children:"Thu hẹp phạm vi dữ liệu theo thời gian, sân, khách hàng và trạng thái để phân tích chính xác hơn."}),e.jsxs("div",{className:"mt-6 space-y-5 text-sm",children:[e.jsxs("label",{className:"space-y-2",children:[e.jsx("span",{className:"font-semibold text-slate-600",children:"Khoảng thời gian"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("input",{type:"date",value:r.startDate,onChange:y=>u("startDate",y.target.value),className:"form-input w-full rounded-xl border border-slate-200 px-3 py-2 text-sm"}),e.jsx("input",{type:"date",value:r.endDate,onChange:y=>u("endDate",y.target.value),className:"form-input w-full rounded-xl border border-slate-200 px-3 py-2 text-sm"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("label",{className:"space-y-2",children:[e.jsx("span",{className:"font-semibold text-slate-600",children:"Mã sân (FieldCode)"}),e.jsx("input",{type:"number",value:r.fieldCode,onChange:y=>u("fieldCode",y.target.value),className:"form-input w-full rounded-xl border border-slate-200 px-3 py-2 text-sm",placeholder:"VD: 68",min:0})]}),e.jsxs("label",{className:"space-y-2",children:[e.jsx("span",{className:"font-semibold text-slate-600",children:"Mã khách (CustomerID)"}),e.jsx("input",{type:"number",value:r.customerUserID,onChange:y=>u("customerUserID",y.target.value),className:"form-input w-full rounded-xl border border-slate-200 px-3 py-2 text-sm",placeholder:"VD: 11",min:0})]})]}),e.jsxs("label",{className:"space-y-2",children:[e.jsx("span",{className:"font-semibold text-slate-600",children:"Trạng thái booking"}),e.jsx("select",{className:"form-input w-full rounded-xl border border-slate-200 px-3 py-2 text-sm",value:r.bookingStatus,onChange:y=>u("bookingStatus",y.target.value),children:$i.map(y=>e.jsx("option",{value:y.value,children:y.label},y.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"font-semibold text-slate-600",children:"Bộ lọc nhanh"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Fi.map(([y,L])=>e.jsx("button",{className:"rounded-full border border-slate-200 px-3 py-1 text-xs font-semibold text-slate-600 transition hover:border-emerald-400 hover:text-emerald-600",onClick:()=>J(y),type:"button",children:L},y))})]})]}),e.jsxs("div",{className:"mt-6 flex items-center gap-3",children:[e.jsx("button",{className:"btn-primary flex-1 justify-center",onClick:M,disabled:i,children:"Áp dụng bộ lọc"}),e.jsx("button",{className:"btn-ghost px-4",onClick:V,disabled:i,children:"Xóa lọc"})]}),b&&e.jsx("div",{className:"mt-4 rounded-xl bg-rose-50 px-4 py-3 text-sm text-rose-600",children:b})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3",children:[e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm font-semibold text-slate-500",children:["Tổng số booking",e.jsx(va,{className:"h-5 w-5 text-emerald-500"})]}),e.jsx("div",{className:"mt-4 text-3xl font-bold text-slate-900",children:ft(R.totalRecords)}),e.jsxs("p",{className:"mt-1 text-xs text-slate-500",children:[ft(o.total_checkins)," lượt check-in ·"," ",ft(o.total_quantity_ids)," Sân lẻ"]})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm font-semibold text-slate-500",children:["Giá trị trung bình đơn",e.jsx(gr,{className:"h-5 w-5 text-emerald-500"})]}),e.jsx("div",{className:"mt-4 text-3xl font-bold text-slate-900",children:Pe(R.averageTicket)}),e.jsxs("p",{className:"mt-1 text-xs text-slate-500",children:["Net thực nhận trung bình:"," ",Pe(R.averageNet)]})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm font-semibold text-slate-500",children:["Tỷ trọng dòng tiền",e.jsx(It,{className:"h-5 w-5 text-emerald-500"})]}),e.jsxs("div",{className:"mt-4 text-xl font-semibold text-slate-900",children:["Net / Gross: ",R.netShare.toFixed(1),"%"]}),e.jsxs("div",{className:"mt-3 space-y-2 text-xs text-slate-500",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Phí nền tảng"}),e.jsxs("span",{children:[R.platformShare.toFixed(1),"%"]})]}),e.jsx("div",{className:"h-1.5 rounded-full bg-slate-200",children:e.jsx("div",{className:"h-full rounded-full bg-emerald-500",style:{width:`${Math.min(R.platformShare,100)}%`}})})]})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm font-semibold text-slate-500",children:["Khách hàng nổi bật",e.jsx(_s,{className:"h-5 w-5 text-emerald-500"})]}),e.jsx("div",{className:"mt-4 space-y-3 text-sm text-slate-600",children:P.length?P.map(y=>e.jsxs("div",{className:"flex items-center justify-between rounded-xl border border-slate-100 px-3 py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-slate-900",children:y.name}),e.jsxs("div",{className:"text-xs text-slate-500",children:[y.count," đơn"]})]}),e.jsx("span",{className:"text-sm font-semibold text-emerald-600",children:Pe(y.total)})]},y.name)):e.jsx("div",{className:"rounded-xl border border-dashed border-slate-200 px-4 py-6 text-center text-xs text-slate-500",children:"Bộ lọc hiện chưa có khách hàng nào."})})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm font-semibold text-slate-500",children:["Sân mang lại doanh thu cao",e.jsx(ar,{className:"h-5 w-5 text-emerald-500"})]}),e.jsx("div",{className:"mt-4 space-y-3 text-sm text-slate-600",children:F.length?F.map(y=>e.jsxs("div",{className:"flex items-center justify-between rounded-xl border border-slate-100 px-3 py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-slate-900",children:y.name}),e.jsxs("div",{className:"text-xs text-slate-500",children:["#",y.code," · ",y.bookings," đơn"]})]}),e.jsx("span",{className:"text-sm font-semibold text-emerald-600",children:Pe(y.total)})]},y.code)):e.jsx("div",{className:"rounded-xl border border-dashed border-slate-200 px-4 py-6 text-center text-xs text-slate-500",children:"Chưa có booking theo bộ lọc."})})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm font-semibold text-slate-500",children:["Gần nhất",e.jsx(Se,{className:"h-5 w-5 text-emerald-500"})]}),e.jsx("div",{className:"mt-4 space-y-3 text-sm text-slate-600",children:D.length?D.map(y=>e.jsxs("div",{className:"flex flex-col rounded-xl border border-slate-100 px-3 py-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs uppercase tracking-wide text-slate-400",children:["#",y.booking_code,e.jsx("span",{children:bs(y.create_at)})]}),e.jsxs("div",{className:"mt-1 font-semibold text-slate-900",children:[y.customer_name||"Khách lẻ"," ·"," ",Pe(y.total_price)]}),e.jsxs("div",{className:"text-xs text-slate-500",children:[y.field_name||`Sân #${y.field_code}`," ·"," ",y.booking_status||"Chưa rõ"]})]},`recent-${y.booking_code}`)):e.jsx("div",{className:"rounded-xl border border-dashed border-slate-200 px-4 py-6 text-center text-xs text-slate-500",children:"Bộ lọc chưa có giao dịch mới."})})]})]})]}),e.jsxs("section",{className:"grid gap-6 xl:grid-cols-3",children:[e.jsxs("div",{className:"space-y-6 xl:col-span-2",children:[e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-emerald-50 text-emerald-600",children:e.jsx(Ks,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Phân bổ trạng thái booking"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Theo dõi tỷ trọng các trạng thái để nắm tình hình vận hành."})]})]}),e.jsx("div",{className:"mt-6",children:G(R.statusDistribution,"emerald")})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-sky-50 text-sky-600",children:e.jsx(It,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Phân bổ trạng thái thanh toán"}),e.jsx("p",{className:"text-xs text-slate-500",children:"So sánh tỷ lệ thanh toán thành công để cải thiện thu tiền."})]})]}),e.jsx("div",{className:"mt-6",children:G(R.paymentDistribution,"blue")})]})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-amber-50 text-amber-600",children:e.jsx(hr,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Điểm nhấn vận hành"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Những chỉ số quan trọng giúp ưu tiên hành động kế tiếp."})]})]}),e.jsxs("ul",{className:"mt-6 space-y-4 text-sm text-slate-600",children:[e.jsxs("li",{className:"rounded-xl border border-slate-100 px-4 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-semibold text-slate-900",children:[ft(o.total_checkins)," lượt check-in đã ghi nhận"]}),e.jsx(va,{className:"h-4 w-4 text-emerald-500"})]}),e.jsx("p",{className:"mt-1 text-xs text-slate-500",children:"Đảm bảo quy trình check-in hoạt động trơn tru để không bỏ sót dữ liệu."})]}),e.jsxs("li",{className:"rounded-xl border border-slate-100 px-4 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-semibold text-slate-900",children:[Pe(R.totalPlatform)," phí nền tảng"]}),e.jsx(jr,{className:"h-4 w-4 text-emerald-500"})]}),e.jsx("p",{className:"mt-1 text-xs text-slate-500",children:"Theo dõi tỷ lệ phí để tối ưu các chương trình ưu đãi cho đối tác."})]}),e.jsxs("li",{className:"rounded-xl border border-slate-100 px-4 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-semibold text-slate-900",children:[D.length," booking cập nhật gần nhất"]}),e.jsx(Xa,{className:"h-4 w-4 text-emerald-500"})]}),e.jsx("p",{className:"mt-1 text-xs text-slate-500",children:"Hãy xem bảng hoạt động gần đây để đảm bảo không có booking bị bỏ lỡ."})]})]})]})]}),e.jsxs("section",{className:"rounded-2xl border border-slate-200 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 border-b border-slate-100 px-6 py-5",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Nhật ký booking chi tiết"}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Danh sách booking theo bộ lọc · Hiển thị ",f.length," /"," ",ft(o.total_records)," bản ghi"]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-slate-500",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-emerald-50 px-3 py-1 font-semibold text-emerald-600",children:[e.jsx(Ft,{className:"h-3 w-3"}),Pe(R.totalPrice)]}),e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-slate-100 px-3 py-1 font-semibold text-slate-600",children:[e.jsx(Us,{className:"h-3 w-3"}),Pe(R.totalNet)]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-100",children:[e.jsx("thead",{className:"bg-slate-50 text-xs uppercase tracking-wide text-slate-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Mã Đơn"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Sân"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Khách hàng"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Liên hệ"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"Tổng tiền"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"Phí nền"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"Net nhận"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Booking"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Thanh toán"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Check-in"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"QtyID"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Thời gian"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-100 text-sm text-slate-700",children:[f.map(y=>e.jsxs("tr",{className:"hover:bg-slate-50/80",children:[e.jsxs("td",{className:"px-4 py-3 font-semibold text-slate-900",children:["#",y.booking_code]}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-semibold text-slate-900",children:y.field_name||`Sân #${y.field_code}`}),e.jsxs("div",{className:"text-xs text-slate-500",children:["#",y.field_code]})]}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-semibold text-slate-900",children:y.customer_name||"Khách lẻ"}),e.jsxs("div",{className:"text-xs text-slate-500",children:["ID: ",y.customer_user_id??"Không có"]})]}),e.jsxs("td",{className:"px-4 py-3 text-xs text-slate-500",children:[e.jsx("div",{children:y.customer_email||"—"}),e.jsx("div",{children:y.customer_phone||"—"})]}),e.jsx("td",{className:"px-4 py-3 text-right font-semibold text-slate-900",children:Pe(y.total_price)}),e.jsx("td",{className:"px-4 py-3 text-right text-slate-600",children:Pe(y.platform_fee)}),e.jsx("td",{className:"px-4 py-3 text-right text-emerald-600 font-semibold",children:Pe(y.net_to_shop)}),e.jsx("td",{className:"px-4 py-3 text-xs font-semibold capitalize text-slate-600",children:y.booking_status||"—"}),e.jsx("td",{className:"px-4 py-3 text-xs font-semibold capitalize text-slate-600",children:y.payment_status||"—"}),e.jsx("td",{className:"px-4 py-3 text-xs text-slate-500",children:y.checkin_code||"—"}),e.jsx("td",{className:"px-4 py-3 text-xs text-slate-500",children:y.quantity_id??"—"}),e.jsx("td",{className:"px-4 py-3 text-xs text-slate-500",children:bs(y.create_at)})]},`booking-${y.booking_code}`)),!f.length&&e.jsx("tr",{children:e.jsx("td",{className:"px-4 py-10 text-center text-sm text-slate-500",colSpan:12,children:i?"Đang tải dữ liệu...":"Không có booking nào theo bộ lọc hiện tại."})})]})]})})]})]})},Bi=()=>{const[t,s]=n.useState([]),[a,r]=n.useState([]),[l,d]=n.useState(""),[c,f]=n.useState("all"),[j,o]=n.useState("all"),[x,i]=n.useState("name"),[m,b]=n.useState(null),[p,w]=n.useState(null);n.useEffect(()=>{let P=!1;return(async()=>{try{const[F,D]=await Promise.all([pn(),Ei()]);P||(s(F),r(D))}catch(F){console.error(F),P||(s([]),r([]))}})(),()=>{P=!0}},[]);const g=n.useMemo(()=>{const P=new Map;return a.forEach(F=>P.set(F.level_code,F.level_type)),P},[a]),_=n.useMemo(()=>[{label:"Tất cả",value:"all"}].concat(a.map(P=>({label:P.level_type.toUpperCase(),value:String(P.level_code)}))),[a]),k=n.useMemo(()=>{const P=t.length,F=t.filter(N=>!!N.isActive).length,D=P-F,G=a.reduce((N,q)=>(N[q.level_type]=t.filter(y=>y.level_code===q.level_code).length,N),{});return{total:P,active:F,inactive:D,byRole:G}},[t,a]),u=n.useMemo(()=>{const P=l.trim().toLowerCase();return t.filter(F=>{const D=!P||F.user_name.toLowerCase().includes(P)||F.email.toLowerCase().includes(P)||F.user_id.toLowerCase().includes(P),G=c==="all"||F.level_code===c,N=j==="all"||(j==="active"?F.isActive===1:F.isActive===0);return D&&G&&N})},[t,l,c,j]),M=n.useMemo(()=>{const P=[...u],F=(D,G)=>{if(x==="name")return D.user_name.localeCompare(G.user_name,"vi");if(x==="email")return D.email.localeCompare(G.email,"vi");if(x==="role"){const N=g.get(D.level_code)??"",q=g.get(G.level_code)??"";return N.localeCompare(q,"vi")}return D.user_code-G.user_code};return P.sort(F)},[u,x,g]);n.useEffect(()=>{b(P=>P&&M.some(F=>F.user_code===P.user_code)?M.find(F=>F.user_code===P.user_code)??null:M[0]??null)},[M]);const U=()=>{d(""),f("all"),o("all"),i("name")},J=P=>{const F=g.get(P.level_code)??"?",D=F==="admin"?"bg-emerald-100 text-emerald-700":F==="shop"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700";return e.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold uppercase ${D}`,children:F})},V=P=>{const F=!!P.isActive;return e.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold ${F?"bg-emerald-100 text-emerald-700":"bg-rose-100 text-rose-700"}`,children:F?"Đang hoạt động":"Đã khóa"})},R=async P=>{const F=P.isActive!==1;if(window.confirm(F?"Mở khóa tài khoản này?":"Khóa tài khoản này?")){w(P.user_code);try{const D=await Pi(P.user_code,F);s(G=>G.map(N=>N.user_code===D.user_code?D:N)),b(D)}catch(D){console.error(D),window.alert(D instanceof Error?D.message:"Không thể cập nhật trạng thái.")}finally{w(null)}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"shop-header",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"shop-title",children:"Users"}),e.jsx("p",{className:"shop-sub",children:"Quản lý người dùng hệ thống, vai trò và trạng thái hoạt động"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{value:l,onChange:P=>d(P.target.value),className:"input w-64",placeholder:"Tìm theo tên hoặc email"}),e.jsx("button",{type:"button",className:"btn-ghost",onClick:U,children:"Đặt lại"})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-value",children:k.total}),e.jsx("div",{className:"stat-label",children:"Tổng người dùng"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-value text-emerald-600",children:k.active}),e.jsx("div",{className:"stat-label",children:"Đang hoạt động"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-value text-rose-600",children:k.inactive}),e.jsx("div",{className:"stat-label",children:"Đã khóa"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-value text-sky-600",children:Object.entries(k.byRole).map(([P,F])=>`${P}: ${F}`).join(" • ")||"—"}),e.jsx("div",{className:"stat-label",children:"Phân bố theo vai trò"})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[minmax(0,1fr)_320px]",children:[e.jsxs("div",{className:"section space-y-4 overflow-hidden",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Role"}),e.jsx("select",{className:"input h-10 w-40",value:c,onChange:P=>f(P.target.value==="all"?"all":Number(P.target.value)||"all"),children:_.map(P=>e.jsx("option",{value:P.value,children:P.label},P.value))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Trạng thái"}),e.jsxs("select",{className:"input h-10 w-36",value:j,onChange:P=>o(P.target.value),children:[e.jsx("option",{value:"all",children:"Tất cả"}),e.jsx("option",{value:"active",children:"Đang hoạt động"}),e.jsx("option",{value:"inactive",children:"Đã khóa"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Sắp xếp"}),e.jsxs("select",{className:"input h-10 w-40",value:x,onChange:P=>i(P.target.value),children:[e.jsx("option",{value:"name",children:"Theo tên"}),e.jsx("option",{value:"email",children:"Theo email"}),e.jsx("option",{value:"role",children:"Theo vai trò"}),e.jsx("option",{value:"id",children:"Theo ID"})]})]})]}),e.jsx("div",{className:"overflow-x-auto w-full",children:e.jsxs("table",{className:"table min-w-[720px]",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"th text-left",children:"User"}),e.jsx("th",{className:"th text-left",children:"Email"}),e.jsx("th",{className:"th text-left",children:"Role"}),e.jsx("th",{className:"th text-left",children:"Trạng thái"}),e.jsx("th",{className:"th text-left",children:"Liên hệ"}),e.jsx("th",{className:"th text-left",children:"Mã"})]})}),e.jsxs("tbody",{children:[M.map(P=>{const F=m?.user_code===P.user_code;return e.jsxs("tr",{className:F?"bg-gray-50":void 0,onClick:()=>b(P),children:[e.jsx("td",{className:"td font-medium text-gray-900",children:P.user_name}),e.jsx("td",{className:"td text-gray-600",children:P.email}),e.jsx("td",{className:"td",children:J(P)}),e.jsx("td",{className:"td",children:V(P)}),e.jsxs("td",{className:"td text-sm text-gray-600",children:[e.jsx("div",{children:P.phone_number||"—"}),e.jsx("div",{className:"text-xs text-gray-500",children:P.email})]}),e.jsxs("td",{className:"td text-sm text-gray-500",children:["#",P.user_code]})]},P.user_code)}),M.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"td text-center text-gray-500",colSpan:5,children:"Không tìm thấy người dùng phù hợp."})})]})]})})]}),e.jsxs("aside",{className:"section space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Thông tin chi tiết"}),m?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Tên người dùng"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:m.user_name})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Tài khoản đăng nhập"}),e.jsx("p",{className:"text-sm font-medium text-gray-700",children:m.user_id})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Email"}),e.jsx("a",{href:`mailto:${m.email}`,className:"text-sm font-medium text-indigo-600 hover:underline",children:m.email})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Số điện thoại"}),e.jsx("p",{className:"text-sm font-medium text-gray-700",children:m.phone_number||"Chưa cập nhật"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Vai trò"}),J(m)]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Trạng thái"}),V(m)]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Mã hệ thống"}),e.jsxs("p",{className:"text-sm font-medium text-gray-700",children:["#",m.user_code]})]}),e.jsx("button",{type:"button",className:"btn-primary w-full",onClick:()=>window.open(`mailto:${m.email}?subject=Hỗ trợ từ Admin`,"_blank"),children:"Liên hệ qua email"}),e.jsx("button",{type:"button",className:m.isActive?"btn-danger w-full":"btn-primary w-full",onClick:()=>R(m),disabled:p===m.user_code,children:p===m.user_code?"Đang cập nhật...":m.isActive?"Khoá tài khoản":"Mở khoá tài khoản"})]}):e.jsx("p",{className:"text-sm text-gray-500",children:"Chọn một người dùng từ danh sách để xem chi tiết."})]})]})]})},Ri=()=>{const[t,s]=n.useState([]),[a,r]=n.useState(""),[l,d]=n.useState("all"),[c,f]=n.useState(null),[j,o]=n.useState(!0);n.useEffect(()=>{let b=!1;return(async()=>{o(!0);try{const p=await la();b||(s(p),f(p[0]??null))}catch(p){console.error(p),b||(s([]),f(null))}finally{b||o(!1)}})(),()=>{b=!0}},[]);const x=n.useMemo(()=>{const b=a.trim().toLowerCase();return t.filter(p=>{const w=p.isapproved===1||String(p.isapproved??"")==="1",g=l==="all"?!0:l==="approved"?w:!w,_=!b||p.shop_name.toLowerCase().includes(b)||p.address.toLowerCase().includes(b);return g&&_})},[t,a,l]),i=n.useMemo(()=>{const b=t.length,p=t.filter(g=>g.isapproved===1||String(g.isapproved??"")==="1").length,w=b-p;return{total:b,approved:p,pending:w}},[t]),m=b=>{const p=b.isapproved===1||String(b.isapproved??"")==="1",w=p?"bg-emerald-100 text-emerald-700":"bg-amber-100 text-amber-700";return e.jsx("span",{className:`inline-flex items-center gap-1 rounded-full px-2.5 py-0.5 text-xs font-semibold ${w}`,children:p?"Đang mở":"Đã khoá"})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"shop-header",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"shop-title",children:"Shops"}),e.jsx("p",{className:"shop-sub",children:"Danh sách shop và trạng thái duyệt trong hệ thống."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{value:a,onChange:b=>r(b.target.value),className:"input w-64",placeholder:"Tìm theo tên hoặc địa chỉ"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsxs("select",{value:l,onChange:b=>d(b.target.value),className:"input h-10 w-36",children:[e.jsx("option",{value:"all",children:"Tất cả"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"pending",children:"Pending"})]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-value",children:i.total}),e.jsx("div",{className:"stat-label",children:"Tổng số shop"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-value text-emerald-600",children:i.approved}),e.jsx("div",{className:"stat-label",children:"Đã duyệt"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-value text-amber-600",children:i.pending}),e.jsx("div",{className:"stat-label",children:"Chờ duyệt"})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[minmax(0,1fr)_320px]",children:[e.jsx("div",{className:"section space-y-4 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto w-full",children:e.jsxs("table",{className:"table min-w-[720px]",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"th",children:"ID"}),e.jsx("th",{className:"th",children:"Tên shop"}),e.jsx("th",{className:"th",children:"Địa chỉ"}),e.jsx("th",{className:"th",children:"Ngân hàng"}),e.jsx("th",{className:"th",children:"Trạng thái"})]})}),e.jsxs("tbody",{children:[x.map(b=>e.jsxs("tr",{className:c?.shop_code===b.shop_code?"bg-gray-50":void 0,onClick:()=>f(b),children:[e.jsxs("td",{className:"td font-medium text-gray-900",children:["#",b.shop_code]}),e.jsxs("td",{className:"td",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:b.shop_name}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Chủ sở hữu #",b.user_code]})]}),e.jsx("td",{className:"td text-sm text-gray-600",children:b.address}),e.jsxs("td",{className:"td text-sm text-gray-600",children:[b.bank_name||"—",b.bank_account_number&&` • ${b.bank_account_number}`]}),e.jsx("td",{className:"td",children:m(b)})]},b.shop_code)),!x.length&&e.jsx("tr",{children:e.jsx("td",{className:"td text-center text-gray-500",colSpan:6,children:"Không có shop phù hợp."})})]})]})})}),e.jsxs("aside",{className:"section space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Thông tin chi tiết"}),c?e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Tên shop"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:c.shop_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Địa chỉ"}),e.jsx("p",{children:c.address||"Chưa cập nhật"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Thông tin ngân hàng"}),e.jsxs("p",{children:[c.bank_name||"—",c.bank_account_number&&` • ${c.bank_account_number}`]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Trạng thái duyệt"}),m(c)]}),e.jsxs("button",{type:"button",className:"btn-outline flex w-full items-center justify-center gap-2",onClick:()=>window.open(`/shop?shop_code=${c.shop_code}`,"_blank"),children:[e.jsx(cr,{className:"h-4 w-4"}),"Xem trang shop"]})]}):e.jsx("p",{className:"text-sm text-gray-500",children:"Chọn một shop để xem chi tiết."})]})]}),j&&e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-500",children:[e.jsx("div",{className:"spinner"}),"Đang tải danh sách shop..."]})]})},Ki=()=>{const[t,s]=n.useState([]),[a,r]=n.useState("all"),[l,d]=n.useState(null),[c,f]=n.useState(!0),[j,o]=n.useState(null);n.useEffect(()=>{let p=!1;return(async()=>{f(!0);try{const w=await ia();p||(s(w),d(w[0]??null))}catch(w){console.error(w),p||(s([]),d(null))}finally{p||f(!1)}})(),()=>{p=!0}},[]);const x=n.useMemo(()=>{const p=t.length,w=t.filter(u=>u.status==="pending"||!u.status).length,g=t.filter(u=>u.status==="approved").length,_=t.filter(u=>u.status==="rejected").length,k=t.filter(u=>u.status==="reviewed").length;return{total:p,pending:w,approved:g,rejected:_,reviewed:k}},[t]),i=n.useMemo(()=>t.filter(p=>a==="all"?!0:p.status===a),[t,a]),m=async(p,w)=>{if(w!=="all"&&j===null){o(p.request_id);try{const g=await Li(p.request_id,w);s(_=>_.map(k=>k.request_id===g.request_id?g:k)),d(_=>_&&_.request_id===g.request_id?g:_)}catch(g){console.error(g),window.alert(g instanceof Error?g.message:"Không thể cập nhật trạng thái yêu cầu.")}finally{o(null)}}},b=p=>{p||(p="pending");const w="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold";return p==="approved"?e.jsx("span",{className:`${w} bg-emerald-100 text-emerald-700`,children:"Đang mở"}):p==="rejected"?e.jsx("span",{className:`${w} bg-rose-100 text-rose-700`,children:"Từ chối"}):p==="reviewed"?e.jsx("span",{className:`${w} bg-blue-100 text-blue-700`,children:"Đang xét"}):e.jsx("span",{className:`${w} bg-amber-100 text-amber-700`,children:"Đang chờ"})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"shop-header",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"shop-title",children:"Shop Requests"}),e.jsx("p",{className:"shop-sub",children:"Theo dõi và xử lý yêu cầu mở shop của người dùng."})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{type:"button",className:"btn-outline flex items-center gap-2",onClick:()=>window.location.reload(),children:[e.jsx(bt,{className:"h-4 w-4"}),"Tải lại"]})})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-5",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-value",children:x.total}),e.jsx("div",{className:"stat-label",children:"Tổng yêu cầu"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-value text-amber-600",children:x.pending}),e.jsx("div",{className:"stat-label",children:"Chờ xử lý"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-value text-blue-600",children:x.reviewed}),e.jsx("div",{className:"stat-label",children:"Đang xem xét"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-value text-emerald-600",children:x.approved}),e.jsx("div",{className:"stat-label",children:"Đã duyệt"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-value text-rose-600",children:x.rejected}),e.jsx("div",{className:"stat-label",children:"Từ chối"})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[minmax(0,1fr)_320px]",children:[e.jsxs("div",{className:"section space-y-4 overflow-hidden",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-600",children:[e.jsx(vs,{className:"h-4 w-4"}),"Trạng thái"]}),e.jsxs("select",{value:a,onChange:p=>r(p.target.value),className:"input h-10 w-48",children:[e.jsx("option",{value:"all",children:"Tất cả"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"reviewed",children:"Reviewed"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"})]})]}),e.jsx("div",{className:"overflow-x-auto w-full",children:e.jsxs("table",{className:"table min-w-[720px]",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"th",children:"ID"}),e.jsx("th",{className:"th",children:"Thông tin"}),e.jsx("th",{className:"th",children:"Ngày tạo"}),e.jsx("th",{className:"th",children:"Trạng thái"}),e.jsx("th",{className:"th",children:"Tùy chọn"})]})}),e.jsxs("tbody",{children:[i.map(p=>e.jsxs("tr",{className:l?.request_id===p.request_id?"bg-gray-50":void 0,onClick:()=>d(p),children:[e.jsxs("td",{className:"td font-semibold text-gray-900",children:["#",p.request_id]}),e.jsxs("td",{className:"td",children:[e.jsx("div",{className:"font-medium text-gray-900",children:p.full_name}),e.jsx("div",{className:"text-xs text-gray-500",children:p.email}),e.jsx("div",{className:"text-xs text-gray-500",children:p.phone_number})]}),e.jsx("td",{className:"td text-sm text-gray-600",children:p.created_at?new Date(p.created_at).toLocaleString("vi-VN"):"—"}),e.jsx("td",{className:"td",children:b(p.status)}),e.jsx("td",{className:"td",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{type:"button",className:"btn-primary flex items-center gap-1 disabled:opacity-60 disabled:cursor-not-allowed",disabled:j===p.request_id,onClick:w=>{w.stopPropagation(),m(p,"approved")},children:[e.jsx(nt,{className:"h-4 w-4"}),"Duyệt"]}),e.jsxs("button",{type:"button",className:"btn-outline flex items-center gap-1 text-rose-600 border-rose-200 hover:bg-rose-50 disabled:opacity-60 disabled:cursor-not-allowed",disabled:j===p.request_id,onClick:w=>{w.stopPropagation(),m(p,"rejected")},children:[e.jsx(tr,{className:"h-4 w-4"}),"Từ chối"]})]})})]},p.request_id)),!i.length&&e.jsx("tr",{children:e.jsx("td",{className:"td text-center text-gray-500",colSpan:5,children:"Không có yêu cầu phù hợp."})})]})]})})]}),e.jsxs("aside",{className:"section space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Chi tiết yêu cầu"}),l?e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Họ tên"}),e.jsx("p",{className:"font-semibold text-gray-900",children:l.full_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Thông tin liên hệ"}),e.jsx("p",{children:l.email}),e.jsx("p",{children:l.phone_number})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Địa chỉ"}),e.jsx("p",{children:l.address||"Chưa cập nhật"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Thông điệp"}),e.jsx("p",{className:"text-gray-700",children:l.message||"Không có"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Trạng thái"}),b(l.status)]}),e.jsxs("button",{type:"button",className:"btn-outline flex w-full items-center justify-center gap-2",onClick:()=>window.open(`mailto:${l.email}`,"_blank"),children:[e.jsx(qt,{className:"h-4 w-4"}),"Liên hệ qua email"]})]}):e.jsx("p",{className:"text-sm text-gray-500",children:"Chọn một yêu cầu để xem chi tiết."})]})]}),c&&e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-500",children:[e.jsx("div",{className:"spinner"}),"Đang tải yêu cầu..."]})]})},Vi=t=>`T${t}`,Oi=()=>{const[t,s]=n.useState([]),[a,r]=n.useState([]),[l,d]=n.useState([]),[c,f]=n.useState([]),[j,o]=n.useState(!0),[x,i]=n.useState("");n.useEffect(()=>{let g=!1;return(async()=>{o(!0),i("");try{const[_,k,u,M]=await Promise.all([pn(),la(),ia(),fn(new Date().getFullYear()).catch(()=>[])]);if(g)return;s(_),r(k),d(u),f(M??[])}catch(_){console.error(_),g||i(_ instanceof Error?_.message:"Không thể tải dữ liệu insights.")}finally{g||o(!1)}})(),()=>{g=!0}},[]);const m=n.useMemo(()=>{const g=t.length,_=t.filter(V=>V.level_code===3).length,k=t.filter(V=>V.isActive===1).length,u=a.length,M=a.filter(V=>String(V.isapproved??"")==="1"||V.isapproved===1).length,U=l.filter(V=>V.status==="pending"||!V.status).length,J=l.length>0?Math.round(l.filter(V=>V.status==="approved").length/l.length*100):0;return{totalUsers:g,activeUsers:k,totalAdmins:_,totalShops:u,approvedShops:M,pendingRequests:U,approvalRate:J}},[t,a,l]),b=n.useMemo(()=>{const g=l.reduce((k,u)=>{const M=u.status||"pending";return k[M]=(k[M]??0)+1,k},{});return["pending","reviewed","approved","rejected"].map(k=>({status:k,value:g[k]??0}))},[l]),p=n.useMemo(()=>c.length?c.sort((g,_)=>g.Month-_.Month).map(g=>({month:Vi(g.Month),income:g.total_income,expense:g.total_expense,balance:g.Balance})):[],[c]),w=n.useMemo(()=>[...a].sort((g,_)=>{const k=g.shop_name?.toLowerCase()??"",u=_.shop_name?.toLowerCase()??"";return k.localeCompare(u,"vi")}).slice(0,6),[a]);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"shop-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"shop-title",children:"Insights"}),e.jsx("p",{className:"shop-sub",children:"Bức tranh tổng quan về người dùng, shop và yêu cầu đăng ký trong hệ thống."})]})}),x&&e.jsx("div",{className:"rounded-lg border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700",children:x}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(_s,{size:18})}),e.jsx("div",{className:"stat-value",children:m.totalUsers}),e.jsx("div",{className:"stat-label",children:"Tổng người dùng"}),e.jsxs("div",{className:"stat-sub",children:[m.activeUsers," đang hoạt động •"," ",m.totalAdmins," admin"]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(Za,{size:18})}),e.jsx("div",{className:"stat-value",children:m.totalShops}),e.jsx("div",{className:"stat-label",children:"Shop đã tạo"}),e.jsxs("div",{className:"stat-sub",children:[m.approvedShops," shop đã duyệt (",Math.round(m.approvedShops===0?0:m.approvedShops/Math.max(m.totalShops,1)*100),"%)"]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(Zn,{size:18})}),e.jsx("div",{className:"stat-value",children:m.pendingRequests}),e.jsx("div",{className:"stat-label",children:"Yêu cầu chờ xử lý"}),e.jsxs("div",{className:"stat-sub",children:["Tỉ lệ duyệt: ",m.approvalRate,"%"]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(It,{size:18})}),e.jsx("div",{className:"stat-value",children:p.length?p.reduce((g,_)=>g+_.balance,0).toLocaleString("vi-VN"):"—"}),e.jsx("div",{className:"stat-label",children:"Tổng lợi nhuận năm"}),e.jsx("div",{className:"stat-sub",children:"Dữ liệu doanh thu toàn hệ thống"})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[minmax(0,1fr)_minmax(0,1fr)]",children:[e.jsxs("div",{className:"section",children:[e.jsx("div",{className:"section-header",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Phân bố yêu cầu mở shop"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Tổng hợp trạng thái xử lý yêu cầu trong toàn hệ thống"})]})}),e.jsx("div",{className:"h-72",children:e.jsx(da,{children:e.jsxs(Mn,{data:b,children:[e.jsx(ha,{strokeDasharray:"3 3"}),e.jsx(ma,{dataKey:"status"}),e.jsx(xa,{allowDecimals:!1}),e.jsx(ua,{}),e.jsx(Pn,{dataKey:"value",fill:"#10b981"})]})})})]}),e.jsxs("div",{className:"section",children:[e.jsx("div",{className:"section-header",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Diễn biến doanh thu"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Thu/chi và lợi nhuận theo tháng trong năm hiện tại"})]})}),e.jsx("div",{className:"h-72",children:p.length?e.jsx(da,{children:e.jsxs(Ln,{data:p,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"income",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#34d399",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#34d399",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"expense",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#f87171",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#f87171",stopOpacity:0})]})]}),e.jsx(ha,{strokeDasharray:"3 3"}),e.jsx(ma,{dataKey:"month"}),e.jsx(xa,{tickFormatter:g=>`${Math.round(g/1e6)}tr`}),e.jsx(ua,{}),e.jsx(An,{}),e.jsx(Es,{type:"monotone",dataKey:"income",name:"Thu",stroke:"#10b981",fill:"url(#income)"}),e.jsx(Es,{type:"monotone",dataKey:"expense",name:"Chi",stroke:"#f97316",fill:"url(#expense)"}),e.jsx(Es,{type:"monotone",dataKey:"balance",name:"Lợi nhuận",stroke:"#6366f1",fillOpacity:0})]})}):e.jsx("div",{className:"flex h-full items-center justify-center text-sm text-gray-500",children:"Chưa có dữ liệu doanh thu cho năm hiện tại."})})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[minmax(0,1fr)_minmax(0,1fr)]",children:[e.jsxs("div",{className:"section",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Shop nổi bật"}),e.jsxs("div",{className:"divide-y divide-gray-100",children:[w.map(g=>e.jsxs("div",{className:"py-3 flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-gray-100 text-gray-700 font-semibold",children:g.shop_name?.charAt(0).toUpperCase()??"S"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900 truncate",children:g.shop_name}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:g.address})]}),e.jsx("span",{className:`inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-xs font-semibold ${g.isapproved?"bg-emerald-100 text-emerald-700":"bg-amber-100 text-amber-700"}`,children:g.isapproved?e.jsxs(e.Fragment,{children:[e.jsx(nt,{className:"h-3.5 w-3.5"}),"Đã duyệt"]}):e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"h-3.5 w-3.5"}),"Đang khoá"]})})]},g.shop_code)),!w.length&&e.jsx("div",{className:"py-6 text-center text-sm text-gray-500",children:"Chưa có shop nào được tạo."})]})]}),e.jsxs("div",{className:"section",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Tiến trình yêu cầu"}),e.jsxs("div",{className:"space-y-4",children:[l.slice(0,6).map(g=>e.jsxs("div",{className:"rounded-lg border border-gray-100 bg-gray-50 px-3 py-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("p",{className:"font-semibold text-gray-900",children:["#",g.request_id," • ",g.full_name]}),e.jsx("span",{className:`text-xs font-medium uppercase ${g.status==="approved"?"text-emerald-600":g.status==="rejected"?"text-rose-600":"text-amber-600"}`,children:g.status??"pending"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:g.address})]},g.request_id)),!l.length&&e.jsx("div",{className:"py-6 text-center text-sm text-gray-500",children:"Chưa có yêu cầu nào."})]})]})]}),j&&e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-500",children:[e.jsx("div",{className:"spinner"}),"Đang tải dữ liệu insights..."]})]})},Oa={approved:"Đã chi",pending:"Đang duyệt",rejected:"Từ chối",reviewed:"Đang xem xét"},zi=()=>{const[t,s]=n.useState([]),[a,r]=n.useState([]),[l,d]=n.useState([]),[c,f]=n.useState("all"),[j,o]=n.useState(!0);n.useEffect(()=>{let b=!1;return(async()=>{o(!0);try{const[p,w,g]=await Promise.all([ia(),la(),fn(new Date().getFullYear()).catch(()=>[])]);b||(s(p),r(w),d(g??[]))}catch(p){console.error(p),b||(s([]),r([]),d([]))}finally{b||o(!1)}})(),()=>{b=!0}},[]);const x=n.useMemo(()=>{const b=l.reduce((g,_)=>g+(_.Balance??0),0),p=t.filter(g=>g.status==="approved").length,w=t.filter(g=>g.status==="pending").length;return{totalRevenue:b,approved:p,pending:w,averagePerShop:a.length?b/a.length:0}},[l,t,a]),i=n.useMemo(()=>t.map(p=>{const w=p.status??"pending",_=(x.averagePerShop>0?x.averagePerShop:35e4)+(p.request_id%4-2)*55e3+Math.max(0,p.request_id%6*12e3);return{id:p.request_id,shopName:p.full_name||p.address||"—",requestedAt:p.created_at,status:w,amount:Math.max(12e4,Math.round(_)),account:p.email,note:p.message}}).filter(p=>c==="all"?!0:p.status===c).sort((p,w)=>(w.requestedAt??"").localeCompare(p.requestedAt??"")),[t,c,x.averagePerShop]),m=()=>{const b=["ID","Shop","Ngày yêu cầu","Trạng thái","Số tiền"],p=i.map(u=>[u.id,u.shopName,u.requestedAt,Oa[u.status]??u.status,u.amount.toLocaleString("vi-VN")]),w=[b,...p].map(u=>u.join(",")).join(`
`),g=new Blob([w],{type:"text/csv;charset=utf-8;"}),_=URL.createObjectURL(g),k=document.createElement("a");k.href=_,k.setAttribute("download","transactions.csv"),document.body.appendChild(k),k.click(),k.parentNode?.removeChild(k),URL.revokeObjectURL(_)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"shop-header",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"shop-title",children:"Transactions"}),e.jsx("p",{className:"shop-sub",children:"Theo dõi số liệu chi trả cho shop, yêu cầu rút tiền và trạng thái xử lý."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{type:"button",className:"btn-outline flex items-center gap-2",onClick:()=>window.location.reload(),children:[e.jsx(bt,{className:"h-4 w-4"}),"Tải lại"]}),e.jsxs("button",{type:"button",className:"btn-primary flex items-center gap-2",onClick:m,children:[e.jsx(lr,{className:"h-4 w-4"}),"Xuất CSV"]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(Mr,{size:18})}),e.jsx("div",{className:"stat-value",children:x.totalRevenue?x.totalRevenue.toLocaleString("vi-VN"):"—"}),e.jsx("div",{className:"stat-label",children:"Tổng lợi nhuận năm"}),e.jsxs("div",{className:"stat-sub",children:["Trung bình mỗi shop:"," ",x.averagePerShop?x.averagePerShop.toLocaleString("vi-VN"):"—","₫"]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:e.jsx($t,{size:18})}),e.jsx("div",{className:"stat-value",children:x.approved}),e.jsx("div",{className:"stat-label",children:"Giao dịch đã chi"}),e.jsx("div",{className:"stat-sub",children:"Yêu cầu đã hoàn tất"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(vs,{size:18})}),e.jsx("div",{className:"stat-value",children:x.pending}),e.jsx("div",{className:"stat-label",children:"Đang chờ xử lý"}),e.jsx("div",{className:"stat-sub",children:"Ưu tiên xử lý trong 24h tới"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(bt,{size:18})}),e.jsx("div",{className:"stat-value",children:i.length}),e.jsx("div",{className:"stat-label",children:"Giao dịch hiển thị"}),e.jsx("div",{className:"stat-sub",children:"Theo bộ lọc hiện tại"})]})]}),e.jsxs("div",{className:"section space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Danh sách giao dịch"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Dữ liệu dựa trên yêu cầu mở shop và giả lập chi trả hiện tại."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Trạng thái"}),e.jsxs("select",{className:"input h-10 w-40",value:c,onChange:b=>f(b.target.value),children:[e.jsx("option",{value:"all",children:"Tất cả"}),e.jsx("option",{value:"approved",children:"Đã chi"}),e.jsx("option",{value:"pending",children:"Đang duyệt"}),e.jsx("option",{value:"reviewed",children:"Đang xem xét"}),e.jsx("option",{value:"rejected",children:"Từ chối"})]})]})]}),e.jsx("div",{className:"overflow-x-auto w-full",children:e.jsxs("table",{className:"table min-w-[780px]",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"th",children:"ID"}),e.jsx("th",{className:"th",children:"Shop / Người yêu cầu"}),e.jsx("th",{className:"th",children:"Ngày tạo"}),e.jsx("th",{className:"th",children:"Trạng thái"}),e.jsx("th",{className:"th",children:"Số tiền (ước tính)"}),e.jsx("th",{className:"th",children:"Ghi chú"})]})}),e.jsxs("tbody",{children:[i.map(b=>e.jsxs("tr",{children:[e.jsxs("td",{className:"td font-medium text-gray-900",children:["#",b.id]}),e.jsxs("td",{className:"td",children:[e.jsx("p",{className:"font-medium text-gray-900",children:b.shopName}),e.jsx("p",{className:"text-xs text-gray-500",children:b.account})]}),e.jsx("td",{className:"td text-sm text-gray-600",children:b.requestedAt?new Date(b.requestedAt).toLocaleString("vi-VN"):"—"}),e.jsx("td",{className:"td",children:e.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold ${b.status==="approved"?"bg-emerald-100 text-emerald-700":b.status==="rejected"?"bg-rose-100 text-rose-700":"bg-amber-100 text-amber-700"}`,children:Oa[b.status]??b.status})}),e.jsxs("td",{className:"td text-sm font-semibold text-gray-900",children:[b.amount.toLocaleString("vi-VN"),"₫"]}),e.jsx("td",{className:"td text-sm text-gray-600",children:b.note||"—"})]},b.id)),!i.length&&e.jsx("tr",{children:e.jsx("td",{className:"td text-center text-gray-500",colSpan:6,children:"Không có giao dịch phù hợp."})})]})]})})]}),j&&e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-500",children:[e.jsx("div",{className:"spinner"}),"Đang tải dữ liệu giao dịch..."]})]})},za={requested:"Yêu cầu",processing:"Đang xử lý",paid:"Đã thanh toán",rejected:"Từ chối"},Hi={requested:"bg-yellow-100 text-yellow-800",processing:"bg-blue-100 text-blue-800",paid:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800"},Ui=()=>{const[t,s]=n.useState([]),[a,r]=n.useState(!0),[l,d]=n.useState("all"),[c,f]=n.useState(null);n.useEffect(()=>{let i=!1;return(async()=>{r(!0);try{const m=await ps(l==="all"?void 0:l,void 0,100);i||s(m.data?.data||[])}catch(m){console.error("Error fetching payouts:",m),i||s([])}finally{i||r(!1)}})(),()=>{i=!0}},[l]);const j=n.useMemo(()=>({total:t.length,requested:t.filter(i=>i.Status==="requested").length,processing:t.filter(i=>i.Status==="processing").length,paid:t.filter(i=>i.Status==="paid").length,rejected:t.filter(i=>i.Status==="rejected").length,totalAmount:t.reduce((i,m)=>i+m.Amount,0)}),[t]),o=async i=>{f(i);try{await Ai(i);const m=await ps(l==="all"?void 0:l);s(m.data?.data||[])}catch(m){if(m.message?.includes("UpdateAt")||m.message?.includes("Unknown column")){console.warn("Update error detected, checking if approval actually went through...");try{const b=await ps(l==="all"?void 0:l);if(s(b.data?.data||[]),b.data?.data?.find(w=>w.PayoutID===i)?.Status==="paid"){alert("✅ Yêu cầu rút tiền đã được duyệt (lỗi timestamp là không quan trọng)");return}}catch(b){console.error("Error refreshing list:",b)}}alert("Lỗi duyệt yêu cầu: "+m.message)}finally{f(null)}},x=async i=>{const m=prompt("Nhập lý do từ chối:");if(m){f(i);try{await Di(i,{reason:m});const b=await ps(l==="all"?void 0:l);s(b.data?.data||[])}catch(b){alert("Lỗi từ chối yêu cầu: "+b.message)}finally{f(null)}}};return e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"💰 Yêu Cầu Rút Tiền"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Quản lý các yêu cầu rút tiền từ shop"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow border-l-4 border-blue-500",children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:"Tổng cộng"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800 mt-1",children:j.total})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow border-l-4 border-yellow-500",children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:"Yêu cầu mới"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600 mt-1",children:j.requested})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow border-l-4 border-blue-500",children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:"Đang xử lý"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600 mt-1",children:j.processing})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow border-l-4 border-green-500",children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:"Đã thanh toán"}),e.jsx("p",{className:"text-2xl font-bold text-green-600 mt-1",children:j.paid})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow border-l-4 border-red-500",children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:"Tổng tiền"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800 mt-1",children:[new Intl.NumberFormat("vi-VN").format(j.totalAmount),"đ"]})]})]}),e.jsx("div",{className:"flex gap-2",children:["all","requested","processing","paid","rejected"].map(i=>e.jsx("button",{onClick:()=>d(i),className:`px-4 py-2 rounded-lg font-medium transition ${l===i?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:i==="all"?"Tất cả":za[i]},i))}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:a?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx(es,{className:"w-8 h-8 animate-spin text-blue-600"})}):t.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(Ce,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Không có yêu cầu rút tiền"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gradient-to-r from-blue-50 to-blue-100 border-b-2 border-blue-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Mã Yêu Cầu"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Shop"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Thông Tin Ngân Hàng"}),e.jsx("th",{className:"px-6 py-3 text-right text-sm font-semibold text-gray-700",children:"Số Tiền"}),e.jsx("th",{className:"px-6 py-3 text-center text-sm font-semibold text-gray-700",children:"Trạng Thái"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Ngày Yêu Cầu"}),e.jsx("th",{className:"px-6 py-3 text-center text-sm font-semibold text-gray-700",children:"Hành Động"})]})}),e.jsx("tbody",{children:t.map(i=>e.jsxs("tr",{className:"border-b border-gray-200 hover:bg-blue-50 transition",children:[e.jsxs("td",{className:"px-6 py-4 font-mono text-sm font-semibold text-blue-600",children:["#",i.PayoutID]}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"font-medium text-gray-800",children:i.ShopName}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Shop #",i.ShopCode]})]}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsxs("div",{className:"bg-blue-50 rounded p-2 space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Ngân hàng:"})," ",i.BankName]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Số TK:"})," ",i.AccountNumber]})]})}),e.jsxs("td",{className:"px-6 py-4 text-right font-semibold text-gray-800",children:[new Intl.NumberFormat("vi-VN").format(i.Amount),"đ"]}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${Hi[i.Status]}`,children:za[i.Status]})}),e.jsxs("td",{className:"px-6 py-4 text-sm text-gray-600",children:[new Date(i.RequestedAt).toLocaleDateString("vi-VN")," ",new Date(i.RequestedAt).toLocaleTimeString("vi-VN")]}),e.jsxs("td",{className:"px-6 py-4 text-center",children:[i.Status==="requested"&&e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx("button",{onClick:()=>o(i.PayoutID),disabled:c===i.PayoutID,className:"p-2 bg-green-100 text-green-600 hover:bg-green-200 rounded transition disabled:opacity-50",title:"Duyệt",children:e.jsx(Ya,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>x(i.PayoutID),disabled:c===i.PayoutID,className:"p-2 bg-red-100 text-red-600 hover:bg-red-200 rounded transition disabled:opacity-50",title:"Từ chối",children:e.jsx(as,{className:"w-4 h-4"})})]}),i.Status==="processing"&&e.jsx(Se,{className:"w-5 h-5 text-blue-600 mx-auto"}),i.Status==="paid"&&e.jsx(ta,{className:"w-5 h-5 text-green-600 mx-auto"}),i.Status==="rejected"&&e.jsx(Ce,{className:"w-5 h-5 text-red-600 mx-auto"})]})]},i.PayoutID))})]})})})]})},Gi=async(t,s="ewallet")=>(await H.post(`/payments/bookings/${t}/initiate`,{payment_method:s})).data,Js=async t=>(await H.get(`/payments/bookings/${t}/status`)).data,ea=t=>{if(t==null)return"pending";const s=String(t).trim().toLowerCase();return["paid","success","completed"].includes(s)?"paid":["failed","failure","error","cancelled","canceled"].includes(s)?"failed":["refunded","refund"].includes(s)?"refunded":"pending"},Qi=({bookingCode:t,enabled:s=!0,interval:a=2e3,onSuccess:r,onError:l,timeout:d=9e5})=>{const[c,f]=n.useState("pending"),[j,o]=n.useState(!1),[x,i]=n.useState(null),m=n.useRef(null),b=n.useRef(null),p=n.useRef(null),w=n.useRef(r),g=n.useRef(l);n.useEffect(()=>{w.current=r},[r]),n.useEffect(()=>{g.current=l},[l]);const _=n.useCallback(async()=>{if(s){if(p.current&&Date.now()-p.current>d){const k="Timeout: Thanh toán chưa hoàn tất sau 15 phút. Vui lòng thử lại.";i(k);const u=g.current;u&&u(k),m.current&&(clearInterval(m.current),m.current=null);return}try{o(!0);const k=await Js(t);if(k.success&&k.data){const u=ea(k.data.status);f(u),i(null);const M=w.current;M&&M(u),(u==="paid"||u==="failed"||u==="refunded")&&(m.current&&(clearInterval(m.current),m.current=null),b.current&&(clearTimeout(b.current),b.current=null))}}catch(k){const u=ht(k,"Failed to check payment status");i(u);const M=g.current;M&&M(u)}finally{o(!1)}}},[t,s,d]);return n.useEffect(()=>{if(s)return p.current=Date.now(),_(),m.current=setInterval(_,a),b.current=setTimeout(()=>{const k="Timeout: Thanh toán chưa hoàn tất sau 15 phút. Vui lòng thử lại.";i(k);const u=g.current;u&&u(k),m.current&&(clearInterval(m.current),m.current=null)},d),()=>{m.current&&clearInterval(m.current),b.current&&clearTimeout(b.current)}},[s,a,_,d]),{status:c,loading:j,error:x,isPaid:c==="paid",isFailed:c==="failed",isRefunded:c==="refunded",isPending:c==="pending"}},Xi=()=>{const{bookingCode:t}=Kt(),s=We(),a=ys(),r=n.useMemo(()=>a.state||{},[a.state]),[l,d]=n.useState({loading:!r.qrCode,initiating:!1,error:null,qrCode:r.qrCode||null,momoUrl:null,amount:r.amount||null,paymentID:r.paymentID||null,expiresIn:900,bookingId:null,pollInterval:4e3,pollingEnabled:!1,checkCooldown:0}),c=Qi({bookingCode:t||"",enabled:!!t&&!l.error&&!!l.paymentID&&l.pollingEnabled,interval:l.pollInterval,onSuccess:x=>{x==="paid"?(d(i=>({...i,initiating:!1})),setTimeout(()=>{s(`/payment/${t}`)},1e3)):x==="failed"&&d(i=>({...i,error:"Thanh toán thất bại. Vui lòng thử lại."}))},onError:x=>{d(i=>({...i,error:x}))}});n.useEffect(()=>{if(r.qrCode&&r.paymentID&&r.amount)return;(async()=>{if(t)try{d(m=>({...m,loading:!0,error:null}));const i=await Gi(t,"bank_transfer");if(i.success&&i.data){const m=i.data,b=m.qr_code||null,p=m.amount||null,w=m.paymentID||null,g=typeof m.bookingId=="number"?m.bookingId:null;if(!p||!w){d(_=>({..._,error:"Invalid payment response format. Check backend implementation.",loading:!1}));return}d(_=>({..._,qrCode:b,amount:p,paymentID:w,expiresIn:m.expiresIn||900,bookingId:g,loading:!1}))}}catch(i){const p=i?.response?.status===404?"Không tìm thấy booking. Vui lòng tạo booking trước.":"Failed to initiate payment",w=ht(i,p);d(g=>({...g,error:w,loading:!1}))}})()},[t,r]),n.useEffect(()=>{if(c.error&&l.pollInterval<1e4){const x=setTimeout(()=>{d(i=>({...i,pollInterval:Math.min(i.pollInterval+1e3,1e4)}))},2e3);return()=>clearTimeout(x)}},[c.error,l.pollInterval]),n.useEffect(()=>{if(l.checkCooldown<=0)return;const x=setTimeout(()=>{d(i=>({...i,checkCooldown:Math.max(i.checkCooldown-1,0)}))},1e3);return()=>clearTimeout(x)},[l.checkCooldown]),n.useEffect(()=>{if(!l.pollingEnabled||!t)return;const x=setInterval(async()=>{try{const i=await Js(t);if(i.success&&i.data){const m=ea(i.data.status);m==="paid"?(clearInterval(x),d(b=>({...b,pollingEnabled:!1})),setTimeout(()=>{s(`/payment/${t}`)},1e3)):m==="failed"&&(clearInterval(x),d(b=>({...b,error:"Thanh toán thất bại. Vui lòng thử lại.",pollingEnabled:!1})))}}catch(i){console.error("Polling error:",i)}},2e3);return()=>clearInterval(x)},[l.pollingEnabled,t,s]);const f=()=>{d(x=>({...x,error:null,pollInterval:4e3,pollingEnabled:!0}))},j=async()=>{if(t)try{d(i=>({...i,initiating:!0,error:null}));const x=await Js(t);if(x.success&&x.data){const i=ea(x.data.status);i==="paid"?(d(m=>({...m,initiating:!1})),setTimeout(()=>{s(`/payment/${t}`)},1e3)):d(i==="failed"?m=>({...m,error:"Thanh toán thất bại. Vui lòng thử lại.",initiating:!1}):m=>({...m,pollingEnabled:!0,initiating:!1,checkCooldown:5}))}}catch(x){const i=ht(x,"Không thể xác nhận thanh toán");d(m=>({...m,error:i,initiating:!1}))}},o=()=>l.qrCode?l.qrCode:`https://qr.sepay.vn/img?${new URLSearchParams({acc:"96247THUERE",bank:"BIDV",...l.amount?{amount:String(l.amount)}:{},des:`BK${t}`}).toString()}`;return l.loading&&!l.qrCode?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(es,{className:"w-16 h-16 text-blue-500 animate-spin"})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-12 px-4",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Thanh Toán Đặt Sân"}),e.jsxs("p",{className:"text-gray-600",children:["Booking: ",t]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8 mb-6",children:[l.amount&&e.jsxs("div",{className:"text-center mb-6 pb-6 border-b",children:[e.jsx("p",{className:"text-gray-600 text-sm mb-1",children:"Số Tiền Thanh Toán"}),e.jsxs("p",{className:"text-4xl font-bold text-blue-600",children:[l.amount.toLocaleString("vi-VN"),"₫"]})]}),!c.isPaid&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"rounded-lg border border-gray-200 bg-gray-50 px-4 py-3",children:e.jsx("p",{className:"text-sm text-gray-700",children:"Vui lòng chuyển khoản theo hướng dẫn bên dưới. Hệ thống sẽ tự động khớp khi nội dung chính xác."})}),(l.qrCode||!0)&&e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("p",{className:"text-sm font-medium mb-3",children:"Quét mã QR SePay"}),e.jsx("div",{className:"flex justify-center",children:(()=>{const x=o();return e.jsx("img",{src:x,alt:"SePay QR",className:"w-64 h-64 object-contain"})})()})]}),e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[e.jsxs("div",{className:"rounded-lg border px-4 py-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Nội dung chuyển khoản"}),e.jsx("p",{className:"mt-1 font-mono font-semibold",children:`BK${t}`})]}),e.jsxs("div",{className:"rounded-lg border px-4 py-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Số tiền"}),e.jsxs("p",{className:"mt-1 font-semibold",children:[l.amount?.toLocaleString("vi-VN"),"₫"]})]})]}),e.jsxs("div",{className:"rounded-lg border px-4 py-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Tài khoản nhận"}),e.jsxs("div",{className:"mt-1 text-sm text-gray-900",children:[e.jsx("p",{children:"Người nhận: Do Thanh Dat"}),e.jsx("p",{children:"Ngân hàng: BIDV"}),e.jsx("p",{children:"Số tài khoản: 6353897509"}),e.jsx("p",{children:"Chi nhánh: TP.HCM"})]})]})]}),l.error&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:[e.jsx("p",{className:"text-red-800 font-semibold",children:"Lỗi"}),e.jsx("p",{className:"text-red-600 text-sm",children:l.error})]}),c.error&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:[e.jsx("p",{className:"text-red-800 font-semibold",children:"Lỗi Xác Minh"}),e.jsx("p",{className:"text-red-600 text-sm",children:c.error})]}),e.jsxs("div",{className:"space-y-3",children:[c.isPending&&e.jsx("button",{onClick:j,disabled:l.checkCooldown>0||l.initiating,className:"w-full bg-blue-500 hover:bg-blue-600 disabled:bg-gray-400 text-white font-bold py-3 px-4 rounded-lg transition flex items-center justify-center",children:l.initiating?e.jsxs(e.Fragment,{children:[e.jsx(es,{className:"mr-2 h-4 w-4 animate-spin"}),"Đang xử lý..."]}):l.checkCooldown>0?`${l.checkCooldown}s`:"Xác Nhận Đã Chuyển Tiền"}),c.isPaid&&e.jsx("button",{onClick:()=>s(`/payment/${t}`),className:"w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition",children:"Xem Kết Quả Thanh Toán"}),c.isFailed&&e.jsxs("button",{onClick:f,disabled:c.loading,className:"w-full bg-yellow-500 hover:bg-yellow-600 disabled:bg-gray-400 text-white font-bold py-3 px-4 rounded-lg transition flex items-center justify-center",children:[e.jsx(Os,{className:"mr-2 h-4 w-4"}),"Thử Lại"]}),c.isPending&&l.pollingEnabled&&e.jsxs("button",{onClick:()=>{alert("Vui lòng liên hệ với chúng tôi để được hỗ trợ. Số điện thoại: 0866 845 867")},className:"w-full bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition text-sm flex items-center justify-center",children:[e.jsx(rs,{className:"mr-2 h-4 w-4"}),"Liên Hệ Hỗ Trợ"]})]}),l.expiresIn&&!c.isPaid&&e.jsxs("p",{className:"text-center text-gray-500 text-sm mt-4",children:["Vui lòng hoàn tất chuyển khoản trong"," ",Math.ceil(l.expiresIn/60)," phút"]})]})]})})},Yi=t=>typeof t!="number"?"-":new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",minimumFractionDigits:0}).format(t),Zi=t=>{const s=t.PlayDate||t.playDate||"",a=t.StartTime||t.startTime||"",r=t.EndTime||t.endTime||"";return{playDate:s,startTime:a,endTime:r}},Wi=()=>{const{bookingCode:t}=Kt(),s=We(),[a,r]=n.useState(!0),[l,d]=n.useState(null),[c,f]=n.useState(null);n.useEffect(()=>{let i=!1;return t?((async()=>{r(!0),d(null);try{console.log("🔍 PaymentResult: bookingCode param =",t);const m=await hn(t);console.log("✅ Booking detail response:",m),i||f(m.data||{})}catch(m){console.error("❌ Error fetching booking detail:",m),i||d(ht(m,"Không thể tải kết quả thanh toán."))}finally{i||r(!1)}})(),()=>{i=!0}):(d("Thiếu mã booking."),r(!1),()=>{})},[t]);const j=n.useMemo(()=>(c?.slots||[]).map(i=>Zi(i)),[c]);if(a)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center gap-3 text-gray-700",children:[e.jsx("div",{className:"h-6 w-6 rounded-full border-2 border-gray-300 border-t-blue-500 animate-spin"}),e.jsx("span",{children:"Đang tải kết quả thanh toán..."})]})});if(l)return e.jsx("div",{className:"min-h-screen flex items-center justify-center px-4",children:e.jsxs("div",{className:"max-w-md w-full text-center",children:[e.jsx("div",{className:"mb-4 text-red-600 text-2xl font-semibold",children:"Có lỗi xảy ra"}),e.jsx("div",{className:"mb-6 text-gray-700",children:l}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("button",{className:"btn-primary",onClick:()=>s(-1),children:"Quay lại"}),e.jsx("button",{className:"btn-ghost",onClick:()=>s("/"),children:"Về trang chủ"})]})]})});const o=c?.BookingCode||t,x=c?.TotalPrice;return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-emerald-50 to-sky-100 py-10 px-4",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow-lg rounded-xl p-8",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"mx-auto mb-4 h-16 w-16 rounded-full bg-emerald-100 flex items-center justify-center",children:e.jsxs("svg",{className:"h-10 w-10 text-emerald-600",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M9 12l2 2 4-4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("circle",{cx:"12",cy:"12",r:"9",stroke:"currentColor",strokeWidth:"2"})]})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Thanh Toán Thành Công!"})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-gray-50 px-4 py-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Mã Booking"}),e.jsx("div",{className:"mt-1 font-mono text-base font-semibold text-gray-900",children:o})]}),e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-gray-50 px-4 py-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Mã Giao Dịch"}),e.jsx("div",{className:"mt-1 font-mono text-base text-gray-900",children:c?.transactionId||"Đang cập nhật"})]}),e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-gray-50 px-4 py-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Sân"}),e.jsx("div",{className:"mt-1 text-base font-semibold text-gray-900",children:c?.FieldName||"-"})]}),e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-gray-50 px-4 py-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Tổng tiền"}),e.jsx("div",{className:"mt-1 text-base font-semibold text-emerald-700",children:Yi(x)})]})]}),j.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Khung giờ đã đặt"}),e.jsx("div",{className:"rounded-lg border border-gray-200 divide-y",children:j.map((i,m)=>e.jsxs("div",{className:"px-4 py-2 flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:i.playDate?new Date(i.playDate).toLocaleDateString("vi-VN"):"-"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[i.startTime," - ",i.endTime]})]},m))})]}),e.jsxs("div",{className:"mt-8 grid gap-3 sm:grid-cols-2",children:[e.jsx("button",{className:"btn-primary w-full",onClick:()=>s(`/bookings/${o}`),children:"Xem Chi Tiết Booking"}),e.jsx("button",{className:"btn-ghost w-full",onClick:()=>s(`/bookings/${o}/checkin-code`),children:"Xem Mã Check-in"})]})]})})})};function Ji(){return e.jsx(Qn,{children:e.jsx(_n,{children:e.jsxs(kn,{children:[e.jsx(xe,{path:"/login",element:e.jsx(ml,{})}),e.jsx(xe,{path:"/register",element:e.jsx(ul,{})}),e.jsx(xe,{path:"/",element:e.jsx(Ve,{children:e.jsx(hl,{})})}),e.jsx(xe,{path:"/fields",element:e.jsx(Ve,{children:e.jsx(fl,{})})}),e.jsx(xe,{path:"/fields/:id",element:e.jsx(Ve,{children:e.jsx(Nl,{})})}),e.jsx(xe,{path:"/booking/:id",element:e.jsx(Ve,{showFooter:!1,children:e.jsx(Hl,{})})}),e.jsx(xe,{path:"/cart",element:e.jsx(Ls,{children:e.jsx(Ve,{showFooter:!1,children:e.jsx(ti,{})})})}),e.jsx(xe,{path:"/bookings/:bookingCode",element:e.jsx(Ve,{showFooter:!1,children:e.jsx(Yl,{})})}),e.jsx(xe,{path:"/bookings/:bookingCode/checkin-code",element:e.jsx(Ve,{showFooter:!1,children:e.jsx(Zl,{})})}),e.jsx(xe,{path:"/payment/:bookingCode/transfer",element:e.jsx(Ve,{showFooter:!1,children:e.jsx(Xi,{})})}),e.jsx(xe,{path:"/payment/:bookingCode",element:e.jsx(Ve,{showFooter:!1,children:e.jsx(Wi,{})})}),e.jsxs(xe,{path:"/shop/*",element:e.jsx(Ls,{requiredLevel:"shop",children:e.jsx(Ve,{showFooter:!1,children:e.jsx(ni,{})})}),children:[e.jsx(xe,{index:!0,element:e.jsx(Bs,{to:"fields",replace:!0})}),e.jsx(xe,{path:"fields",element:e.jsx(ri,{})}),e.jsx(xe,{path:"pricing",element:e.jsx(di,{})}),e.jsx(xe,{path:"bookings",element:e.jsx(hi,{})}),e.jsx(xe,{path:"utilities",element:e.jsx(mi,{})}),e.jsx(xe,{path:"promotions",element:e.jsx(Ci,{})}),e.jsx(xe,{path:"revenue",element:e.jsx(pi,{})}),e.jsx(xe,{path:"settings",element:e.jsx(bi,{})})]}),e.jsxs(xe,{path:"/admin/*",element:e.jsx(Ls,{requiredLevel:"admin",children:e.jsx(Ve,{showFooter:!1,children:e.jsx(Ti,{})})}),children:[e.jsx(xe,{index:!0,element:e.jsx(Va,{})}),e.jsx(xe,{path:"dashboard",element:e.jsx(Va,{})}),e.jsx(xe,{path:"users",element:e.jsx(Bi,{})}),e.jsx(xe,{path:"shops",element:e.jsx(Ri,{})}),e.jsx(xe,{path:"requests",element:e.jsx(Ki,{})}),e.jsx(xe,{path:"insights",element:e.jsx(Oi,{})}),e.jsx(xe,{path:"transactions",element:e.jsx(zi,{})}),e.jsx(xe,{path:"payouts",element:e.jsx(Ui,{})})]}),e.jsx(xe,{path:"/forgot",element:e.jsx(si,{})}),e.jsx(xe,{path:"/reset-password",element:e.jsx(ai,{})}),e.jsx(xe,{path:"*",element:e.jsx(Ve,{children:e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"title-xl mb-4",children:"404"}),e.jsx("p",{className:"text-gray-600 mb-8",children:"Trang không tìm thấy"}),e.jsx("a",{href:"/",className:"btn-primary",children:"Về trang chủ"})]})})})})]})})})}qn.createRoot(document.getElementById("root")).render(e.jsx(n.StrictMode,{children:e.jsx(Ji,{})}));
